function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}var e=globalThis,n={},i={},o=e.parcelRequire22e7;null==o&&((o=function(t){if(t in n)return n[t].exports;if(t in i){var e=i[t];delete i[t];var o={id:t,exports:{}};return n[t]=o,e.call(o.exports,o,o.exports),o.exports}var s=Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){i[t]=e},e.parcelRequire22e7=o),(0,o.register)("gYAp4",function(e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=u(t);return n=e?Reflect.construct(i,arguments,u(this).constructor):i.apply(this,arguments),n&&("object"==typeof n||"function"==typeof n)?n:h(this)}}function p(t,e,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n,i,o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var s=[],r=!0,a=!1;try{for(o=o.call(t);!(r=(n=o.next()).done)&&(s.push(n.value),!e||s.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return s}}(t,e)||g(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(t,e)}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function m(t,e,n){return"*"===t||(t.length>0?-1!==t.indexOf(e):!n)}function _(t,e,n){var i,o=t=t||{},s=e=e||{};if(n)for(i=0;i<n.length;i++)o[n[i]]=s[n[i]];else for(i in s)o[i]=s[i];return t}function x(t){return"[object Number]"===Object.prototype.toString.call(t)}function k(t){return"string"==typeof t}function b(t){return"boolean"==typeof t}function C(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function E(t){return"[object Function]"===Object.prototype.toString.call(t)}function P(t){if(k(t))return""+t;if(b(t))return!!t;if("[object Date]"===Object.prototype.toString.call(t))return new Date(t.getTime());if(E(t))return t;if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(P(t[n]));return e}if(!C(t))return t;var i={};for(var o in t)i[o]=P(t[o]);return i}function S(t,e,n,i){var o,s,r={},a={};for(s=0,n=n||[],i=i||[];s<n.length;s++)r[n[s]]=!0;for(s=0;s<i.length;s++)a[i[s]]=!0;var l=P(t);for(s in e)if(null==l[s]||a[s])l[s]=e[s];else if(r[s])(o=[]).push.apply(o,Array.isArray(l[s])?l[s]:[l[s]]),o.push(e[s]),l[s]=o;else if(k(e[s])||b(e[s])||E(e[s])||x(e[s]))l[s]=e[s];else if(Array.isArray(e[s]))o=[],Array.isArray(l[s])&&o.push.apply(o,l[s]),o.push.apply(o,e[s]),l[s]=o;else if(C(e[s]))for(var u in C(l[s])||(l[s]={}),e[s])l[s][u]=e[s][u];return l}function w(t,e,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===e)return o}return t}function M(t,e){if(!t)return null;for(var n=0;n<t.length;n++)e(t[n])}function A(t,e){if(t){for(var n=0;n<t.length;n++)if(e(t[n]))return n}return -1}function D(t,e){var n=A(t,e);return -1===n?null:t[n]}function j(t,e){var n=null;return t.forEach(function(t){e(t)&&(n=t)}),n}function T(t,e){var n=A(t,e);return n>-1&&t.splice(n,1),-1!==n}function I(t){if(null!=Array.fromArray)return Array.from(t);var e=[];return Array.prototype.push.apply(e,t),e}function O(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),-1!==n}function G(t,e,n,i){var o=t[e];return null==o&&(o=[],t[e]=o),o[i?"unshift":"push"](n),o}function L(t,e,n){return -1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)}t(e.exports,"FlowchartConnector",()=>sf),t(e.exports,"newInstance",()=>sx),t(e.exports,"ready",()=>sk);for(var F,H,R,N,B,Y,X,z,V,U,W,q,Z,J,K,$,Q,tt,te,tn,ti,to,ts,tr,ta,tl,tu=[],tc=0;tc<256;tc++)tu[tc]=(tc<16?"0":"")+tc.toString(16);function th(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return tu[255&t]+tu[t>>8&255]+tu[t>>16&255]+tu[t>>24&255]+"-"+tu[255&e]+tu[e>>8&255]+"-"+tu[e>>16&15|64]+tu[e>>24&255]+"-"+tu[63&n|128]+tu[n>>8&255]+"-"+tu[n>>16&255]+tu[n>>24&255]+tu[255&i]+tu[i>>8&255]+tu[i>>16&255]+tu[i>>24&255]}function td(t,e,n){var i={x:t.x-e.x,y:t.y-e.y},o=Math.cos(n/360*Math.PI*2),s=Math.sin(n/360*Math.PI*2);return{x:i.x*o-i.y*s+e.x,y:i.y*o+i.x*s+e.y,cr:o,sr:s}}function tp(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;n.test(e.charAt(--i)););return e.slice(0,i+1)}function tv(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i]));return n}function tf(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(t){}}function tg(t){return t<0?-1:t>0?1:0}function ty(t,e,n){return function(){var i=null;try{null!=e&&(i=e.apply(this,arguments))}catch(t){tf("jsPlumb function failed : "+t)}if(null!=t&&(null==n||i!==n))try{i=t.apply(this,arguments)}catch(t){tf("wrapped function failed : "+t)}return i}}function tm(t,e,n){return t.has(e)||t.set(e,n()),t.get(e)}function t_(t,e){for(var n=t.__proto__;null!=n;){if(n instanceof e)return!0;n=n.__proto__}return!1}function tx(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function tk(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()}function tb(t,e,n,i){if(i&&tx(t,e,n))return t;for(t=t.parentNode;null!=t&&t!==n;){if(tx(t,e))return t;t=t.parentNode}}function tC(t){return t.srcElement||t.target}function tE(t){return null!=t.className?void 0===t.className.baseVal?t.className:t.className.baseVal:""}function tP(t,e,n){var i=null==e?[]:Array.isArray(e)?e:e.split(/\s+/),o=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),s=tE(t).split(/\s+/),r=function(t,e){for(var n=0;n<e.length;n++)if(t)-1===s.indexOf(e[n])&&s.push(e[n]);else{var i=s.indexOf(e[n]);-1!==i&&s.splice(i,1)}};r(!0,i),r(!1,o),function(t,e,n){e=tp(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var i=t.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var o=0;o<n.length;o++)n[o]&&i.add(n[o])}}catch(t){tf("WARN: cannot set class list",t)}}(t,s.join(" "),s)}function tS(t){return!k(t)&&!Array.isArray(t)&&null!=t.length&&null==t.documentElement&&null==t.nodeType}function tw(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?M(tp(e).split(/\s+/),function(e){t.classList.add(e)}):tP(t,e))};tS(t)?M(t,function(t){return n(t,e)}):n(t,e)}function tM(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?tp(e).split(/\s+/).forEach(function(e){t.classList.remove(e)}):tP(t,null,e))};tS(t)?M(t,function(t){return n(t,e)}):n(t,e)}function tA(t,e,n,i,o){var s,r=null==t?document.createElement(e):document.createElementNS(t,e);for(s in n=n||{})r.style[s]=n[s];for(s in i&&(r.className=i),o=o||{})r.setAttribute(s,""+o[s]);return r}function tD(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft,r=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=e.top+o-r;return{x:Math.round(e.left+s-a),y:Math.round(l)}}function tj(t,e){var n=e.getContainer().getBoundingClientRect(),i=t.getBoundingClientRect(),o=e.currentZoom;return{x:(i.left-n.left)/o,y:(i.top-n.top)/o}}function tT(t,e){var n=t.getBoundingClientRect(),i=e.currentZoom;return{w:n.width/i,h:n.height/i}}function tI(t){return t instanceof SVGElement?J.SVG:J.HTML}function tO(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map(function(t){return"."+t}).join(",")}function tG(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map(function(t){return"["+t+"]"}).join(",")}(F=J||(J={})).SVG="SVG",F.HTML="HTML";var tL="source",tF="target",tH="block",tR="none",tN="absolute",tB="fixed",tY="data-jtk-group",tX="data-jtk-managed",tz="data-jtk-not-draggable",tV="tabindex",tU="data-jtk-scope-",tW="checkCondition",tq="jtk-connector",tZ="jtk-endpoint",tJ="jtk-floating-endpoint",tK="jtk-group-collapsed",t$="jtk-group-expanded",tQ="jtk-overlay",t0="connection",t1="internal.connection",t2="connection:move",t5="internal.endpoint:unregistered",t3="internal.connection:detached",t4="element:manage",t6="maxConnections",t9="element:unmanage",t8="zoom",t7="isDetachAllowed",et="beforeDrop",ee="beforeDetach",en=tG(tX),ei={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},eo="stroke-dasharray",es="dashstyle",er="path",ea="http://www.w3.org/2000/svg";function el(t,e){for(var n in e)t.setAttribute(n,""+e[n])}function eu(t,e){return(e=e||{}).version="1.1",e.xmlns=ea,tA(ea,t,null,null,e)}function ec(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"}function eh(t,e,n){if(e.setAttribute("fill",n.fill?n.fill:tR),e.setAttribute("stroke",n.stroke?n.stroke:tR),n.strokeWidth&&e.setAttribute("stroke-width",n.strokeWidth),n[es]&&n.strokeWidth&&!n[eo]){var i=-1===n[es].indexOf(",")?" ":",",o=n[es].split(i),s="";M(o,function(t){s+=Math.floor(t*n.strokeWidth)+i}),e.setAttribute(eo,s)}else n[eo]&&e.setAttribute(eo,n[eo]);for(var r in ei)n[r]&&e.setAttribute(ei[r],n[r])}function ed(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)}function ep(t,e,n){var i=[t,e];return n&&i.push(n),i.join(":")}var ev="data-jtk-container",ef="data-jtk-enabled",eg="data-jtk-scope",ey="endpoint",em="element",e_="connection",ex="click",ek="contextmenu",eb="dblclick",eC="dbltap",eE="mousedown",eP="mouseenter",eS="mouseexit",ew="mousemove",eM="mouseup",eA="mouseout",eD="mouseover",ej="revert",eT="connection:drag",eI=ep(em,ex),eO=ep(em,eb),eG=ep(em,eC),eL=ep(em,eA),eF=ep(em,eD),eH=ep(em,ew),eR=ep(em,eM),eN=ep(em,eE),eB=ep(em,ek),eY=ep(em,"tap"),eX=ep(ey,ex),ez=ep(ey,eb);ep(ey,eC);var eV=ep(ey,eA),eU=ep(ey,eD),eW=ep(ey,eM),eq=ep(ey,eE);ep(ey,"tap");var eZ=ep(e_,ex),eJ=ep(e_,eb),eK=ep(e_,eC),e$=ep(e_,eA),eQ=ep(e_,eD),e0=ep(e_,eM),e1=ep(e_,eE),e2=ep(e_,ek),e5=ep(e_,"tap"),e3="position",e4=tO(tq),e6=tO(tZ),e9=tG(tY),e8=tG("data-jtk-group-content"),e7=tO(tQ);function nt(){return{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}(H=K||(K={})).Circle="Circle",H.Ellipse="Ellipse",H.Triangle="Triangle",H.Diamond="Diamond",H.Rectangle="Rectangle",H.Square="Square",(R=$||($={})).Assign="Assign",R.AutoDefault="AutoDefault",R.Bottom="Bottom",R.BottomLeft="BottomLeft",R.BottomRight="BottomRight",R.Center="Center",R.Continuous="Continuous",R.ContinuousBottom="ContinuousBottom",R.ContinuousLeft="ContinuousLeft",R.ContinuousRight="ContinuousRight",R.ContinuousTop="ContinuousTop",R.ContinuousLeftRight="ContinuousLeftRight",R.ContinuousTopBottom="ContinuousTopBottom",R.Left="Left",R.Perimeter="Perimeter",R.Right="Right",R.Top="Top",R.TopLeft="TopLeft",R.TopRight="TopRight";var ne=function(){function t(e){o(this,t),this.params=e,a(this,"x1",void 0),a(this,"x2",void 0),a(this,"y1",void 0),a(this,"y2",void 0),a(this,"extents",nt()),a(this,"type",void 0),this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}return r(t,[{key:"findClosestPointOnPath",value:function(t,e){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return[]}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}},{key:"boundingBoxIntersection",value:function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}}]),t}(),nn="undefined",ni="default",no="true",ns="false";function nr(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function na(t){return t.srcElement||t.target}function nl(t,e,n,i){if(!i)return{path:[e],end:1};var o=t.composedPath?t.composedPath():t.path;if(void 0!==o&&o.indexOf)return{path:o,end:o.indexOf(n)};var s={path:[],end:-1};return function t(e){s.path.push(e),e===n?s.end=s.path.length-1:null!=e.parentNode&&t(e.parentNode)}(e),s}var nu=1;function nc(){return"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function nh(){return"onmousedown"in document.documentElement}var nd=(a(Q={},eE,"touchstart"),a(Q,eM,"touchend"),a(Q,ew,"touchmove"),Q);function np(t,e){if(null==t)return{x:0,y:0};var n,i=(n=nf(t)).item?n.item(0):n[0];return{x:i[e+"X"],y:i[e+"Y"]}}function nv(t){return np(t,"page")}function nf(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]}function ng(t,e,n,i,o){if(n_(t,e,n),i.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1,o);else if(t.attachEvent){var s=e+n.__tauid;t["e"+s]=n,t[s]=function(){t["e"+s]&&t["e"+s](window.event)},t.attachEvent("on"+e,t[s])}}function ny(t,e,n){var i=this;null!=n&&nm(t,function(o){if(function(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)ny(t,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(o,e,n),null!=n.__tauid){if(o.removeEventListener)o.removeEventListener(e,n,!1),nc()&&nd[e]&&o.removeEventListener(nd[e],n,!1);else if(i.detachEvent){var s=e+n.__tauid;o[s]&&o.detachEvent("on"+e,o[s]),o[s]=null,o["e"+s]=null}}n.__taTouchProxy&&ny(t,n.__taTouchProxy[1],n.__taTouchProxy[0])})}function nm(t,e){if(null!=t)for(var n="string"==typeof t?document.querySelectorAll(t):null!=t.length?t:[t],i=0;i<n.length;i++)e(n[i])}function n_(t,e,n){var i=nu++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][i]=n,n.__tauid=i,i}var nx=/:not\(([^)]+)\)/;function nk(t,e,n,i){if(null==t)return n;var o=t.split(","),s=[],r=[];M(o,function(t){var e=t.match(nx);null!=e?r.push(e[1]):s.push(t)}),r.length>0&&0===s.length&&s.push("*");var a=function i(o){i.__tauid=n.__tauid;var a=na(o),l=!1,u=a,c=nl(o,a,e,null!=t);if(-1!=c.end)for(var h=0;!l&&h<c.end;h++){u=c.path[h];for(var d=0;d<r.length;d++)if(nr(u,r[d],e))return;for(var p=0;!l&&p<s.length;p++)if(nr(u,s[p],e)){n.apply(u,[o,u]),l=!0;break}}};return n.__taExtra=n.__taExtra||[],n.__taExtra.push([i,a]),a}var nb=function(t,e,n,i,o){if(nc()&&nd[e]){var s=nk(i,t,n,nd[e]);ng(t,nd[e],s,n,o)}"focus"===e&&null==t.getAttribute(tV)&&t.setAttribute(tV,"1"),ng(t,e,nk(i,t,n,e),n,o)},nC=(a(tt={},"tap",{touches:1,taps:1}),a(tt,eC,{touches:1,taps:2}),a(tt,ek,{touches:2,taps:1}),tt);function nE(t,e,n,i){for(var o in n.__tamee[t])n.__tamee[t].hasOwnProperty(o)&&n.__tamee[t][o].apply(i,[e])}var nP=function(){function t(){o(this,t)}return r(t,null,[{key:"generate",value:function(t,e){return function(n,i,o,s){if(i==ek&&nh())nb(n,i,o,s);else{if(null==n.__taTapHandler){var r=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var o=na(i),a=nl(i,o,n,null!=s),l=!1,h=0;h<a.end;h++){if(l)return;o=a.path[h];for(var d=0;d<r.downSelectors.length;d++)if(null==r.downSelectors[d]||nr(o,r.downSelectors[d],n)){r.down=!0,setTimeout(u,t),setTimeout(c,e),l=!0;break}}},l=function(t){if(r.down){var e,i,o=na(t);r.taps++;var s=nf(t).length;for(var a in nC)if(nC.hasOwnProperty(a)){var l=nC[a];if(l.touches===s&&(1===l.taps||l.taps===r.taps))for(var u=0;u<r[a].length;u++){i=nl(t,o,n,null!=r[a][u][1]);for(var c=0;c<i.end;c++)if(e=i.path[c],null==r[a][u][1]||nr(e,r[a][u][1],n)){r[a][u][0].apply(e,[t,e]);break}}}}},u=function(){r.down=!1},c=function(){r.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,nb(n,eE,a),nb(n,eM,l)}n.__taTapHandler.downSelectors.push(s),n.__taTapHandler[i].push([o,s]),o.__taUnstore=function(){null!=n.__taTapHandler&&(T(n.__taTapHandler.downSelectors,function(t){return t===s}),function(t,e){var n,i=0;for(i=0,n=t.length;i<n&&t[i][0]!==e;i++);i<t.length&&t.splice(i,1)}(n.__taTapHandler[i],o),0===n.__taTapHandler.downSelectors.length&&(ny(n,eE,n.__taTapHandler.downHandler),ny(n,eM,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),t}(),nS=function(){function t(){o(this,t)}return r(t,null,[{key:"generate",value:function(){var t=[];return function(e,n,i,o){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var s=function(n){var i=na(n);(null==o&&i==e&&!e.__tamee.over||nr(i,o,e)&&(null==i.__tamee||!i.__tamee.over))&&(nE(eP,n,e,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,t.push(i))},r=function(n){for(var i=na(n),o=0;o<t.length;o++)i!=t[o]||nr(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,t.splice(o,1),nE(eS,n,e,i))};ng(e,eD,nk(o,e,s,eD),s),ng(e,eA,nk(o,e,r,eA),r)}i.__taUnstore=function(){delete e.__tamee[n][i.__tauid]},n_(e,n,i),e.__tamee[n][i.__tauid]=i}}}]),t}(),nw=function(){function t(e){o(this,t),a(this,"clickThreshold",void 0),a(this,"dblClickThreshold",void 0),a(this,"tapHandler",void 0),a(this,"mouseEnterExitHandler",void 0),e=e||{},this.clickThreshold=e.clickThreshold||250,this.dblClickThreshold=e.dblClickThreshold||450,this.mouseEnterExitHandler=nS.generate(),this.tapHandler=nP.generate(this.clickThreshold,this.dblClickThreshold)}return r(t,[{key:"_doBind",value:function(t,e,n,i,o){null!=n&&("tap"===e||e===eC||e===ek?this.tapHandler(t,e,n,i,o):e===eP||e==eS?this.mouseEnterExitHandler(t,e,n,i,o):nb(t,e,n,i,o))}},{key:"on",value:function(t,e,n,i,o){var s=null==i?null:n,r=null==i?n:i;return this._doBind(t,e,r,s,o),this}},{key:"off",value:function(t,e,n){return ny(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){var s=nh()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),r=nc()&&!nh()&&nd[e]?nd[e]:e,a=!(nc()&&!nh()&&nd[e]),l=nv(n),u=np(n,"screen"),c=np(n,"client");return nm(t,function(t){n=n||{screenX:u.x,screenY:u.y,clientX:c.x,clientY:c.y};var h,d=!a&&!s&&nc()&&nd[e]?"TouchEvent":"MouseEvents";h=document.createEvent(d),({TouchEvent:function(e){var n,i,o,s,a,h,d=(n=l.x,i=l.y,o=u.x,s=u.y,a=c.x,h=c.y,function(){var t=[];return t.push.apply(t,arguments),t.item=function(t){return this[t]},t}(new Touch({target:t,identifier:th(),pageX:n,pageY:i,screenX:o,screenY:s,clientX:a||o,clientY:h||s})));(e.initTouchEvent||e.initEvent)(r,!0,!0,window,null,u.x,u.y,c.x,c.y,!1,!1,!1,!1,d,d,d,1,0)},MouseEvents:function(e){e.initMouseEvent(r,!0,!0,window,null==o?1:o,u.x,u.y,c.x,c.y,!1,!1,!1,!1,1,t)}})[d](h),i&&(h.payload=i),t.dispatchEvent(h)}),this}}]),t}(),nM=[null,[1,-1],[1,1],[-1,1],[-1,-1]],nA=[null,[-1,-1],[-1,1],[1,1],[1,-1]],nD=2*Math.PI;function nj(t,e){return e.x===t.x?e.y>t.y?1/0:-1/0:e.y===t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)}function nT(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function nI(t,e){return e.x>t.x?e.y>t.y?2:1:e.x==t.x?e.y>t.y?2:1:e.y>t.y?3:4}function nO(t,e){var n=t.x,i=t.x+t.w,o=t.y,s=t.y+t.h,r=e.x,a=e.x+e.w,l=e.y,u=e.y+e.h;return n<=r&&r<=i&&o<=l&&l<=s||n<=a&&a<=i&&o<=l&&l<=s||n<=r&&r<=i&&o<=u&&u<=s||n<=a&&r<=i&&o<=u&&u<=s||r<=n&&n<=a&&l<=o&&o<=u||r<=i&&i<=a&&l<=o&&o<=u||r<=n&&n<=a&&l<=s&&s<=u||r<=i&&n<=a&&l<=s&&s<=u}function nG(t,e,n){var i=nj(t,e),o=nI(t,e),s=n>0?nM[o]:nA[o],r=Math.atan(i),a=Math.abs(n*Math.sin(r))*s[1],l=Math.abs(n*Math.cos(r))*s[0];return{x:t.x+l,y:t.y+a}}function nL(t,e,n){var i=e.parentNode,o=t.getSize(i),s=t.getSize(e),r=n.x,a=r+s.w,l=n.y,u=l+s.h;return a>0&&r<o.w&&u>0&&l<o.h}var nF="start",nH="beforeStart",nR="drag",nN="stop",nB=function(){return!0},nY=function(){return!1},nX={delegatedDraggable:"katavorio-delegated-draggable",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"};(N=te||(te={})).absolutePosition="absolutePosition",N.transform="transform",N.xyAttributes="xyAttributes";var nz=new Map;nz.set(te.absolutePosition,function(t,e){t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px")}),nz.set(te.xyAttributes,function(t,e){t.setAttribute("x","".concat(e.x)),t.setAttribute("y","".concat(e.y))});var nV=new Map;nV.set(te.absolutePosition,function(t){return{x:t.offsetLeft,y:t.offsetTop}}),nV.set(te.xyAttributes,function(t){return{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y"))}});var nU=new Map;nU.set(te.absolutePosition,function(t,e){t.style.width="".concat(e.w,"px"),t.style.height="".concat(e.h,"px")}),nU.set(te.xyAttributes,function(t,e){t.setAttribute("width","".concat(e.w)),t.setAttribute("height","".concat(e.h))});var nW=new Map;nW.set(te.absolutePosition,function(t){return{w:t.offsetWidth,h:t.offsetHeight}}),nW.set(te.xyAttributes,function(t){return{w:parseFloat(t.getAttribute("width")),h:parseFloat(t.getAttribute("height"))}});var nq=[nN,nF,nR,"drop","over","out",nH],nZ=function(){},nJ=function(t,e){if(null!=t){t=k(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}},nK=function(){function t(e,n){o(this,t),this.el=e,this.manager=n,a(this,"_class",void 0),a(this,"uuid",th()),a(this,"enabled",!0),a(this,"scopes",[]),a(this,"eventManager",void 0),this.eventManager=n.eventManager}return r(t,[{key:"setEnabled",value:function(t){this.enabled=t}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(t){var e={};for(var n in nJ(this.scopes,function(t){e[t]=!0}),nJ(t?t.split(/\s+/):[],function(t){e[t]=!0}),this.scopes.length=0,e)this.scopes.push(n)}},{key:"removeScope",value:function(t){var e={};for(var n in nJ(this.scopes,function(t){e[t]=!0}),nJ(t?t.split(/\s+/):[],function(t){delete e[t]}),this.scopes.length=0,e)this.scopes.push(n)}},{key:"toggleScope",value:function(t){var e={};for(var n in nJ(this.scopes,function(t){e[t]=!0}),nJ(t?t.split(/\s+/):[],function(t){e[t]?delete e[t]:e[t]=!0}),this.scopes.length=0,e)this.scopes.push(n)}}]),t}();(B=tn||(tn={})).notNegative="notNegative",B.parent="parent",B.parentEnclosed="parentEnclosed";var n$=function(t){l(n,t);var e=d(n);function n(t,i,s){var r;if(o(this,n),a(h(r=e.call(this,t,s)),"_class",void 0),a(h(r),"rightButtonCanDrag",void 0),a(h(r),"consumeStartEvent",void 0),a(h(r),"clone",void 0),a(h(r),"scroll",void 0),a(h(r),"trackScroll",void 0),a(h(r),"_downAt",void 0),a(h(r),"_posAtDown",void 0),a(h(r),"_pagePosAtDown",void 0),a(h(r),"_pageDelta",{x:0,y:0}),a(h(r),"_moving",void 0),a(h(r),"_lastPosition",void 0),a(h(r),"_lastScrollValues",{x:0,y:0}),a(h(r),"_initialScroll",{x:0,y:0}),a(h(r),"_size",void 0),a(h(r),"_currentParentPosition",void 0),a(h(r),"_ghostParentPosition",void 0),a(h(r),"_dragEl",void 0),a(h(r),"_multipleDrop",void 0),a(h(r),"_ghostProxyOffsets",void 0),a(h(r),"_ghostDx",void 0),a(h(r),"_ghostDy",void 0),a(h(r),"_isConstrained",!1),a(h(r),"_ghostProxyParent",void 0),a(h(r),"_useGhostProxy",void 0),a(h(r),"_ghostProxyFunction",void 0),a(h(r),"_activeSelectorParams",void 0),a(h(r),"_availableSelectors",[]),a(h(r),"_canDrag",void 0),a(h(r),"_consumeFilteredEvents",void 0),a(h(r),"_parent",void 0),a(h(r),"_ignoreZoom",void 0),a(h(r),"_filters",{}),a(h(r),"_constrainRect",void 0),a(h(r),"_elementToDrag",void 0),a(h(r),"downListener",void 0),a(h(r),"moveListener",void 0),a(h(r),"upListener",void 0),a(h(r),"scrollTracker",void 0),a(h(r),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),r._class=r.manager.css.draggable,tw(r.el,r._class),r.downListener=r._downListener.bind(h(r)),r.upListener=r._upListener.bind(h(r)),r.moveListener=r._moveListener.bind(h(r)),r.rightButtonCanDrag=!0===i.rightButtonCanDrag,r.consumeStartEvent=!1!==i.consumeStartEvent,r._dragEl=r.el,r.clone=!0===i.clone,r.scroll=!0===i.scroll,r.trackScroll=!1!==i.trackScroll,r._multipleDrop=!1!==i.multipleDrop,r._canDrag=i.canDrag||nB,r._consumeFilteredEvents=i.consumeFilteredEvents,r._parent=i.parent,r._ignoreZoom=!0===i.ignoreZoom,r._ghostProxyParent=i.ghostProxyParent,r.trackScroll&&(r.scrollTracker=r._trackScroll.bind(h(r)),document.addEventListener("scroll",r.scrollTracker)),!0===i.ghostProxy?r._useGhostProxy=nB:i.ghostProxy&&"function"==typeof i.ghostProxy?r._useGhostProxy=i.ghostProxy:r._useGhostProxy=function(t,e){return!!r._activeSelectorParams&&!!r._activeSelectorParams.useGhostProxy&&r._activeSelectorParams.useGhostProxy(t,e)},i.makeGhostProxy?r._ghostProxyFunction=i.makeGhostProxy:r._ghostProxyFunction=function(t){return r._activeSelectorParams&&r._activeSelectorParams.makeGhostProxy?r._activeSelectorParams.makeGhostProxy(t):t.cloneNode(!0)},i.selector){var l=r.el.getAttribute("katavorio-draggable");null==l&&(l=""+new Date().getTime(),r.el.setAttribute("katavorio-draggable",l)),r._availableSelectors.push(i)}return r.eventManager.on(r.el,eE,r.downListener),r}return r(n,[{key:"_trackScroll",value:function(t){if(this._moving){var e={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=e.x-this._lastScrollValues.x,i=e.y-this._lastScrollValues.y,o={x:n+this._lastPosition.x,y:i+this._lastPosition.y},s=o.x-this._downAt.x,r=o.y-this._downAt.y,a=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(s+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,r+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),s/=a,r/=a,this.moveBy(s,r,t),this._lastPosition=o,this._lastScrollValues=e}}},{key:"on",value:function(t,e){this.listeners[t]&&this.listeners[t].push(e)}},{key:"off",value:function(t,e){if(this.listeners[t]){for(var n=[],i=0;i<this.listeners[t].length;i++)this.listeners[t][i]!==e&&n.push(this.listeners[t][i]);this.listeners[t]=n}}},{key:"_upListener",value:function(t){this._downAt&&(this._downAt=null,this.eventManager.off(document,ew,this.moveListener),this.eventManager.off(document,eM,this.upListener),tM(document.body,nX.noSelect),this.unmark(t),this.stop(t),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch(ej,this._dragEl)))}},{key:"_downListener",value:function(t){if(!t.defaultPrevented&&(this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this._canDrag()){var e,n;if(this._testFilter(t)&&(e=this.el,n=this.manager,!tx(t.srcElement||t.target,n.getInputFilterSelector(),e))){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var i=t.target||t.srcElement,o=function(t,e,n){for(var i=null,o=e.getAttribute("katavorio-draggable"),s=null!=o?"[katavorio-draggable='"+o+"'] ":"",r=0;r<t.length;r++)if(null!=(i=function(t,e,n){if(tx(e,n,t))return e;for(var i=e.parentNode;null!=i&&i!==t;){if(tx(i,n,t))return i;i=i.parentNode}}(e,n,s+t[r].selector))){if(t[r].filter){var a=tx(n,t[r].filter,i);if(!0===t[r].filterExclude&&!a||a)return null}return[t[r],i]}return null}(this._availableSelectors,this.el,i);if(null!=o&&(this._activeSelectorParams=o[0],this._elementToDrag=o[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var s=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,t):null;if(null!=s&&(this._elementToDrag=s),this.clone){if(this._dragEl=this._elementToDrag.cloneNode(!0),tw(this._dragEl,nX.clonedDrag),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var r=this.manager.getPosition(this.el);this._dragEl.style.left=r.x+"px",this._dragEl.style.top=r.y+"px",this._parent.appendChild(this._dragEl)}else{var a=tD(this._elementToDrag);this._dragEl.style.left=a.x+"px",this._dragEl.style.top=a.y+"px",document.body.appendChild(this._dragEl)}}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&tk(t),this._downAt=nv(t),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=tD(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,ew,this.moveListener),this.eventManager.on(document,eM,this.upListener),tw(document.body,nX.noSelect),this._dispatch(nH,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size})}else this._consumeFilteredEvents&&tk(t)}}},{key:"_moveListener",value:function(t){if(this._downAt){if(!this._moving){var e=this._dispatch(nF,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size});if(!1!==e){if(!this._downAt)return;this.mark(e),this._moving=!0}else this.abort()}if(this._downAt){var n=nv(t),i=n.x-this._downAt.x,o=n.y-this._downAt.y,s=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=s,o/=s,this.moveBy(i,o,t)}}}},{key:"getDragDelta",value:function(){return null!=this._posAtDown&&null!=this._downAt?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(t){var e;this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=tD(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),tw(this._dragEl,this.manager.css.drag),this._constrainRect={w:(e=this._dragEl).parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(t){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,tM(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(t,e,n){var i=this.toGrid({x:this._posAtDown.x+t,y:this._posAtDown.y+e}),o=this._doConstrain(i,this._dragEl,this._constrainRect,this._size,n);if(null!=o){if(this._useGhostProxy(this.el,this._dragEl)){if(i.x!==o.x||i.y!==o.y){if(!this._isConstrained){var s=this._ghostProxyFunction(this._elementToDrag);tw(s,nX.ghostProxy),this._ghostProxyParent?(this._ghostProxyParent.appendChild(s),this._currentParentPosition=tD(this._elementToDrag.parentNode),this._ghostParentPosition=tD(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(s),this._dragEl=s,this._isConstrained=!0}o=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0)}this.manager.setPosition(this._dragEl,{x:o.x+this._ghostDx,y:o.y+this._ghostDy}),this._dispatch(nR,{el:this.el,pos:o,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(t){return t?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(t,e){if(e||this._moving){var n=[],i=this.manager.getPosition(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(nN,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:t,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else!this._moving&&this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(t,e){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[t])n=this._activeSelectorParams[t](e);else if(this.listeners[t])for(var i=0;i<this.listeners[t].length;i++)try{var o=this.listeners[t][i](e);null!=o&&(n=o)}catch(t){}return n}},{key:"resolveGrid",value:function(){var t={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(t.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(t.thresholdX=this._activeSelectorParams.snapThreshold,t.thresholdY=this._activeSelectorParams.snapThreshold)),t}},{key:"toGrid",value:function(t){var e,n,i,o,s,r,a,l,u,c=this.resolveGrid(),h=c.grid,d=c.thresholdX,p=c.thresholdY;if(null==h)return t;var v=h?h.w/2:d,f=h?h.h/2:p;return e=v,n=f,e=null==e?null==h.thresholdX?h.w/2:h.thresholdX:e,n=null==n?null==h.thresholdY?h.h/2:h.thresholdY:n,i=Math.floor(t.x/h.w),s=(o=h.w*i)+h.w,r=Math.abs(t.x-o)<=e?o:Math.abs(s-t.x)<=e?s:t.x,a=Math.floor(t.y/h.h),u=(l=h.h*a)+h.h,{x:r,y:Math.abs(t.y-l)<=n?l:Math.abs(u-t.y)<=n?u:t.y}}},{key:"setUseGhostProxy",value:function(t){this._useGhostProxy=t?nB:nY}},{key:"_doConstrain",value:function(t,e,n,i,o){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(t,e,n,i,o):t}},{key:"_testFilter",value:function(t){for(var e in this._filters){var n=this._filters[e],i=n[0](t);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(t,e){var n=this;if(t){var i="function"==typeof t?(t._katavorioId=th(),t._katavorioId):t;this._filters[i]=[function(e){var i,o=e.srcElement||e.target;return k(t)?i=tx(o,t,n.el):"function"==typeof t&&(i=t(e,n.el)),i},!1!==e]}}},{key:"removeFilter",value:function(t){var e="function"==typeof t?t._katavorioId:t;delete this._filters[e]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(t,e){t.selector&&(e?this._availableSelectors.unshift(t):this._availableSelectors.push(t))}},{key:"destroy",value:function(){this.eventManager.off(this.el,eE,this.downListener),this.eventManager.off(document,ew,this.moveListener),this.eventManager.off(document,eM,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),n}(nK),nQ=function(){function t(e){o(this,t),a(this,"eventManager",void 0),a(this,"zoom",1),a(this,"css",{}),a(this,"inputFilterSelector",void 0),a(this,"positioningStrategy",void 0),a(this,"_positionSetter",void 0),a(this,"_positionGetter",void 0),a(this,"_sizeSetter",void 0),a(this,"_sizeGetter",void 0),e=e||{},this.inputFilterSelector=e.inputFilterSelector||"input,textarea,select,button,option",this.eventManager=new nw,this.zoom=e.zoom||1,this.positioningStrategy=e.positioningStrategy||te.absolutePosition,this._positionGetter=nV.get(this.positioningStrategy),this._positionSetter=nz.get(this.positioningStrategy),this._sizeGetter=nW.get(this.positioningStrategy),this._sizeSetter=nU.get(this.positioningStrategy);var n=e.css||{};_(this.css,n)}return r(t,[{key:"getPosition",value:function(t){return this._positionGetter(t)}},{key:"setPosition",value:function(t,e){this._positionSetter(t,e)}},{key:"getSize",value:function(t){return this._sizeGetter(t)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(t){this.zoom=t}},{key:"_prepareParams",value:function(t){var e,n={events:{}};for(e in t=t||{})n[e]=t[e];for(e=0;e<nq.length;e++)n.events[nq[e]]=t[nq[e]]||nZ;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(t){return this.inputFilterSelector=t,this}},{key:"draggable",value:function(t,e){if(null!=t._katavorioDrag)return t._katavorioDrag;var n=new n$(t,this._prepareParams(e),this);return tw(t,nX.delegatedDraggable),t._katavorioDrag=n,n}},{key:"destroyDraggable",value:function(t){t._katavorioDrag&&(t._katavorioDrag.destroy(),delete t._katavorioDrag)}}]),t}(),n0="jtk-drag-selected",n1=function(){function t(e){o(this,t),this.instance=e,a(this,"_dragSelection",[]),a(this,"_dragSizes",new Map),a(this,"_dragElements",new Map),a(this,"_dragElementStartPositions",new Map),a(this,"_dragElementPositions",new Map),a(this,"__activeSet",void 0)}return r(t,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(t){var e=this;this.__activeSet=[],M(this._dragSelection,function(n){t(n)&&e.__activeSet.push(n)})}},{key:"clear",value:function(){var t=this;this.reset(),M(this._dragSelection,function(e){return t.instance.removeClass(e.jel,n0)}),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var t=this;M(this._activeSet,function(e){var n=t.instance.viewport.getPosition(e.id),i={x:parseInt(""+e.jel.offsetLeft,10),y:parseInt(""+e.jel.offsetTop,10)};t._dragElementStartPositions.set(e.id,i),t._dragElementPositions.set(e.id,i),t._dragSizes.set(e.id,{w:n.w,h:n.h})})}},{key:"updatePositions",value:function(t,e,n){var i=this,o=t.x-e.x,s=t.y-e.y;M(this._activeSet,function(t){var e=i._dragElementStartPositions.get(t.id);if(e){var r=e.x+o,a=e.y+s,l=i._dragSizes.get(t.id),u={x:r,y:a,w:l.w,h:l.h};if(t.jel._jsPlumbParentGroup&&t.jel._jsPlumbParentGroup.constrain){var c={w:t.jel.parentNode.offsetWidth+t.jel.parentNode.scrollLeft,h:t.jel.parentNode.offsetHeight+t.jel.parentNode.scrollTop};u.x=Math.max(u.x,0),u.y=Math.max(u.y,0),u.x=Math.min(u.x,c.w-l.w),u.y=Math.min(u.y,c.h-l.h)}i._dragElementPositions.set(t.id,{x:r,y:a}),t.jel.style.left=u.x+"px",t.jel.style.top=u.y+"px",n(t.jel,t.id,l,u)}})}},{key:"each",value:function(t){var e=this;M(this._activeSet,function(n){var i=e._dragSizes.get(n.id),o=e._dragElementPositions.get(n.id),s=e._dragElementStartPositions.get(n.id);t(n.jel,n.id,o,i,s)})}},{key:"add",value:function(t,e){e=e||this.instance.getId(t),-1===A(this._dragSelection,function(t){return t.id===e})&&(this.instance.addClass(t,n0),this._dragSelection.push({id:e,jel:t}))}},{key:"remove",value:function(t){var e=this;this._dragSelection=this._dragSelection.filter(function(n){var i=n.jel!==t;return i||e.instance.removeClass(n.jel,n0),i})}},{key:"toggle",value:function(t){-1!==A(this._dragSelection,function(e){return e.jel===t})?this.remove(t):this.add(t)}}]),t}(),n2="jtk-drag-active",n5="jtk-drag-hover",n3=function(){function t(e,n,i){var s=this;o(this,t),this.instance=e,this.dragSelection=n,a(this,"collicat",void 0),a(this,"drag",void 0),a(this,"_draggables",{}),a(this,"_dlist",[]),a(this,"_elementsWithEndpoints",{}),a(this,"_draggablesForElements",{}),a(this,"handlers",[]),a(this,"_trackScroll",void 0),a(this,"_filtersToAdd",[]),this.collicat=new nQ({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:n0,active:n2,hover:n5,ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind(t8,function(t){s.collicat.setZoom(t)}),i=i||{},this._trackScroll=!1!==i.trackScroll}return r(t,[{key:"addHandler",value:function(t,e){var n=this,i=_({selector:t.selector},e||{});i.start=ty(i.start,function(e){return t.onStart(e)},!1),i.drag=ty(i.drag,function(e){return t.onDrag(e)}),i.stop=ty(i.stop,function(e){return t.onStop(e)});var o=(t.onBeforeStart||function(t){}).bind(t);if(i.beforeStart=ty(i.beforeStart,function(t){return o(t)}),i.dragInit=function(e,n){return t.onDragInit(e,n)},i.dragAbort=function(e){return t.onDragAbort(e)},t.useGhostProxy&&(i.useGhostProxy=t.useGhostProxy,i.makeGhostProxy=t.makeGhostProxy),null==i.constrainFunction&&null!=i.containment)switch(i.containment){case tn.notNegative:i.constrainFunction=function(t,e,n,i){return{x:Math.max(0,Math.min(t.x)),y:Math.max(0,Math.min(t.y))}};break;case tn.parent:var s=i.containmentPadding||5;i.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x>n.w-s?n.w-s:t.x,y:t.y<0?0:t.y>n.h-s?n.h-s:t.y}};break;case tn.parentEnclosed:i.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x+i.w>n.w?n.w-i.w:t.x,y:t.y<0?0:t.y+i.h>n.h?n.h-i.h:t.y}}}null==this.drag?(i.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),i),M(this._filtersToAdd,function(t){return n.drag.addFilter(t[0],t[1])}),this.drag.on(ej,function(t){n.instance.revalidate(t)})):this.drag.addSelector(i),this.handlers.push({handler:t,options:i}),t.init(this.drag)}},{key:"addSelector",value:function(t,e){this.drag&&this.drag.addSelector(t,e)}},{key:"addFilter",value:function(t,e){null==this.drag?this._filtersToAdd.push([t,!0===e]):this.drag.addFilter(t,e)}},{key:"removeFilter",value:function(t){null!=this.drag&&this.drag.removeFilter(t)}},{key:"setFilters",value:function(t){var e=this;M(t,function(t){e.drag.addFilter(t[0],t[1])})}},{key:"reset",value:function(){var t=[];if(M(this.handlers,function(t){t.handler.reset()}),this.handlers.length=0,null!=this.drag){var e=this.drag._filters;for(var n in e)t.push([n,e[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,t}},{key:"setOption",value:function(t,e){var n=D(this.handlers,function(e){return e.handler===t});null!=n&&_(n.options,e||{})}}]),t}(),n4=function(){function t(e,n){o(this,t),this.instance=e,this._dragSelection=n,a(this,"selector","> "+en+":not("+tO(tQ)+")"),a(this,"_dragOffset",null),a(this,"_groupLocations",[]),a(this,"_intersectingGroups",[]),a(this,"_currentDragParentGroup",null),a(this,"_dragGroupByElementIdMap",{}),a(this,"_dragGroupMap",{}),a(this,"_currentDragGroup",null),a(this,"_currentDragGroupOffsets",new Map),a(this,"_currentDragGroupSizes",new Map),a(this,"_currentDragGroupOriginalPositions",new Map),a(this,"_dragPayload",null),a(this,"drag",void 0),a(this,"originalPosition",void 0)}return r(t,[{key:"onDragInit",value:function(t){return null}},{key:"onDragAbort",value:function(t){return null}},{key:"getDropGroup",value:function(){var t=null;if(this._intersectingGroups.length>0){var e=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i===e||null!=i&&i.overrideDrop(n,e)||(t=this._intersectingGroups[0])}return t}},{key:"onStop",value:function(t){var e,n=this,i=t.drag.getDragElement(),o=this.getDropGroup(),s=[];function r(t,e,n,i,r){var a=n.x,l=n.y;if(t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain){var u={w:t.parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop};a=Math.max(a,0),l=Math.max(l,0),a=Math.min(a,u.w-i.w),l=Math.min(l,u.h-i.h),n.x=a,n.y=l}s.push({el:t,id:e,pos:n,originalPos:r,originalGroup:t._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null==o?void 0:o.groupLoc.group})}if(s.push({el:i,id:this.instance.getId(i),pos:t.finalPos,originalGroup:i._jsPlumbParentGroup,redrawResult:null,originalPos:t.originalPos,reverted:!1,dropGroup:null!=o?o.groupLoc.group:null}),this._dragSelection.each(function(e,n,i,o,s){e!==t.el&&r(e,n,{x:i.x,y:i.y},o,s)}),null===(e=this._currentDragGroup)||void 0===e||e.members.forEach(function(e){if(e.el!==t.el){var i=n._currentDragGroupOffsets.get(e.elId),o=n._currentDragGroupSizes.get(e.elId),s={x:t.finalPos.x+i[0].x,y:t.finalPos.y+i[0].y};r(e.el,e.elId,s,o,n._currentDragGroupOriginalPositions.get(e.elId))}}),M(s,function(t){var e=null!=t.originalGroup,i=e&&nL(n.instance,t.el,t.pos),s={x:0,y:0};if(e&&!i){if(null==o){var r=n._pruneOrOrphan(t,!0,!0);null!=r.pos?t.pos=r.pos.pos:!r.pruned&&t.originalGroup.revert&&(t.pos=t.originalPos,t.reverted=!0)}}else e&&i&&(s=n._computeOffsetByParentGroup(t.originalGroup));null==o||i?t.dropGroup=null:n.instance.groupManager.addToGroup(o.groupLoc.group,!1,t.el),t.reverted&&n.instance.setPosition(t.el,t.pos),t.redrawResult=n.instance.setElementPosition(t.el,t.pos.x+s.x,t.pos.y+s.y),n.instance.removeClass(t.el,"jtk-dragged"),n.instance.select({source:t.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.sourceElementDraggingClass,!0),n.instance.select({target:t.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.targetElementDraggingClass,!0)}),null!=s[0].originalGroup){var a=i._jsPlumbParentGroup;if(a!==s[0].originalGroup){var l=t.drag.getDragElement(!0);if(s[0].originalGroup.ghost){var u=this.instance.getPosition(this.instance.getGroupContentArea(a)),c=this.instance.getPosition(this.instance.getGroupContentArea(s[0].originalGroup)),h={x:c.x+t.pos.x-u.x,y:c.y+t.pos.y-u.y};l.style.left=h.x+"px",l.style.top=h.y+"px",this.instance.revalidate(l)}}}this.instance.fire("drag:stop",{elements:s,e:t.e,el:i,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var t=this;M(this._groupLocations,function(e){t.instance.removeClass(e.el,n2),t.instance.removeClass(e.el,n5)}),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(t){this.drag=t}},{key:"onDrag",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getId(n),o=t.pos,s=this.instance.viewport.getPosition(i),r={x:o.x,y:o.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(r.x+=this._dragOffset.x,r.y+=this._dragOffset.y);var a=function(n,i,o){if(o){var s=new Set;M(e._groupLocations,function(n){!s.has(n.group.id)&&nO(i,n.r)?(n.group!==e._currentDragParentGroup&&e.instance.addClass(n.el,n5),e._intersectingGroups.push({groupLoc:n,intersectingElement:t.drag.getDragElement(!0),d:0}),M(e.instance.groupManager.getAncestors(n.group),function(t){return s.add(t.id)})):e.instance.removeClass(n.el,n5)})}e.instance.setElementPosition(n,i.x,i.y),e.instance.fire("drag:move",{el:n,e:t.e,pos:{x:i.x,y:i.y},originalPosition:e.originalPosition,payload:e._dragPayload})},l={x:r.x,y:r.y,w:s.w,h:s.h};a(n,l,!0),this._dragSelection.updatePositions(o,this.originalPosition,function(t,e,n,i){a(t,i,!1)}),this._currentDragGroupOffsets.forEach(function(t,n){var i=e._currentDragGroupSizes.get(n),o={x:l.x+t[0].x,y:l.y+t[0].y,w:i.w,h:i.h};t[1].style.left=o.x+"px",t[1].style.top=o.y+"px",a(t[1],o,!1)})}},{key:"_computeOffsetByParentGroup",value:function(t){var e=this.instance.getPosition(t.el),n=t.contentArea;if(n!==t.el){var i=this.instance.getPosition(n);e.x+=i.x,e.y+=i.y}if(t.el._jsPlumbParentGroup){var o=this._computeOffsetByParentGroup(t.el._jsPlumbParentGroup);e.x+=o.x,e.y+=o.y}return e}},{key:"onStart",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getPosition(n);this.originalPosition={x:t.pos.x,y:t.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(n._jsPlumbParentGroup),this._currentDragParentGroup=n._jsPlumbParentGroup);var o=!0,s=n.getAttribute(tz);if((!1===this.instance.elementsDraggable||null!=s&&s!==ns)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var r,a=t.drag.getDragElement(!0),l=a.querySelectorAll(en),u=function(t){for(var e=[],n=t._jsPlumbParentGroup;null!=n;)e.push(n.el),n=n.group;return e}(a),c=[];Array.prototype.push.apply(c,l),Array.prototype.push.apply(c,u),this._dragSelection.filterActiveSet(function(t){return -1===c.indexOf(t.jel)}),this._dragSelection.initialisePositions();var h=function(n,i,o){if(!n._isJsPlumbGroup||e.instance.allowNestedGroups){var s=!n._jsPlumbParentGroup,r=s||!0!==n._jsPlumbParentGroup.dropOverride,a=!s&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(s||r&&a)&&(M(e.instance.groupManager.getGroups(),function(t){var i=n._jsPlumbGroup;if(!1!==t.droppable&&!1!==t.enabled&&n._jsPlumbGroup!==t&&!e.instance.groupManager.isDescendant(t,i)){var o=t.el,s=e.instance.getId(o),r=e.instance.viewport.getPosition(s),a={x:r.x,y:r.y,w:r.w,h:r.h};e._groupLocations.push({el:o,r:a,group:t}),t!==e._currentDragParentGroup&&e.instance.addClass(o,n2)}}),e._groupLocations.sort(function(t,n){return e.instance.groupManager.isDescendant(t.group,n.group)?-1:e.instance.groupManager.isAncestor(n.group,t.group)?1:0}))}return e.instance.select({source:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0),e.instance.fire("drag:start",{el:n,e:t.e,originalPosition:e.originalPosition,pos:e.originalPosition,dragGroup:i,dragGroupMemberSpec:o})},d=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[d],this._currentDragGroup&&(null===(r=j(this._currentDragGroup.members,function(t){return t.el===n}))||!0!==r.active)&&(this._currentDragGroup=null);var p=h(n);if(!1===p)return this._cleanup(),!1;this._dragPayload=p,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach(function(t){var n=e.instance.viewport.getPosition(t.elId);e._currentDragGroupOffsets.set(t.elId,[{x:n.x-i.x,y:n.y-i.y},t.el]),e._currentDragGroupSizes.set(t.elId,n),e._currentDragGroupOriginalPositions.set(t.elId,{x:n.x,y:n.y}),h(t.el,e._currentDragGroup,t)}))}return o}},{key:"addToDragGroup",value:function(t){var e=this,n=(this.instance,k(t)?{id:t,active:!0}:{id:t.id,active:t.active}),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var o=arguments.length,s=Array(o>1?o-1:0),r=1;r<o;r++)s[r-1]=arguments[r];this.removeFromDragGroup.apply(this,s),M(s,function(t){var o=e.instance.getId(t);i.members.add({elId:o,el:t,active:n.active}),e._dragGroupByElementIdMap[o]=i})}},{key:"removeFromDragGroup",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];M(n,function(e){var n=t.instance.getId(e),i=t._dragGroupByElementIdMap[n];if(null!=i){var o=new Set;i.members.forEach(function(t){t.el!==e&&o.add(t)}),i.members=o,delete t._dragGroupByElementIdMap[n]}})}},{key:"setDragGroupState",value:function(t){for(var e=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];M(i.map(function(t){return e.instance.getId(t)}),function(n){var i=e._dragGroupByElementIdMap[n];if(null!=i){var o=j(i.members,function(t){return t.elId===n});null!=o&&(o.active=t)}})}},{key:"clearDragGroup",value:function(t){var e=this,n=this._dragGroupMap[t];null!=n&&(n.members.forEach(function(t){delete e._dragGroupByElementIdMap[t.elId]}),n.members.clear())}},{key:"_pruneOrOrphan",value:function(t,e,n){var i=t.el,o={pruned:!1,pos:null};if(n||!nL(this.instance,i,t.pos)){var s=i._jsPlumbParentGroup;s.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):s.remove(t.el,!0),o.pruned=!0):s.orphan&&(o.pos=this.instance.groupManager.orphan(t.el,e),i._isJsPlumbGroup?s.removeGroup(i._jsPlumbGroup):s.remove(t.el))}return o}}]),t}(),n6={},n9={},n8={},n7={get:function(t,e,n){var i=n6[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown endpoint type '"+e+"'"}},clone:function(t){var e=n8[t.type];return n7.get(t.endpoint,t.type,e.getParams(t))},compute:function(t,e,n,i){var o=n9[t.type];if(null!=o)return o(t,e,n,i);tf("jsPlumb: cannot find endpoint calculator for endpoint of type ",t.type)},registerHandler:function(t){n8[t.type]=t,n6[t.type]=t.cls,n9[t.type]=t.compute}},it=function(){function t(e,n){o(this,t),this.endpoint=e,a(this,"typeId",void 0),a(this,"x",void 0),a(this,"y",void 0),a(this,"w",void 0),a(this,"h",void 0),a(this,"computedValue",void 0),a(this,"bounds",nt()),a(this,"classes",[]),a(this,"instance",void 0),a(this,"type",void 0),n=n||{},this.instance=e.instance,e.cssClass&&this.classes.push(e.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return r(t,[{key:"addClass",value:function(t){this.classes.push(t),this.instance.addEndpointClass(this.endpoint,t)}},{key:"removeClass",value:function(t){this.classes=this.classes.filter(function(e){return e!==t}),this.instance.removeEndpointClass(this.endpoint,t)}},{key:"compute",value:function(t,e,n){this.computedValue=n7.compute(this,t,e,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(t){this.instance.setEndpointVisible(this.endpoint,t)}}]),t}();(Y=tr||(tr={})).top="top",Y.left="left",Y.right="right",Y.bottom="bottom";var ie=tr.top,ii=tr.left,io=tr.right,is=tr.bottom,ir=[ii,io],ia=[ie,is],il=function(){function t(e,n,i){o(this,t),this.instance=e,this.element=n,a(this,"isFloating",!0),a(this,"isContinuous",void 0),a(this,"isDynamic",void 0),a(this,"locations",[]),a(this,"currentLocation",0),a(this,"locked",!1),a(this,"cssClass",""),a(this,"timestamp",null),a(this,"type","Floating"),a(this,"id",th()),a(this,"orientation",[0,0]),a(this,"size",void 0),this.size=e.viewport.getPosition(i),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return r(t,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(t){this.orientation=this.instance.router.getEndpointOrientation(t),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),t}(),iu=(a(ti={},ie,is),a(ti,io,ii),a(ti,ii,io),a(ti,is,ie),ti),ic=(a(to={},ie,io),a(to,io,is),a(to,ii,ie),a(to,is,ii),to),ih=(a(ts={},ie,ii),a(ts,io,ie),a(ts,ii,is),a(ts,is,io),ts);function id(t,e){return -1!==t.faces.indexOf(e)}function ip(t,e){return null==t.lockedAxis?null==t.lockedFace?!0===id(t,e):t.lockedFace===e:-1!==t.lockedAxis.indexOf(e)}var iv={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},ig={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},iy={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},im={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},i_={Top:[iv],Bottom:[ig],Left:[iy],Right:[im],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[iv,iy,ig,im]},ix={Continuous:{faces:[ie,ii,is,io]},ContinuousTop:{faces:[ie]},ContinuousRight:{faces:[io]},ContinuousBottom:{faces:[is]},ContinuousLeft:{faces:[ii]},ContinuousLeftRight:{faces:[ii,io]},ContinuousTopBottom:{faces:[ie,is]}};function ik(t,e){if(e=e||{},t===$.Perimeter)return function(t){var e=(t=t||{}).anchorCount||60,n=t.shape;if(!n)throw Error("no shape supplied to Perimeter Anchor type");if(!iM.has(n))throw Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var i=iM.get(n)(e);return t.rotation&&(i=function(t,e){for(var n=[],i=e/180*Math.PI,o=0;o<t.length;o++){var s=t[o].x-.5,r=t[o].y-.5;n.push({x:.5+(s*Math.cos(i)-r*Math.sin(i)),y:.5+(s*Math.sin(i)+r*Math.cos(i)),ox:t[o].ox,oy:t[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(i,t.rotation)),_(ib($.Perimeter,i,t),{shape:n})}(e);var n,i,o,s=i_[t];if(null!=s)return ib(t,tv(s,function(t){return _({iox:t.ox,ioy:t.oy},t)}),e);if(null!=(s=ix[t]))return n=s.faces,i=e,Object.defineProperty(o={type:t,locations:[],currentLocation:0,locked:!1,id:th(),cssClass:i.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:i.faces||n,lockedFace:null,lockedAxis:null,clockwise:!1!==i.clockwise,__currentFace:null},"currentFace",{get:function(){return this.__currentFace},set:function(t){this.__currentFace=function(t,e){if(id(t,e));else{if(id(t,iu[e]))return iu[e];var n=(t.clockwise?ic:ih)[e];if(id(t,n))return n;var i=(t.clockwise?ih:ic)[e];if(id(t,i))return i}return e}(this,t)}}),o;throw{message:"jsPlumb: unknown anchor type '"+t+"'"}}function ib(t,e,n){return{type:t,locations:e,currentLocation:0,locked:!1,id:th(),isFloating:!1,isContinuous:!1,isDynamic:e.length>1,timestamp:null,cssClass:n.cssClass||""}}function iC(t){return t.length<7&&t.every(x)||7===t.length&&t.slice(0,5).every(x)&&k(t[6])}function iE(t){return k(t)?ik(t,null):Array.isArray(t)?iC(t)?ib(null,[{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}],{cssClass:t[6]||""}):ib("Dynamic",tv(t,function(t){if(k(t)){var e=i_[t];return null!=e?_({iox:e[0].ox,ioy:e[0].oy,cls:""},e[0]):null}if(iC(t))return{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}}).filter(function(t){return null!=t}),{}):ik(t.type,t.options)}function iP(t){for(var e=2*Math.PI/t,n=[],i=0,o=0;o<t;o++){var s=.5+.5*Math.sin(i),r=.5+.5*Math.cos(i);n.push({x:s,y:r,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),i+=e}return n}function iS(t,e){for(var n=[],i=0;i<t.length;i++)n.push([t[i][0],t[i][1],t[i][2],t[i][3],1/t.length,t[i][4],t[i][5]]);return function(t,e){for(var n=e/t.length,i=[],o=function(t,o,s,r,a,l,u){for(var c=(s-t)/(n=e*a),h=(r-o)/n,d=0;d<n;d++)i.push({x:t+c*d,y:o+h*d,ox:null==l?0:l,oy:null==u?0:u,offx:0,offy:0,iox:0,ioy:0,cls:""})},s=0;s<t.length;s++)o.apply(null,t[s]);return i}(n,e)}function iw(t){return iS([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],t)}var iM=new Map;iM.set(K.Circle,iP),iM.set(K.Ellipse,iP),iM.set(K.Rectangle,iw),iM.set(K.Square,iw),iM.set(K.Diamond,function(t){return iS([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],t)}),iM.set(K.Triangle,function(t){return iS([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],t)});var iA=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o(this,t),this.selector=e,this.def=n,this.exclude=i,a(this,"id",void 0),a(this,"redrop",void 0),this.id=th(),this.redrop=n.def.redrop||iD}return r(t,[{key:"setEnabled",value:function(t){this.def.enabled=t}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),t}(),iD="strict",ij=tO(n2,n5),iT="sourceSelectorEndpoint",iI=function(){function t(e){o(this,t),this.instance=e,a(this,"jpc",void 0),a(this,"existingJpc",void 0),a(this,"_originalAnchorSpec",void 0),a(this,"ep",void 0),a(this,"endpointRepresentation",void 0),a(this,"canvasElement",void 0),a(this,"_activeDefinition",void 0),a(this,"placeholderInfo",{id:null,element:null}),a(this,"floatingIndex",void 0),a(this,"floatingId",void 0),a(this,"floatingElement",void 0),a(this,"floatingEndpoint",void 0),a(this,"floatingAnchor",void 0),a(this,"_stopped",void 0),a(this,"inPlaceCopy",void 0),a(this,"endpointDropTargets",[]),a(this,"currentDropTarget",null),a(this,"payload",void 0),a(this,"floatingConnections",{}),a(this,"_forceReattach",void 0),a(this,"_forceDetach",void 0),a(this,"mousedownHandler",void 0),a(this,"mouseupHandler",void 0),a(this,"selector",tO(tZ));var n=e.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),e.on(n,eE,en,this.mousedownHandler),e.on(n,eM,[en,tO(tZ)].join(","),this.mouseupHandler)}return r(t,[{key:"_resolveDragParent",value:function(t,e){var n=this.instance.getContainer(),i=tb(e,en,n,!0);if(null==t.parentSelector)return i;var o=tb(e,t.parentSelector,n,!0);return null!=o&&(i=tb(o.parentNode,en,n,!1)),o||i}},{key:"_mousedownHandler",value:function(t){if(3!==t.which&&2!==t.button){var e=t.target||t.srcElement;if((null==(i=this._getSourceDefinition(t))||null!=(n=this._resolveDragParent(i.def.def,e))&&n.getAttribute(ef)!==ns)&&i){var n,i,o,s=t.currentTarget;if(e.getAttribute(ef)!==ns){if(tk(t),this._activeDefinition=i,null!=(o=i.def.def).canAcceptNewConnection&&!o.canAcceptNewConnection(n,t))return!1;var r=oN(t,n,this.instance.currentZoom),a={element:n};if(_(a,o),a.isTemporarySource=!0,o.scope)a.scope=o.scope;else{var l=e.getAttribute(eg);null!=l&&(a.scope=l)}if(null!=(a=S(a,o.parameterExtractor?o.parameterExtractor(n,e,t):{})).maxConnections&&a.maxConnections>=0&&this.instance.select({source:n}).length>=a.maxConnections)return tk(t),o.onMaxConnections&&o.onMaxConnections({element:n,maxConnections:a.maxConnections},t),t.stopImmediatePropagation&&t.stopImmediatePropagation(),!1;if(o.anchorPositionFinder){var u=o.anchorPositionFinder(n,r,o,t);null!=u&&(a.anchor=u)}this._originalAnchorSpec=a.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var c=this.instance.router.prepareAnchor(this._originalAnchorSpec),h=[r.x,r.y,0,0];if(c.locations.length>0)h[2]=c.locations[0].ox,h[3]=c.locations[0].oy;else if(c.isContinuous){var d=r.x<.5?r.x:1-r.x,p=r.y<.5?r.y:1-r.y;h[2]=d<p?r.x<.5?-1:1:0,h[3]=p<d?r.y<.5?-1:1:0}a.anchor=h,a.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(a);var v={};if(o.extract){for(var f in o.extract){var g=e.getAttribute(f);g&&(v[o.extract[f]]=g)}this.ep.mergeParameters(v)}if(a.uniqueEndpoint){var y=this.ep.elementId,m=this.instance.getManagedData(y,iT,i.id);null==m?(this.instance.setManagedData(y,iT,i.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=m}s._jsPlumbOrphanedEndpoints=s._jsPlumbOrphanedEndpoints||[],s._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,eE,t,v)}}}}},{key:"_mouseupHandler",value:function(t){var e=t.currentTarget||t.srcElement;e._jsPlumbOrphanedEndpoints&&(function(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])}(e._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),e._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(t){var e=tj(t,this.instance),n=tT(t,this.instance);return this._makeDraggablePlaceholder(e,n),this.placeholderInfo.element.jtk=t.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(t){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(t,e){this.placeholderInfo=this.placeholderInfo||{};var n=tA(null,"div",{position:"absolute"},void 0,void 0);this.instance._appendElementToContainer(n);var i=this.instance.getId(n);return this.instance.setPosition(n,t),n.style.width=e.w+"px",n.style.height=e.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var t=this.instance.getContainer();this.instance.off(t,eM,this.mouseupHandler),this.instance.off(t,eE,this.mousedownHandler)}},{key:"init",value:function(t){}},{key:"startNewConnectionDrag",value:function(t,e){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:t,data:e}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(eT,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var t=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(eT,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[t].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,t),this.jpc.suspendedEndpoint=this.jpc.endpoints[t],this.jpc.suspendedElement=this.jpc.endpoints[t].element,this.jpc.suspendedElementId=this.jpc.endpoints[t].elementId,this.jpc.suspendedElementType=0===t?tL:tF,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[t]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=t,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var t=!0;this.ep.enabled||(t=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(t=!1),this.ep.isSource&&this.ep.isFull()&&!(null!=this.jpc&&this.ep.dragAllowedWhenFull)&&(t=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?t=!1:this.jpc=null);var e={},n=this.instance.checkCondition(null==this.jpc?"beforeDrag":"beforeStartDetach",{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===n?t=!1:"object"===i(n)?_(e=n,this.payload||{}):e=this.payload||{},[t,e]}},{key:"_createFloatingEndpoint",value:function(t){var e,n,i,o,s,r,a,l,u=this.ep.endpoint;null!=this.ep.edgeType&&(u=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]),this.floatingEndpoint=(e=this.ep,n=u,i=this.placeholderInfo.element,o=this.placeholderInfo.id,r=new il(s=this.instance,i,o),a={paintStyle:e.getPaintStyle(),preparedAnchor:r,element:i,scope:e.scope,cssClass:[tJ,e.cssClass].join(" ")},null!=n&&(t_(n,it)?a.existingEndpoint=n:a.endpoint=n),l=s._internal_newEndpoint(a),s._paintEndpoint(l,{}),l),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(t,e){var n,i,o=this,s=this.jpc&&this.jpc.endpoints[0]===this.ep;if(M(this.instance.getContainer().querySelectorAll([".",tZ,"[",tU,this.ep.scope,"]:not(.",tJ,")"].join("")),function(e){if((null!=o.jpc||e!==t)&&e!==o.floatingElement&&(null!=o.jpc||!e.jtk.endpoint.isFull())&&(s&&e.jtk.endpoint.isSource||!s&&e.jtk.endpoint.isTarget)){var n=tj(e,o.instance),r=tT(e,o.instance);i={x:n.x,y:n.y,w:r.w,h:r.h},o.endpointDropTargets.push({el:e,targetEl:e,r:i,endpoint:e.jtk.endpoint,def:null}),o.instance.addClass(e,n2)}}),s){var r=D(this.instance.sourceSelectors,function(t){return t.isEnabled()&&(null==t.def.def.scope||t.def.def.scope===o.ep.scope)});null!=r&&M(this._findTargetZones(r),function(t){if(t.getAttribute(ef)!==ns){var e=t.getAttribute(eg);if(null==e||e===o.ep.scope){var n={r:null,el:t};n.targetEl=tb(t,en,o.instance.getContainer(),!0);var i=tj(n.el,o.instance),s=tT(n.el,o.instance);n.r={x:i.x,y:i.y,w:s.w,h:s.h},null!=r.def.def.rank&&(n.rank=r.def.def.rank),n.def=r.def,o.endpointDropTargets.push(n),o.instance.addClass(n.targetEl,n2)}}})}else(function(t,e){var n=[];if(t)for(var i=0;i<t.length;i++)e(t[i])&&n.push(i);return n})(n=this.instance.targetSelectors,function(t){return t.isEnabled()}).map(function(t){return n[t]}).forEach(function(t){M(o._findTargetZones(t),function(n){if(n.getAttribute(ef)!==ns){var i=n.getAttribute(eg);if(null==i||i===o.ep.scope){var s={r:null,el:n};if(null!=t.def.def.parentSelector&&(s.targetEl=tb(n,t.def.def.parentSelector,o.instance.getContainer(),!0)),null==s.targetEl&&(s.targetEl=tb(n,en,o.instance.getContainer(),!0)),(!1!==t.def.def.allowLoopback&&(!o._activeDefinition||!1!==o._activeDefinition.def.def.allowLoopback)||s.targetEl!==o.ep.element)&&(null==t.def.def.canAcceptNewConnection||t.def.def.canAcceptNewConnection(s.targetEl,e))){var r=t.def.def.maxConnections;if(null!=r&&-1!==r&&o.instance.select({target:s.targetEl}).length>=r)return;var a=tj(n,o.instance),l=tT(n,o.instance);s.r={x:a.x,y:a.y,w:l.w,h:l.h},s.def=t.def,null!=t.def.def.rank&&(s.rank=t.def.def.rank),o.endpointDropTargets.push(s),o.instance.addClass(s.targetEl,n2)}}}})});this.endpointDropTargets.sort(function(t,e){if(t.targetEl._isJsPlumbGroup&&!e.targetEl._isJsPlumbGroup)return 1;if(!t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup)return -1;if(t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup){if(o.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return -1;if(o.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return 1}else{if(null==t.rank||null==e.rank)return 0;if(t.rank>e.rank)return -1;if(t.rank<e.rank)return 1}})}},{key:"_findTargetZones",value:function(t){var e;if("any"===t.redrop){var n=this.instance.targetSelectors.map(function(t){return t.selector});n.push.apply(n,f(this.instance.sourceSelectors.map(function(t){return t.selector}))),n.push(en),e=n.join(",")}else if(t.redrop===iD)e=t.selector;else if("anySource"===t.redrop)e=this.instance.sourceSelectors.map(function(t){return t.selector}).join(",");else if("anyTarget"===t.redrop)e=this.instance.targetSelectors.map(function(t){return t.selector}).join(",");else if("anySourceOrTarget"===t.redrop){var i=this.instance.targetSelectors.map(function(t){return t.selector});i.push.apply(i,f(this.instance.sourceSelectors.map(function(t){return t.selector}))),e=i.join(",")}return this.instance.getContainer().querySelectorAll(e)}},{key:"onStart",value:function(t){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var e=t.drag.getDragElement();if(this.ep=e.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var n=v(this._shouldStartDrag(),2),i=n[0],o=n[1];if(!1===i)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,t.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,o):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(t){this.payload=t.e.payload||{}}},{key:"onDrag",value:function(t){if(this._stopped)return!0;if(this.placeholderInfo.element){var e=tT(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,t.pos.x,t.pos.y);for(var n,i,o={x:t.pos.x,y:t.pos.y,w:e.w,h:e.h},s=0;s<this.endpointDropTargets.length;s++)if(nO(o,this.endpointDropTargets[s].r)){n=this.endpointDropTargets[s];break}n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,n5),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n&&(this.instance.addClass(n.el,n5),i=this._getFloatingAnchorIndex(),null!=n.endpoint&&(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id?(this.instance.checkCondition("checkDropAllowed",{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc)):n=null)),this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(t){t._mtNew&&0===t.connections.length?this.instance.deleteEndpoint(t):delete t._mtNew}},{key:"_reattachOrDiscard",value:function(t){var e=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return e&&this._shouldReattach()?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,t),!1)}},{key:"onStop",value:function(t){var e=this,n=t.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.join(" ")}(n5,n2);if(M(this.instance.getContainer().querySelectorAll(ij),function(t){e.instance.removeClass(t,i)}),this.jpc&&null!=this.jpc.endpoints){var o,s=null!=this.jpc.suspendedEndpoint,r=this._getFloatingAnchorIndex(),a=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget){if(null==(o=this._getDropEndpoint(t,this.jpc)))this._reattachOrDiscard(t.e);else if(a&&a.id===o.id)this._doForceReattach(r);else if(o.enabled){if(o.isFull())o.fire(t6,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(t.e);else{0===r?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var l=!0;!s||this.jpc.suspendedEndpoint.id===o.id||this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[r].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(l=!1),(l=l&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,r,n,l):this._reattachOrDiscard(t.e)}}else this._reattachOrDiscard(t.e)}else this._reattachOrDiscard(t.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(t){for(var e,n=this.instance.getContainer(),i=0;i<this.instance.sourceSelectors.length;i++)if((e=this.instance.sourceSelectors[i]).isEnabled()&&!1!==function(t,e,n,i,o){for(var s=t.target||t.srcElement,r=!1,a=i.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===s){r=!0;break}return o?!r:r}(t,n,e.selector,this.instance,e.exclude))return e}},{key:"_getDropEndpoint",value:function(t,e){var n;if(null==this.currentDropTarget.endpoint){var i=this.currentDropTarget.def,o=t.e.target||t.e.srcElement;if(null==i)return null;var s=this.currentDropTarget.targetEl,r=oN(t.e,s,this.instance.currentZoom),a=this.instance._deriveEndpointAndAnchorSpec(e.getType().join(" "),!0),l=a.endpoints?_(t,{endpoint:i.def.endpoint||a.endpoints[1],cssClass:i.def.cssClass||"",source:!0===i.def.source,target:!0===i.def.target}):t,u=this.instance.validAnchorsSpec(a.anchors)?a.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,c=i.def.anchor,h=i.def.anchorPositionFinder?i.def.anchorPositionFinder(s,r,i.def,t.e):null,d=null!=h?h:null!=c?c:null!=u&&null!=u[1]?u[1]:null;if(null!=d&&(l=_(l,{anchor:d})),null!=i.def.portId&&(l.portId=i.def.portId),(l=S(l,i.def.parameterExtractor?i.def.parameterExtractor(this.currentDropTarget.el,o,t.e):{})).element=s,(n=this.instance._internal_newEndpoint(l))._mtNew=!0,n.deleteOnEmpty=!0,i.def.parameters&&n.mergeParameters(i.def.parameters),i.def.extract){var p={};for(var v in i.def.extract){var f=this.currentDropTarget.el.getAttribute(v);f&&(p[i.def.extract[v]]=f)}n.mergeParameters(p)}}else n=this.currentDropTarget.endpoint;return n&&(n.removeClass(this.instance.endpointDropAllowedClass),n.removeClass(this.instance.endpointDropForbiddenClass)),n}},{key:"_doForceReattach",value:function(t){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,t),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var t=this.jpc.suspendedEndpoint,e=this.jpc.suspendedElementType==tL?1:0,n=this.jpc.endpoints[e];return!w(!0,!1,[[t,t7,[this.jpc]],[n,t7,[this.jpc]],[this.jpc,t7,[this.jpc]],[this.instance,tW,[ee,this.jpc]]])}},{key:"_discard",value:function(t,e){this.jpc.pending?this.instance.fire("connection:abort",this.jpc,e):(0===t?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:e,force:!0})}},{key:"_drop",value:function(t,e,n,i){if(this.jpc.endpoints[e].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[e]=t,t.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:e,originalSourceId:0===e?o:this.jpc.sourceId,newSourceId:0===e?t.elementId:this.jpc.sourceId,originalTargetId:1===e?o:this.jpc.targetId,newTargetId:1===e?t.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:t},n)}1===e?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)),C(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(t,e){this.floatingConnections[t.id]=e}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),t}(),iO=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),(s=e.call(this,t,i)).instance=t,s.dragSelection=i,a(h(s),"selector",[">",e9,en].join(" ")),a(h(s),"doRevalidate",void 0),s.doRevalidate=s._revalidate.bind(h(s)),s}return r(n,[{key:"reset",value:function(){this.drag.off(ej,this.doRevalidate)}},{key:"_revalidate",value:function(t){this.instance.revalidate(t)}},{key:"init",value:function(t){this.drag=t,t.on(ej,this.doRevalidate)}},{key:"useGhostProxy",value:function(t,e){var n=e._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function(t){var e=t.cloneNode(!0);return e._jsPlumbParentGroup=t._jsPlumbParentGroup,e}}]),n}(n4),iG=function(){function t(e,n){o(this,t),this.instance=e,this.overlay=n,a(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return r(t,null,[{key:"getElement",value:function(t,e,n){if(null==t.canvas){if(n&&e){t.canvas=n(e);var i=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.canvas,i)}else t.canvas=tA(null,"div",{},t.instance.overlayClass+" "+(t.cssClass?t.cssClass:""),void 0);for(var o in t.instance.setAttribute(t.canvas,"jtk-overlay-id",t.id),t.attributes)t.instance.setAttribute(t.canvas,o,t.attributes[o]);t.canvas.style.position=tN,t.instance._appendElement(t.canvas,t.instance.getContainer()),t.instance.getId(t.canvas);var s="translate(-50%, -50%)";t.canvas.style.webkitTransform=s,t.canvas.style.mozTransform=s,t.canvas.style.msTransform=s,t.canvas.style.oTransform=s,t.canvas.style.transform=s,t.isVisible()||(t.canvas.style.display=tR),t.canvas.jtk={overlay:t}}return t.canvas}},{key:"destroy",value:function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.cachedDimensions}},{key:"_getDimensions",value:function(t,e){return(null==t.cachedDimensions||e)&&(t.cachedDimensions={w:1,h:1}),t.cachedDimensions}}]),t}(),iL=function(){function t(){o(this,t),a(this,"_listeners",{}),a(this,"eventsSuspended",!1),a(this,"tick",!1),a(this,"eventsToDieOn",{ready:!0}),a(this,"queue",[])}return r(t,[{key:"fire",value:function(t,e,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var o=this._listeners[t].length,s=0,r=!1;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n))for(;!r&&s<o&&!1!==i;){if(this.eventsToDieOn[t])this._listeners[t][s](e,n);else try{i=this._listeners[t][s](e,n)}catch(e){tf("jsPlumb: fire failed for event "+t+" : "+(e.message||e))}s++,(null==this._listeners||null==this._listeners[t])&&(r=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var t=this.queue.pop();t&&this.fire.apply(this,t)}},{key:"unbind",value:function(t,e){if(0==arguments.length)this._listeners={};else if(1==arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n;for(var i in t.__jsPlumb)n=t.__jsPlumb[i],O(this._listeners[n]||[],t)}}else 2==arguments.length&&O(this._listeners[t]||[],e);return this}},{key:"getListener",value:function(t){return this._listeners[t]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(t){this.eventsSuspended=t}},{key:"bind",value:function(t,e,n){var i=this,o=function(t){G(i._listeners,t,e,n),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[th()]=t};if("string"==typeof t)o(t);else if(null!=t.length)for(var s=0;s<t.length;s++)o(t[s]);return this}},{key:"silently",value:function(t){this.setSuspendEvents(!0);try{t()}catch(t){tf("Cannot execute silent function "+t)}this.setSuspendEvents(!1)}}]),t}();function iF(t){var e=null;return(e=k(t)?{type:t,options:{}}:t).options.id=e.options.id||th(),e}!function(t){l(n,t);var e=d(n);function n(){return o(this,n),e.apply(this,arguments)}r(n,[{key:"shouldFireEvent",value:function(t,e,n){return!0}}])}(iL);var iH=function(t){l(n,t);var e=d(n);function n(t,i,s){var r;for(var l in o(this,n),(r=e.call(this)).instance=t,r.component=i,a(h(r),"id",void 0),a(h(r),"type",void 0),a(h(r),"cssClass",void 0),a(h(r),"visible",!0),a(h(r),"location",void 0),a(h(r),"events",void 0),a(h(r),"attributes",void 0),s=s||{},r.id=s.id||th(),r.cssClass=s.cssClass||"",r.setLocation(s.location),r.events=s.events||{},r.attributes=s.attributes||{},r.events)r.bind(l,r.events[l]);return r}return r(n,[{key:"setLocation",value:function(t){var e=null==this.location?.5:this.location;if(null!=t)try{var n="string"==typeof t?parseFloat(t):t;isNaN(n)||(e=n)}catch(t){}this.location=e}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"setVisible",value:function(t){this.visible=t,this.instance.setOverlayVisible(this,t)}},{key:"isVisible",value:function(){return this.visible}}]),n}(iL),iR={},iN={get:function(t,e,n,i){var o=iR[e];if(o)return new o(t,n,i);throw{message:"jsPlumb: unknown overlay type '"+e+"'"}},register:function(t,e){iR[t]=e}},iB=function(t){l(n,t);var e=d(n);function n(t,i,s){var r;return o(this,n),(r=e.call(this,t,i,s)).instance=t,r.component=i,a(h(r),"label",void 0),a(h(r),"labelText",void 0),a(h(r),"type",n.type),a(h(r),"cachedDimensions",void 0),s=s||{label:""},r.setLabel(s.label),r}return r(n,[{key:"getLabel",value:function(){return E(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(t){this.label=t,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(t){null!=t.label&&this.setLabel(t.label),null!=t.location&&(this.setLocation(t.location),this.instance.updateLabel(this))}}]),n}(iH);function iY(t){return t.type===iB.type}function iX(t){return null==t?null:t.split(" ").filter(function(t){return null!=t&&t.length>0})}function iz(t,e,n){for(var i in e)t[i]=n}a(iB,"type","Label"),iN.register(iB.type,iB);var iV="__default",iU="__label",iW="overlay",iq="remove";function iZ(t,e){if(t.getDefaultType){var n,i,o=t.getTypeDescriptor(),s={},r=t.getDefaultType(),a=_({},r);iz(s,r,iV),t._types.forEach(function(e){if(e!==iV){var n=t.instance.getType(e,o);if(null!=n){var i,r=new Set(["connector","anchor","anchors"]);if("override"===n.mergeStrategy)for(var l in n)r.add(l);a=S(a,n,["cssClass"],(i=[],r.forEach(function(t){i.push(t)}),i)),iz(s,n,e)}}}),e&&(n=a,i=function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=e[n[i].substring(2,n[i].length-1)]||"";null!=o&&(t=t.replace(n[i],o))}if(null!=(n=t.match(/({{.*?}})/g)))for(var s=0;s<n.length;s++){var r=e[n[s].substring(2,n[s].length-2)]||"";null!=r&&(t=t.replace(n[s],r))}return t},a=function t(n){if(null!=n){if(k(n))return i(n);if(E(n)&&0===(n.name||"").indexOf("_"))return n(e);if(Array.isArray(n)){for(var o=[],s=0;s<n.length;s++)o.push(t(n[s]));return o}if(!C(n))return n;var r={};for(var a in n)r[a]=t(n[a]);return r}}(n)),t.applyType(a,s)}}function iJ(t,e){var n=t.instance.getType(e,t.getTypeDescriptor());null!=n&&n.cssClass&&t.removeClass(n.cssClass)}function iK(t){if(t.paintStyle&&t.hoverPaintStyle){var e={};_(e,t.paintStyle),_(e,t.hoverPaintStyle),t.hoverPaintStyle=e}}var i$=function(t){l(n,t);var e=d(n);function n(t,i){if(o(this,n),(r=e.call(this)).instance=t,a(h(r),"defaultLabelLocation",.5),a(h(r),"overlays",{}),a(h(r),"overlayPositions",{}),a(h(r),"overlayPlacements",{}),a(h(r),"clone",void 0),a(h(r),"deleted",void 0),a(h(r),"segment",void 0),a(h(r),"x",void 0),a(h(r),"y",void 0),a(h(r),"w",void 0),a(h(r),"h",void 0),a(h(r),"id",void 0),a(h(r),"visible",!0),a(h(r),"typeId",void 0),a(h(r),"params",{}),a(h(r),"paintStyle",void 0),a(h(r),"hoverPaintStyle",void 0),a(h(r),"paintStyleInUse",void 0),a(h(r),"_hover",!1),a(h(r),"lastPaintedAt",void 0),a(h(r),"data",void 0),a(h(r),"_defaultType",void 0),a(h(r),"events",void 0),a(h(r),"parameters",void 0),a(h(r),"_types",void 0),a(h(r),"_typeCache",void 0),a(h(r),"cssClass",void 0),a(h(r),"hoverClass",void 0),a(h(r),"beforeDetach",void 0),a(h(r),"beforeDrop",void 0),i=i||{},r.cssClass=i.cssClass||"",r.hoverClass=i.hoverClass||t.defaults.hoverClass,r.beforeDetach=i.beforeDetach,r.beforeDrop=i.beforeDrop,r._types=new Set,r._typeCache={},r.parameters=P(i.parameters||{}),r.id=i.id||r.getIdPrefix()+new Date().getTime(),r._defaultType={parameters:r.parameters,scope:i.scope||r.instance.defaultScope,overlays:{}},i.events)for(var s in i.events)r.bind(s,i.events[s]);r.clone=function(){var e=Object.create(r.constructor.prototype);return r.constructor.apply(e,[t,i]),e},r.overlays={},r.overlayPositions={};var r,l=i.overlays||[],u={},c=r.getDefaultOverlayKey();if(c){var d=r.instance.defaults[c];d&&l.push.apply(l,f(d));for(var p=0;p<l.length;p++){var v=iF(l[p]);u[v.options.id]=v}}return r._defaultType.overlays=u,i.label&&(r.getDefaultType().overlays[iU]={type:iB.type,options:{label:i.label,location:i.labelLocation||r.defaultLabelLocation,id:iU,cssClass:"jtk-default-label"}}),r}return r(n,[{key:"isDetachAllowed",value:function(t){var e=!0;if(this.beforeDetach)try{e=this.beforeDetach(t)}catch(t){tf("jsPlumb: beforeDetach callback failed",t)}return e}},{key:"isDropAllowed",value:function(t,e,n,i,o){var s,r={sourceId:t,targetId:e,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{s=this.beforeDrop(r)}catch(t){tf("jsPlumb: beforeDrop callback failed",t)}else s=this.instance.checkCondition(et,r);return s}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(t){for(var e in t)this._defaultType[e]=t[e]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(t,e,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][t]=e}},{key:"getCachedTypeItem",value:function(t,e){return this._typeCache[e]?this._typeCache[e][t]:null}},{key:"setType",value:function(t,e){this.clearTypes(),(iX(t)||[]).forEach(this._types.add,this._types),iZ(this,e)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(t){iZ(this,t)}},{key:"hasType",value:function(t){return this._types.has(t)}},{key:"addType",value:function(t,e){var n=iX(t),i=!1;if(null!=n){for(var o=0,s=n.length;o<s;o++)this._types.has(n[o])||(this._types.add(n[o]),i=!0);i&&iZ(this,e)}}},{key:"removeType",value:function(t,e){var n=iX(t),i=!1;if(null!=n){for(var o,s=0,r=n.length;s<r;s++)o=n[s],i=!!this._types.has(o)&&(iJ(this,o),this._types.delete(o),!0)||i;i&&iZ(this,e)}}},{key:"clearTypes",value:function(t){var e=this;this._types.forEach(function(t){iJ(e,t)}),this._types.clear(),iZ(this,t)}},{key:"toggleType",value:function(t,e){var n=iX(t);if(null!=n){for(var i=0,o=n.length;i<o;i++)this._types.has(n[i])?(iJ(this,n[i]),this._types.delete(n[i])):this._types.add(n[i]);iZ(this,e)}}},{key:"applyType",value:function(t,e){if(this.setPaintStyle(t.paintStyle),this.setHoverPaintStyle(t.hoverPaintStyle),this.mergeParameters(t.parameters),this.paintStyleInUse=this.getPaintStyle(),t.overlays){var n,i={};for(n in t.overlays){var o=this.overlays[t.overlays[n].options.id];if(o)o.updateFrom(t.overlays[n].options),i[t.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var s=this.getCachedTypeItem(iW,t.overlays[n].options.id);null!=s?(this.instance.reattachOverlay(s,this),s.setVisible(!0),s.updateFrom(t.overlays[n].options),this.overlays[s.id]=s):s=this.addOverlay(t.overlays[n]),i[s.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(t){this.paintStyle=t,this.paintStyleInUse=this.paintStyle,iK(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(t){this.hoverPaintStyle=t,iK(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(t){null!=t&&_(this.parameters,t)}},{key:"setVisible",value:function(t){this.visible=t,t?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(t,e){this.overlayPositions[t.id]=e}},{key:"getAbsoluteOverlayPosition",value:function(t){return this.overlayPositions?this.overlayPositions[t.id]:null}},{key:"_clazzManip",value:function(t,e){for(var n in this.overlays)"add"===t?this.instance.addOverlayClass(this.overlays[n],e):t===iq&&this.instance.removeOverlayClass(this.overlays[n],e)}},{key:"addClass",value:function(t,e){var n=(this.cssClass||"").split(" ");n.push(t),this.cssClass=n.join(" "),this._clazzManip("add",t)}},{key:"removeClass",value:function(t,e){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter(function(e){return e!==t}).join(" "),this._clazzManip(iq,t)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(t){this.data=t||{}}},{key:"mergeData",value:function(t){this.data=_(this.data,t)}},{key:"addOverlay",value:function(t){var e=function(t,e){var n=null;if(k(e))n=iN.get(t.instance,e,t,{});else if(null!=e.type&&null!=e.options){var i=_({},e.options);n=iN.get(t.instance,e.type,t,i)}else n=e;return n.id=n.id||th(),t.cacheTypeItem(iW,n,n.id),t.overlays[n.id]=n,n}(this,t);if(this.getData&&e.type===iB.type&&!k(t)){var n=this.getData(),i=t.options;if(n){var o=n[i.labelLocationAttribute||"labelLocation"];o&&(e.location=o)}}return e}},{key:"getOverlay",value:function(t){return this.overlays[t]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)(0===e.length||-1!==e.indexOf(i))&&this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!0)}},{key:"showOverlays",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)(0===e.length||-1!==e.indexOf(i))&&this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(t,e){var n=this.overlays[t];n&&(n.setVisible(!1),e||this.instance.destroyOverlay(n),delete this.overlays[t],this.overlayPositions&&delete this.overlayPositions[t],this.overlayPlacements&&delete this.overlayPlacements[t])}},{key:"removeOverlays",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,o=e.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var t=this.getLabelOverlay();return null!=t?t.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(iU)}},{key:"setLabel",value:function(t){var e=this.getLabelOverlay();if(e)k(t)||E(t)?e.setLabel(t):(t.label&&e.setLabel(t.label),t.location&&(e.location=t.location));else{var n,i=k(t)||E(t)?{label:t}:t;n=_({cssClass:i.cssClass,id:iU,component:this},i),e=new iB(this.instance,this,n),this.overlays[iU]=e}}}]),n}(iL),iQ=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],i0=function(t){l(n,t);var e=d(n);function n(t,i){o(this,n),(s=e.call(this,t,i)).instance=t,a(h(s),"connections",[]),a(h(s),"endpoint",void 0),a(h(s),"element",void 0),a(h(s),"elementId",void 0),a(h(s),"dragAllowedWhenFull",!0),a(h(s),"timestamp",void 0),a(h(s),"portId",void 0),a(h(s),"maxConnections",void 0),a(h(s),"proxiedBy",void 0),a(h(s),"connectorClass",void 0),a(h(s),"connectorHoverClass",void 0),a(h(s),"finalEndpoint",void 0),a(h(s),"enabled",!0),a(h(s),"isSource",void 0),a(h(s),"isTarget",void 0),a(h(s),"isTemporarySource",void 0),a(h(s),"connectionCost",1),a(h(s),"connectionsDirected",void 0),a(h(s),"connectionsDetachable",void 0),a(h(s),"reattachConnections",void 0),a(h(s),"currentAnchorClass",void 0),a(h(s),"referenceEndpoint",void 0),a(h(s),"edgeType",void 0),a(h(s),"connector",void 0),a(h(s),"connectorOverlays",void 0),a(h(s),"connectorStyle",void 0),a(h(s),"connectorHoverStyle",void 0),a(h(s),"deleteOnEmpty",void 0),a(h(s),"uuid",void 0),a(h(s),"scope",void 0),a(h(s),"_anchor",void 0),a(h(s),"defaultLabelLocation",[.5,.5]),s.appendToDefaultType({edgeType:i.edgeType,maxConnections:null==i.maxConnections?s.instance.defaults.maxConnections:i.maxConnections,paintStyle:i.paintStyle||s.instance.defaults.endpointStyle,hoverPaintStyle:i.hoverPaintStyle||s.instance.defaults.endpointHoverStyle,connectorStyle:i.connectorStyle,connectorHoverStyle:i.connectorHoverStyle,connectorClass:i.connectorClass,connectorHoverClass:i.connectorHoverClass,connectorOverlays:i.connectorOverlays,connector:i.connector}),s.enabled=!1!==i.enabled,s.visible=!0,s.element=i.element,s.uuid=i.uuid,s.portId=i.portId,s.elementId=i.elementId,s.connectionCost=null==i.connectionCost?1:i.connectionCost,s.connectionsDirected=i.connectionsDirected,s.currentAnchorClass="",s.events={},s.connectorOverlays=i.connectorOverlays,s.connectorStyle=i.connectorStyle,s.connectorHoverStyle=i.connectorHoverStyle,s.connector=i.connector,s.edgeType=i.edgeType,s.connectorClass=i.connectorClass,s.connectorHoverClass=i.connectorHoverClass,s.deleteOnEmpty=!0===i.deleteOnEmpty,s.isSource=i.source||!1,s.isTemporarySource=i.isTemporarySource||!1,s.isTarget=i.target||!1,s.connections=i.connections||[],s.scope=i.scope||t.defaultScope,s.timestamp=null,s.reattachConnections=i.reattachConnections||t.defaults.reattachConnections,s.connectionsDetachable=t.defaults.connectionsDetachable,!1===i.connectionsDetachable&&(s.connectionsDetachable=!1),s.dragAllowedWhenFull=!1!==i.dragAllowedWhenFull,i.onMaxConnections&&s.bind(t6,i.onMaxConnections);var s,r=i.endpoint||i.existingEndpoint||t.defaults.endpoint;if(s.setEndpoint(r),null!=i.preparedAnchor)s.setPreparedAnchor(i.preparedAnchor);else{var l=i.anchor?i.anchor:i.anchors?i.anchors:t.defaults.anchor||$.Top;s.setAnchor(l)}var u=[ni,i.type||""].join(" ");return s.addType(u,i.data),s}return r(n,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var t=this._anchor&&this._anchor.cssClass;if(null!=t&&t.length>0){var e=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=t;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");e!==n&&(this.removeClass(e),this.addClass(n),this.instance.removeClass(this.element,e),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(t){return this.instance.router.setAnchor(this,t),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(t){this.fire("anchor:changed",{endpoint:this,anchor:t}),this._updateAnchorClass()}},{key:"setAnchor",value:function(t){var e=this.instance.router.prepareAnchor(t);return this.setPreparedAnchor(e),this}},{key:"addConnection",value:function(t){this.connections.push(t),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(t,e,n){(e=null==e?this.connections.indexOf(t):e)>=0&&(this.connections.splice(e,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(t){for(var e=this.connections.length,n=0;n<e;n++)this.instance.deleteConnection(this.connections[0],t)}},{key:"detachFrom",value:function(t){for(var e=[],n=0;n<this.connections.length;n++)(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t)&&e.push(this.connections[n]);for(var i=0,o=e.length;i<o;i++)this.instance.deleteConnection(e[0]);return this}},{key:"setVisible",value:function(t,e,i){if(p(u(n.prototype),"setVisible",this).call(this,t),this.endpoint.setVisible(t),t?this.showOverlays():this.hideOverlays(),!e){for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(t),!i){var s=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[s].connections.length&&this.connections[o].endpoints[s].setVisible(t,!0,!0)}}}},{key:"applyType",value:function(t,e){p(u(n.prototype),"applyType",this).call(this,t,e),this.setPaintStyle(t.endpointStyle||t.paintStyle),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle),this.connectorStyle=t.connectorStyle,this.connectorHoverStyle=t.connectorHoverStyle,this.connector=t.connector,this.connectorOverlays=t.connectorOverlays,this.edgeType=t.edgeType,null!=t.maxConnections&&(this.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),_(t,iQ),this.instance.applyEndpointType(this,t)}},{key:"destroy",value:function(){p(u(n.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(t){var e=!1;if(t){for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}}return e}},{key:"setDragAllowedWhenFull",value:function(t){this.dragAllowedWhenFull=t}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(t,e){var n,i={cssClass:this.cssClass,endpoint:this};return t_(t,it)?(n=n7.clone(t)).classes=i.cssClass.split(" "):k(t)?n=n7.get(this,t,i):(_(i,t.options||{}),n=n7.get(this,t.type,i)),n.typeId=e,n}},{key:"setEndpoint",value:function(t){var e=this.prepareEndpoint(t);this.setPreparedEndpoint(e)}},{key:"setPreparedEndpoint",value:function(t){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=t}},{key:"addClass",value:function(t,e){p(u(n.prototype),"addClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.addClass(t)}},{key:"removeClass",value:function(t,e){p(u(n.prototype),"removeClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.removeClass(t)}}]),n}(i$),i1="anchors",i2="connector";function i5(t,e,n,i,o,s,r){var a;if(e)t.endpoints[n]=e,e.addConnection(t);else{var l=r||t.endpointSpec||t.endpointsSpec[n]||t.instance.defaults.endpoints[n]||t.instance.defaults.endpoint,u=t.endpointStyles[n]||t.endpointStyle||t.instance.defaults.endpointStyles[n]||t.instance.defaults.endpointStyle;null==u.fill&&null!=t.paintStyle&&(u.fill=t.paintStyle.stroke),null==u.outlineStroke&&null!=t.paintStyle&&(u.outlineStroke=t.paintStyle.outlineStroke),null==u.outlineWidth&&null!=t.paintStyle&&(u.outlineWidth=t.paintStyle.outlineWidth);var c=t.endpointHoverStyles[n]||t.endpointHoverStyle||t.endpointHoverStyle||t.instance.defaults.endpointHoverStyles[n]||t.instance.defaults.endpointHoverStyle;null!=t.hoverPaintStyle&&(null==c&&(c={}),null==c.fill&&(c.fill=t.hoverPaintStyle.stroke));var h=t.uuids?t.uuids[n]:null;i=null!=i?i:null!=t.instance.defaults.anchors?t.instance.defaults.anchors[n]:t.instance.defaults.anchor,a=t.instance._internal_newEndpoint({paintStyle:u,hoverPaintStyle:c,endpoint:l,connections:[t],uuid:h,element:o,scope:t.scope,anchor:i,reattachConnections:t.reattach||t.instance.defaults.reattachConnections,connectionsDetachable:t.detachable||t.instance.defaults.connectionsDetachable}),t.instance._refreshEndpoint(a),null==e&&(a.deleteOnEmpty=!0),t.endpoints[n]=a}return a}var i3=function(t){l(n,t);var e=d(n);function n(t,i){o(this,n),(s=e.call(this,t,i)).instance=t,a(h(s),"connector",void 0),a(h(s),"defaultLabelLocation",.5),a(h(s),"scope",void 0),a(h(s),"typeId","_jsplumb_connection"),a(h(s),"previousConnection",void 0),a(h(s),"sourceId",void 0),a(h(s),"targetId",void 0),a(h(s),"source",void 0),a(h(s),"target",void 0),a(h(s),"detachable",!0),a(h(s),"reattach",!1),a(h(s),"uuids",void 0),a(h(s),"cost",1),a(h(s),"directed",void 0),a(h(s),"endpoints",[null,null]),a(h(s),"endpointStyles",void 0),a(h(s),"endpointSpec",void 0),a(h(s),"endpointsSpec",void 0),a(h(s),"endpointStyle",{}),a(h(s),"endpointHoverStyle",{}),a(h(s),"endpointHoverStyles",void 0),a(h(s),"suspendedEndpoint",void 0),a(h(s),"suspendedIndex",void 0),a(h(s),"suspendedElement",void 0),a(h(s),"suspendedElementId",void 0),a(h(s),"suspendedElementType",void 0),a(h(s),"_forceReattach",void 0),a(h(s),"_forceDetach",void 0),a(h(s),"proxies",[]),a(h(s),"pending",!1),s.id=i.id,s.previousConnection=i.previousConnection,s.source=i.source,s.target=i.target,i.sourceEndpoint?(s.source=i.sourceEndpoint.element,s.sourceId=i.sourceEndpoint.elementId):s.sourceId=t.getId(s.source),i.targetEndpoint?(s.target=i.targetEndpoint.element,s.targetId=i.targetEndpoint.elementId):s.targetId=t.getId(s.target),s.scope=i.scope;var s,r=i.anchors?i.anchors[0]:i.anchor,l=i.anchors?i.anchors[1]:i.anchor;t.manage(s.source),t.manage(s.target),s.visible=!0,s.params={cssClass:i.cssClass,hoverClass:i.hoverClass,"pointer-events":i["pointer-events"],overlays:i.overlays},s.lastPaintedAt=null,i.type&&(i.endpoints=i.endpoints||s.instance._deriveEndpointAndAnchorSpec(i.type).endpoints),s.endpointSpec=i.endpoint,s.endpointsSpec=i.endpoints||[null,null],s.endpointStyle=i.endpointStyle,s.endpointHoverStyle=i.endpointHoverStyle,s.endpointStyles=i.endpointStyles||[null,null],s.endpointHoverStyles=i.endpointHoverStyles||[null,null],s.paintStyle=i.paintStyle,s.hoverPaintStyle=i.hoverPaintStyle,s.uuids=i.uuids,s.makeEndpoint(!0,s.source,s.sourceId,r,i.sourceEndpoint),s.makeEndpoint(!1,s.target,s.targetId,l,i.targetEndpoint),s.scope||(s.scope=s.endpoints[0].scope),null!=i.deleteEndpointsOnEmpty&&(s.endpoints[0].deleteOnEmpty=i.deleteEndpointsOnEmpty,s.endpoints[1].deleteOnEmpty=i.deleteEndpointsOnEmpty);var u=s.instance.defaults.connectionsDetachable;!1===i.detachable&&(u=!1),!1===s.endpoints[0].connectionsDetachable&&(u=!1),!1===s.endpoints[1].connectionsDetachable&&(u=!1),s.endpointsSpec=i.endpoints||[null,null],s.endpointSpec=i.endpoint||null;var c=i.reattach||s.endpoints[0].reattachConnections||s.endpoints[1].reattachConnections||s.instance.defaults.reattachConnections,d=_({},s.endpoints[0].connectorStyle||s.endpoints[1].connectorStyle||i.paintStyle||s.instance.defaults.paintStyle);if(s.appendToDefaultType({detachable:u,reattach:c,paintStyle:d,hoverPaintStyle:_({},s.endpoints[0].connectorHoverStyle||s.endpoints[1].connectorHoverStyle||i.hoverPaintStyle||s.instance.defaults.hoverPaintStyle)}),i.outlineWidth&&(d.outlineWidth=i.outlineWidth),i.outlineColor&&(d.outlineStroke=i.outlineColor),i.lineWidth&&(d.strokeWidth=i.lineWidth),i.color&&(d.stroke=i.color),!s.instance._suspendDrawing){var p=s.instance._suspendedAt||th();s.instance._paintEndpoint(s.endpoints[0],{timestamp:p}),s.instance._paintEndpoint(s.endpoints[1],{timestamp:p})}s.cost=i.cost||s.endpoints[0].connectionCost,s.directed=i.directed,null==i.directed&&(s.directed=s.endpoints[0].connectionsDirected);var v=_({},s.endpoints[1].parameters);_(v,s.endpoints[0].parameters),_(v,s.parameters),s.parameters=v,s.paintStyleInUse=s.getPaintStyle()||{},s._setConnector(s.endpoints[0].connector||s.endpoints[1].connector||i.connector||s.instance.defaults.connector,!0);var f=null!=i.data&&C(i.data)?i.data:{};s.setData(f);var g=[ni,s.endpoints[0].edgeType,s.endpoints[1].edgeType,i.type].join(" ");return/[^\s]/.test(g)&&s.addType(g,i.data),s}return r(n,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(t,e,n,i,o){return n=n||this.instance.getId(e),i5(this,o,t?0:1,i,e)}},{key:"getTypeDescriptor",value:function(){return n.type}},{key:"isDetachable",value:function(t){return!1!==this.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(t){this.detachable=!0===t}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(t){this.reattach=!0===t}},{key:"applyType",value:function(t,e){var i=null;null!=t.connector&&(null==(i=this.getCachedTypeItem(i2,e.connector))&&(i=this.prepareConnector(t.connector,e.connector),this.cacheTypeItem(i2,i,e.connector)),this.setPreparedConnector(i)),p(u(n.prototype),"applyType",this).call(this,t,e),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope);var o=null;t.anchor?null==(o=this.getCachedTypeItem(i1,e.anchor))&&(o=[iE(t.anchor),iE(t.anchor)],this.cacheTypeItem(i1,o,e.anchor)):t.anchors&&null==(o=this.getCachedTypeItem(i1,e.anchors))&&(o=[iE(t.anchors[0]),iE(t.anchors[1])],this.cacheTypeItem(i1,o,e.anchors)),null!=o&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,t)}},{key:"addClass",value:function(t,e){p(u(n.prototype),"addClass",this).call(this,t),e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.instance.addConnectorClass(this.connector,t)}},{key:"removeClass",value:function(t,e){p(u(n.prototype),"removeClass",this).call(this,t),e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.instance.removeConnectorClass(this.connector,t)}},{key:"setVisible",value:function(t){p(u(n.prototype),"setVisible",this).call(this,t),this.connector&&this.instance.setConnectorVisible(this.connector,t),this.instance._paintConnection(this)}},{key:"destroy",value:function(){p(u(n.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(t,e){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};return n=k(t)?this.instance._makeConnector(this,t,i):this.instance._makeConnector(this,t.type,S(t.options||{},i)),null!=e&&(n.typeId=e),n}},{key:"setPreparedConnector",value:function(t,e,n,i){if(this.connector!==t){var o,s="";if(null!=this.connector&&(o=this.connector,s=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=t,i&&this.cacheTypeItem(i2,t,i),this.addClass(s),null!=o){var r=this.getOverlays();for(var a in r)this.instance.reattachOverlay(r[a],this)}e||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(t,e,n,i){var o=this.prepareConnector(t,i);this.setPreparedConnector(o,e,n,i)}},{key:"replaceEndpoint",value:function(t,e){var n=this.endpoints[t],i=n.elementId,o=this.instance.getEndpoints(n.element),s=o.indexOf(n),r=i5(this,null,t,null,n.element,i,e);this.endpoints[t]=r,o.splice(s,1,r),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire("endpoint:replaced",{previous:n,current:r})}}]),n}(i$);function i4(t){if(null==t.path){var e=_({"jtk-overlay-id":t.id},t.attributes);t.path=eu(er,e);var n=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.path,n),t.path.jtk={overlay:t}}var i=t.path.parentNode;if(null==i){if(t.component instanceof i3){var o=t.component.connector;i=null!=o?o.canvas:null}else if(t.component instanceof i0){var s=t.component.endpoint;i=null!=s?s.canvas:s}null!=i&&ed(i,t.path,1)}return t.path}a(i3,"type","connection"),function(t){l(n,t);var e=d(n);function n(){var t;o(this,n);for(var i=arguments.length,s=Array(i),r=0;r<i;r++)s[r]=arguments[r];return a(h(t=e.call.apply(e,[this].concat(s))),"path",void 0),t}}(iH);var i6=function(){function t(){o(this,t)}return r(t,null,[{key:"paint",value:function(t,e,n,i){if(null!=n){var o=[t.x,t.y],s=[t.w,t.h];if(null!=i&&(i.xmin<0&&(o[0]+=i.xmin),i.ymin<0&&(o[1]+=i.ymin),s[0]=i.xmax+(i.xmin<0?-i.xmin:0),s[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(s[0])&&isFinite(s[1])){var r={width:""+(s[0]||0),height:""+(s[1]||0)};e.containerType===J.HTML?el(t.canvas,_(r,{style:ec([o[0],o[1]])})):el(t.canvas,_(r,{x:o[0],y:o[1]}))}}}}]),t}(),i9=function(){function t(){o(this,t)}return r(t,null,[{key:"getEndpointElement",value:function(t){if(null!=t.canvas)return t.canvas;var e=eu("svg",{style:"",width:"0",height:"0","pointer-events":"all",position:tN});t.canvas=e;var n=t.classes.join(" ");t.instance.addClass(e,n);for(var i=t.endpoint.scope.split(/\s/),o=0;o<i.length;o++)t.instance.setAttribute(e,tU+i[o],no);return t.instance._appendElementToContainer(e),null!=t.cssClass&&t.instance.addClass(e,t.cssClass),t.instance.addClass(e,t.instance.endpointClass),e.jtk=e.jtk||{},e.jtk.endpoint=t.endpoint,e.style.display=!1!==t.endpoint.visible?tH:tR,e}},{key:"paint",value:function(t,e,n){if(!0!==t.endpoint.deleted){this.getEndpointElement(t),i6.paint(t,t.instance,n);var i=_({},n);i.outlineStroke&&(i.stroke=i.outlineStroke),null==t.node?(t.node=e.makeNode(t,i),t.canvas.appendChild(t.node)):null!=e.updateNode&&e.updateNode(t,t.node),eh(t.canvas,t.node,i)}}}]),t}(),i8=function(){function t(e,n){o(this,t),this.connection=e,a(this,"type",void 0),a(this,"edited",!1),a(this,"stub",void 0),a(this,"sourceStub",void 0),a(this,"targetStub",void 0),a(this,"maxStub",void 0),a(this,"typeId",void 0),a(this,"gap",void 0),a(this,"sourceGap",void 0),a(this,"targetGap",void 0),a(this,"segments",[]),a(this,"totalLength",0),a(this,"segmentProportions",[]),a(this,"segmentProportionalLengths",[]),a(this,"paintInfo",null),a(this,"strokeWidth",void 0),a(this,"x",void 0),a(this,"y",void 0),a(this,"w",void 0),a(this,"h",void 0),a(this,"segment",void 0),a(this,"bounds",nt()),a(this,"cssClass",void 0),a(this,"hoverClass",void 0),a(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return r(t,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(t,e){this.geometry=t,this.edited=null!=t&&!e}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(t){return this.geometry=t,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(t,e,n){return{x:t.x,y:t.y,ox:t.ox,oy:t.oy,curX:t.curX+e,curY:t.curY+n}}},{key:"resetBounds",value:function(){this.bounds=nt()}},{key:"findSegmentForPoint",value:function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(t,e);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(t,e,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].lineIntersection(t,e,n,i));return o}},{key:"boxIntersection",value:function(t,e,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].boxIntersection(t,e,n,i));return o}},{key:"boundingBoxIntersection",value:function(t){for(var e=[],n=0;n<this.segments.length;n++)e.push.apply(e,this.segments[n].boundingBoxIntersection(t));return e}},{key:"_updateSegmentProportions",value:function(){for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e].getLength();this.segmentProportionalLengths[e]=n/this.totalLength,this.segmentProportions[e]=[t,t+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(t,e){var n,i,o;if(e&&(t=t>0?t/this.totalLength:(this.totalLength+t)/this.totalLength),1===t)n=this.segments.length-1,o=1;else if(0===t)o=0,n=0;else if(t>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=t&&this.segmentProportions[i][0]<=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(i=0,n=this.segmentProportions.length-1,o=1;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(t,e){if(e.x1!==e.x2||e.y1!==e.y2){var n=new t(e);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(t){this.strokeWidth=t.strokeWidth;var e=t.sourcePos.curX,n=t.targetPos.curX,i=t.sourcePos.curY,o=t.targetPos.curY,s=nI({x:e,y:i},{x:n,y:o}),r=n<e,a=o<i,l=[t.sourcePos.ox,t.sourcePos.oy],u=[t.targetPos.ox,t.targetPos.oy],c=r?n:e,h=a?o:i,d=Math.abs(n-e),p=Math.abs(o-i),v=0===l[0]&&0===l[1],f=0===u[0]&&0===u[1];if(v||f){var g=d>p?0:1,y=[1,0][g],m=0===g?e:i,_=0===g?n:o;v&&(l[g]=m>_?-1:1,l[y]=0),f&&(u[g]=m>_?1:-1,u[y]=0)}var x=r?d+this.sourceGap*l[0]:this.sourceGap*l[0],k=a?p+this.sourceGap*l[1]:this.sourceGap*l[1],b=r?this.targetGap*u[0]:d+this.targetGap*u[0],C=a?this.targetGap*u[1]:p+this.targetGap*u[1],E=l[0]*u[0]+l[1]*u[1],P={sx:x,sy:k,tx:b,ty:C,xSpan:Math.abs(b-x),ySpan:Math.abs(C-k),mx:(x+b)/2,my:(k+C)/2,so:l,to:u,x:c,y:h,w:d,h:p,segment:s,startStubX:x+l[0]*this.sourceStub,startStubY:k+l[1]*this.sourceStub,endStubX:b+u[0]*this.targetStub,endStubY:C+u[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(x-b)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(k-C)>this.sourceStub+this.targetStub,opposite:-1===E,perpendicular:0===E,orthogonal:1===E,sourceAxis:0===l[0]?"y":"x",points:[c,h,d,p,x,k,b,C],stubs:[this.sourceStub,this.targetStub]};return P.anchorOrientation=P.opposite?"opposite":P.orthogonal?"orthogonal":"perpendicular",P}},{key:"updateBounds",value:function(t){var e=t.extents;this.bounds.xmin=Math.min(this.bounds.xmin,e.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,e.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,e.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,e.ymax)}},{key:"dumpSegmentsToConsole",value:function(){tf("SEGMENTS:");for(var t=0;t<this.segments.length;t++)tf(this.segments[t].type,""+this.segments[t].getLength(),""+this.segmentProportions[t])}},{key:"pointOnPath",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this._findSegmentForLocation(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,!1)||{x:0,y:0}}},{key:"compute",value:function(t){this.paintInfo=this._prepareCompute(t),this._clearSegments(),this._compute(this.paintInfo,t),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(t,e){}}]),t}(),i7=function(t){l(n,t);var e=d(n);function n(t,i,s){var r;return o(this,n),(r=e.call(this,t,i,s)).instance=t,r.component=i,a(h(r),"width",void 0),a(h(r),"length",void 0),a(h(r),"foldback",void 0),a(h(r),"direction",void 0),a(h(r),"location",.5),a(h(r),"paintStyle",void 0),a(h(r),"type",n.type),a(h(r),"cachedDimensions",void 0),s=s||{},r.width=s.width||20,r.length=s.length||20,r.direction=0>(s.direction||1)?-1:1,r.foldback=s.foldback||.623,r.paintStyle=s.paintStyle||{strokeWidth:1},r.location=null==s.location?r.location:Array.isArray(s.location)?s.location[0]:s.location,r}return r(n,[{key:"draw",value:function(t,e,n){if(t instanceof i8){if(this.location>1||this.location<0){var i,o,s,r,a,l,u,c,h,d,p=this.location<0?1:0;o=nG(i=t.pointAlongPathFrom(p,this.location,!1),t.pointAlongPathFrom(p,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(o=nG(i=t.pointOnPath(this.location),t.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var v=o;o=i,i=v}}else if(0===this.location){if(i=nG(o=t.pointOnPath(this.location),t.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var f=o;o=i,i=f}}else o=nG(i=t.pointAlongPathFrom(this.location,this.direction*this.length/2),t.pointOnPath(this.location),this.length);a=i,l=o,h=(u=this.width)/2*Math.sin(c=Math.atan(-1/nj(a,l))),d=u/2*Math.cos(c),s=[{x:l.x+d,y:l.y+h},{x:l.x-d,y:l.y-h}],r=nG(i,o,this.foldback*this.length);var g={hxy:i,tail:s,cxy:r},y=this.paintStyle.stroke||e.stroke,m=this.paintStyle.fill||e.stroke;return{component:t,d:g,"stroke-width":this.paintStyle.strokeWidth||e.strokeWidth,stroke:y,fill:m,xmin:Math.min(i.x,s[0].x,s[1].x),xmax:Math.max(i.x,s[0].x,s[1].x),ymin:Math.min(i.y,s[0].y,s[1].y),ymax:Math.max(i.y,s[0].y,s[1].y)}}}},{key:"updateFrom",value:function(t){}}]),n}(iH);function ot(t){return t.type===i7.type}a(i7,"type","Arrow"),iN.register(i7.type,i7);var oe=function(t){l(n,t);var e=d(n);function n(t,i,s){var r;return o(this,n),(r=e.call(this,t,i,s)).instance=t,a(h(r),"type",n.type),r.length=r.length/2,r.foldback=2,r}return n}(i7);function on(t){return t.type===oe.type}a(oe,"type","Diamond"),iN.register(oe.type,oe);var oi=function(t){l(n,t);var e=d(n);function n(t,i,s){var r;return o(this,n),(r=e.call(this,t,i,s)).instance=t,a(h(r),"type",n.type),r.foldback=1,r}return n}(i7);function oo(t){return t.type===oi.type}a(oi,"type","PlainArrow"),iN.register("PlainArrow",oi);var os=function(t){l(n,t);var e=d(n);function n(t,i,s){var r;return o(this,n),(r=e.call(this,t,i,s)).instance=t,r.component=i,a(h(r),"create",void 0),a(h(r),"type",n.type),r.create=s.create,r}return r(n,[{key:"updateFrom",value:function(t){}}]),n}(iH);function or(t){return t.type===os.type}a(os,"type","Custom"),iN.register(os.type,os);var oa="paintStyle",ol=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),a(h(s=e.call(this,t,i)),"radius",void 0),a(h(s),"defaultOffset",void 0),a(h(s),"defaultInnerRadius",void 0),a(h(s),"type",n.type),i=i||{},s.radius=i.radius||5,s.defaultOffset=.5*s.radius,s.defaultInnerRadius=s.radius/3,s}return n}(it);a(ol,"type","Dot");var ou={type:ol.type,cls:ol,compute:function(t,e,n,i){var o=e.curX-t.radius,s=e.curY-t.radius,r=2*t.radius,a=2*t.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,s-=l,r+=2*l,a+=2*l}return t.x=o,t.y=s,t.w=r,t.h=a,[o,s,r,a,t.radius]},getParams:function(t){return{radius:t.radius}}},oc=function t(e,n){o(this,t),this.instance=e,this.el=n,a(this,"group",void 0)},oh=function(t){l(n,t);var e=d(n);function n(t,i,s){o(this,n),(r=e.call(this,t,i)).instance=t,a(h(r),"children",[]),a(h(r),"collapsed",!1),a(h(r),"droppable",void 0),a(h(r),"enabled",void 0),a(h(r),"orphan",void 0),a(h(r),"constrain",void 0),a(h(r),"proxied",void 0),a(h(r),"ghost",void 0),a(h(r),"revert",void 0),a(h(r),"prune",void 0),a(h(r),"dropOverride",void 0),a(h(r),"anchor",void 0),a(h(r),"endpoint",void 0),a(h(r),"connections",{source:[],target:[],internal:[]}),a(h(r),"manager",void 0),a(h(r),"id",void 0),a(h(r),"elId",void 0);var r,l=r.el;return l._isJsPlumbGroup=!0,l._jsPlumbGroup=h(r),r.elId=t.getId(i),r.orphan=!0===s.orphan,r.revert=!0!==r.orphan&&!1!==s.revert,r.droppable=!1!==s.droppable,r.ghost=!0===s.ghost,r.enabled=!1!==s.enabled,r.prune=!0!==r.orphan&&!0===s.prune,r.constrain=r.ghost||!0===s.constrain,r.proxied=!1!==s.proxied,r.id=s.id||th(),r.dropOverride=!0===s.dropOverride,r.anchor=s.anchor,r.endpoint=s.endpoint,r.anchor=s.anchor,t.setAttribute(i,tY,""),r}return r(n,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(t,e){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(t,e){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(t,e){return this.endpoint||{type:ol.type,options:{radius:10}}}},{key:"add",value:function(t,e){var n=this.instance.getGroupContentArea(this);if(null!=t._jsPlumbParentGroup){if(t._jsPlumbParentGroup===this)return;t._jsPlumbParentGroup.remove(t,!0,e,!1)}t._jsPlumbParentGroup=this,this.children.push(new oc(this.instance,t)),this.instance._appendElement(t,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(t){return null==t?null:D(this.children,function(e){return e.el===t})}},{key:"remove",value:function(t,e,n,i,o){var s=this.resolveNode(t);null!=s&&this._doRemove(s,e,n,i,o)}},{key:"_doRemove",value:function(t,e,n,i,o){var s=t.el;if(delete s._jsPlumbParentGroup,T(this.children,function(e){return e===t}),e)try{this.instance.getGroupContentArea(this).removeChild(s)}catch(t){tf("Could not remove element from Group "+t)}if(!n){var r={group:this,el:s};o&&(r.targetGroup=o),this.instance.fire("group:member:removed",r)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(t,e){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,t,e,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var t={},e=0;e<this.children.length;e++){var n=this.manager.orphan(this.children[e].el,!1);t[n.id]=n.pos}return this.children.length=0,t}},{key:"addGroup",value:function(t){if(!this.instance.allowNestedGroups||t===this||this.instance.groupManager.isAncestor(this,t))return!1;null!=t.group&&t.group.removeGroup(t);var e=this.instance.getId(t.el);this.instance.getManagedElements()[e].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(t.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));t.el._jsPlumbParentGroup=this,this.children.push(t),this.instance._appendElementToGroup(this,t.el),t.group=this;var o={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(t.el,o),this.instance.fire("group:nested:added",{parent:this,child:t}),!0}},{key:"removeGroup",value:function(t){if(t.group===this){var e=t.el,n=this.instance.getGroupContentArea(this);n===e.parentNode&&n.removeChild(t.el);var i=this.instance.getId(t.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter(function(e){return e.id!==t.id}),delete t.group,delete e._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:t})}}},{key:"getGroups",value:function(){return this.children.filter(function(t){return t.constructor===n})}},{key:"getNodes",value:function(){return this.children.filter(function(t){return t.constructor===oc})}},{key:"collapseParent",get:function(){var t=null;if(null==this.group)return null;for(var e=this.group;null!=e;)e.collapsed&&(t=e),e=e.group;return t}}]),n}(oc),od=function(){function t(e){var n=this;o(this,t),this.instance=e,a(this,"groupMap",{}),a(this,"_connectionSourceMap",{}),a(this,"_connectionTargetMap",{}),e.bind(t1,function(t){var e=n.getGroupFor(t.source),i=n.getGroupFor(t.target);null!=e&&null!=i&&e===i?(n._connectionSourceMap[t.connection.id]=e,n._connectionTargetMap[t.connection.id]=e,L(e.connections.internal,t.connection)):(null!=e&&(t.target._jsPlumbGroup===e?L(e.connections.internal,t.connection):L(e.connections.source,t.connection),n._connectionSourceMap[t.connection.id]=e),null!=i&&(t.source._jsPlumbGroup===i?L(i.connections.internal,t.connection):L(i.connections.target,t.connection),n._connectionTargetMap[t.connection.id]=i))}),e.bind(t3,function(t){n._cleanupDetachedConnection(t.connection)}),e.bind(t2,function(t){var e=t.originalEndpoint.element,i=n.getGroupFor(e),o=t.connection.endpoints[t.index].element,s=n.getGroupFor(o),r=0===t.index?n._connectionSourceMap:n._connectionTargetMap,a=0===t.index?n._connectionTargetMap:n._connectionSourceMap;null!=s?(r[t.connection.id]=s,t.connection.source===t.connection.target&&(a[t.connection.id]=s)):(delete r[t.connection.id],t.connection.source===t.connection.target&&delete a[t.connection.id]),null!=i&&n._updateConnectionsForGroup(i),null!=s&&n._updateConnectionsForGroup(s)})}return r(t,[{key:"_cleanupDetachedConnection",value:function(t){t.proxies.length=0;var e,n=this._connectionSourceMap[t.id];null!=n&&(e=function(e){return e.id===t.id},T(n.connections.source,e),T(n.connections.target,e),T(n.connections.internal,e),delete this._connectionSourceMap[t.id]),null!=(n=this._connectionTargetMap[t.id])&&(e=function(e){return e.id===t.id},T(n.connections.source,e),T(n.connections.target,e),T(n.connections.internal,e),delete this._connectionTargetMap[t.id])}},{key:"addGroup",value:function(t){var e=t.el;if(null!=this.groupMap[t.id])throw Error("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=e._isJsPlumbGroup)throw Error("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new oh(this.instance,t.el,t);return this.groupMap[n.id]=n,t.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,t$),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire("group:added",{group:n}),n}},{key:"getGroup",value:function(t){var e=t;if(k(t)&&null==(e=this.groupMap[t]))throw Error("No such group ["+t+"]");return e}},{key:"getGroupFor",value:function(t){for(var e=t,n=this.instance.getContainer(),i=!1,o=null;!i;)null==e||e===n?i=!0:e._jsPlumbParentGroup?(o=e._jsPlumbParentGroup,i=!0):e=e.parentNode;return o}},{key:"getGroups",value:function(){var t=[];for(var e in this.groupMap)t.push(this.groupMap[e]);return t}},{key:"removeGroup",value:function(t,e,n,i){var o=this,s=this.getGroup(t);this.expandGroup(s,!0);var r={};return M(s.children,function(t){var e=o.instance.getManagedElements()[o.instance.getId(t.el)];e&&delete e.group}),e?(M(s.getGroups(),function(t){return o.removeGroup(t,e,n)}),s.removeAll(n,i)):(s.group&&M(s.children,function(t){return s.group.add(t.el)}),r=s.orphanAll()),s.group&&s.group.removeGroup(s),this.instance.unmanage(s.el,!0),delete this.groupMap[s.id],this.instance.fire("group:removed",{group:s}),r}},{key:"removeAllGroups",value:function(t,e,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],t,e,n)}},{key:"forEach",value:function(t){for(var e in this.groupMap)t(this.groupMap[e])}},{key:"orphan",value:function(t,e){if(t._jsPlumbParentGroup){var n=t._jsPlumbParentGroup,i=this.instance.getId(t),o=this.instance.getOffset(t);return!0!==e&&n.group?this.instance._appendElementToGroup(n.group,t):this.instance._appendElementToContainer(t),this.instance.setPosition(t,o),delete t._jsPlumbParentGroup,{id:i,pos:o}}}},{key:"_updateConnectionsForGroup",value:function(t){var e=this;t.connections.source.length=0,t.connections.target.length=0,t.connections.internal.length=0;var n=t.children.slice().map(function(t){return t.el}),i=[];if(M(n,function(t){Array.prototype.push.apply(i,e.instance.getSelector(t,en))}),Array.prototype.push.apply(n,i),n.length>0){var o,s,r=this.instance.getConnections({source:n,scope:"*"},!0),a=this.instance.getConnections({target:n,scope:"*"},!0),l={},u=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=e.getGroupFor(n[i].source),s=e.getGroupFor(n[i].target),n[i].source===t.el&&s===t||n[i].target===t.el&&o===t?t.connections.internal.push(n[i]):o===t?(s!==t?t.connections.source.push(n[i]):t.connections.internal.push(n[i]),e._connectionSourceMap[n[i].id]=t):s!==t||(t.connections.target.push(n[i]),e._connectionTargetMap[n[i].id]=t))};u(r),u(a)}}},{key:"_collapseConnection",value:function(t,e,n){var i=t.endpoints[0===e?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=t.endpoints[0].element._jsPlumbParentGroup,s=null!=o?o.collapseParent||o:null,r=t.endpoints[1].element._jsPlumbParentGroup,a=null!=r?r.collapseParent||r:null;if(null!=s&&null!=a&&s.id===a.id)return!1;var l=n.el;return this.instance.getId(l),this.instance.proxyConnection(t,e,l,function(t,e){return n.getEndpoint(t,e)},function(t,e){return n.getAnchor(t,e)}),!0}},{key:"_expandConnection",value:function(t,e,n){this.instance.unproxyConnection(t,e)}},{key:"isElementDescendant",value:function(t,e){for(var n=this.instance.getContainer();;){if(null==t||t===n)return!1;if(t===e)return!0;t=t.parentNode}}},{key:"collapseGroup",value:function(t){var e=this,n=this.getGroup(t);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,t$),this.instance.addClass(i,tK),n.proxied){var o=new Set,s=function(t,i){for(var s=0;s<t.length;s++){var r=t[s];!0===e._collapseConnection(r,i,n)&&o.add(r.id)}};s(n.connections.source,0),s(n.connections.target,1),M(n.getGroups(),function(t){e.cascadeCollapse(n,t,o)})}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire("group:collapse",{group:n})}else n.collapsed=!0,this.instance.removeClass(i,t$),this.instance.addClass(i,tK)}}},{key:"cascadeCollapse",value:function(t,e,n){var i=this;if(t.proxied){var o=function(e,o){for(var s=0;s<e.length;s++){var r=e[s];n.has(r.id)||!0!==i._collapseConnection(r,o,t)||n.add(r.id)}};o(e.connections.source,0),o(e.connections.target,1)}M(e.getGroups(),function(e){i.cascadeCollapse(t,e,n)})}},{key:"expandGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,t$),this.instance.removeClass(o,tK),i.proxied){var s=function(t,e){for(var o=0;o<t.length;o++){var s=t[o];n._expandConnection(s,e,i)}};s(i.connections.source,0),s(i.connections.target,1),M(i.getGroups(),function t(e,i){if(i||e.collapsed){var o=function(t,i){for(var o=0;o<t.length;o++){var s=t[o];n._collapseConnection(s,i,e.collapseParent||e)}};o(e.connections.source,0),o(e.connections.target,1),M(e.connections.internal,function(t){return t.setVisible(!1)}),M(e.getGroups(),function(e){return t(e,!0)})}else n.expandGroup(e,!0)})}this.instance.revalidate(o),this.repaintGroup(i),e||this.instance.fire("group:expand",{group:i})}else i.collapsed=!1,this.instance.addClass(o,t$),this.instance.removeClass(o,tK)}}},{key:"toggleGroup",value:function(t){null!=(t=this.getGroup(t))&&(t.collapsed?this.expandGroup(t):this.collapseGroup(t))}},{key:"repaintGroup",value:function(t){for(var e=this.getGroup(t).children,n=0;n<e.length;n++)this.instance.revalidate(e[n].el)}},{key:"addToGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=i.el,s=arguments.length,r=Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];M(r,function(t){var s=null!=t._isJsPlumbGroup,r=t._jsPlumbGroup,a=t._jsPlumbParentGroup;if(a!==i){var l=n.instance.manage(t),u=n.instance.getOffset(t),c=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));l.group=i.elId,null!=a&&(a.remove(t,!1,e,!1,i),n._updateConnectionsForGroup(a)),s?i.addGroup(r):i.add(t,e);var h=function(t,e){var o=0===e?1:0;t.each(function(t){t.setVisible(!1),t.endpoints[o].element._jsPlumbGroup===i?(t.endpoints[o].setVisible(!1),n._expandConnection(t,o,i)):(t.endpoints[e].setVisible(!1),n._collapseConnection(t,e,i))})};i.collapsed&&(h(n.instance.select({source:t}),0),h(n.instance.select({target:t}),1)),n.instance.getId(t);var d={x:u.x-c.x,y:u.y-c.y};if(n.instance.setPosition(t,d),n._updateConnectionsForGroup(i),n.instance.revalidate(t),!e){var p={group:i,el:t,pos:d};a&&(p.sourceGroup=a),n.instance.fire("group:member:added",p)}}})}}},{key:"removeFromGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=arguments.length,s=Array(o>2?o-2:0),r=2;r<o;r++)s[r-2]=arguments[r];M(s,function(t){if(i.collapsed){var o=function(e,o){for(var s=0;s<e.length;s++){var r=e[s];if(r.proxies){for(var a=0;a<r.proxies.length;a++)if(null!=r.proxies[a]){var l=r.proxies[a].originalEp.element;(l===t||n.isElementDescendant(l,t))&&n._expandConnection(r,o,i)}}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(t,null,e);var s=n.instance.getManagedElements()[n.instance.getId(t)];s&&delete s.group})}}},{key:"getAncestors",value:function(t){for(var e=[],n=t.group;null!=n;)e.push(n),n=n.group;return e}},{key:"isAncestor",value:function(t,e){return null!=t&&null!=e&&-1!==this.getAncestors(t).indexOf(e)}},{key:"getDescendants",value:function(t){var e=[];return function t(n){var i=n.getGroups();e.push.apply(e,f(i)),M(i,t)}(t),e}},{key:"isDescendant",value:function(t,e){return null!=t&&null!=e&&-1!==this.getDescendants(e).indexOf(t)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),t}(),op=function(){function t(e,n){o(this,t),this.instance=e,this.entries=n}return r(t,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(t){return M(this.entries,function(e){return t(e)}),this}},{key:"get",value:function(t){return this.entries[t]}},{key:"addClass",value:function(t,e){return this.each(function(n){return n.addClass(t,e)}),this}},{key:"removeClass",value:function(t,e){return this.each(function(n){return n.removeClass(t,e)}),this}},{key:"removeAllOverlays",value:function(){return this.each(function(t){return t.removeAllOverlays()}),this}},{key:"setLabel",value:function(t){return this.each(function(e){return e.setLabel(t)}),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(t){var e=[];return this.each(function(n){return e.push(t(n))}),e}},{key:"addOverlay",value:function(t){return this.each(function(e){return e.addOverlay(t)}),this}},{key:"removeOverlay",value:function(t){return this.each(function(e){return e.removeOverlay(t)}),this}},{key:"removeOverlays",value:function(){return this.each(function(t){return t.removeOverlays()}),this}},{key:"showOverlay",value:function(t){return this.each(function(e){return e.showOverlay(t)}),this}},{key:"hideOverlay",value:function(t){return this.each(function(e){return e.hideOverlay(t)}),this}},{key:"setPaintStyle",value:function(t){return this.each(function(e){return e.setPaintStyle(t)}),this}},{key:"setHoverPaintStyle",value:function(t){return this.each(function(e){return e.setHoverPaintStyle(t)}),this}},{key:"setSuspendEvents",value:function(t){return this.each(function(e){return e.setSuspendEvents(t)}),this}},{key:"setParameter",value:function(t,e){return this.each(function(n){return n.parameters[t]=e}),this}},{key:"setParameters",value:function(t){return this.each(function(e){return e.parameters=t}),this}},{key:"setVisible",value:function(t){return this.each(function(e){return e.setVisible(t)}),this}},{key:"addType",value:function(t){return this.each(function(e){return e.addType(t)}),this}},{key:"toggleType",value:function(t){return this.each(function(e){return e.toggleType(t)}),this}},{key:"removeType",value:function(t){return this.each(function(e){return e.removeType(t)}),this}},{key:"bind",value:function(t,e){return this.each(function(n){return n.bind(t,e)}),this}},{key:"unbind",value:function(t,e){return this.each(function(n){return n.unbind(t,e)}),this}},{key:"setHover",value:function(t){var e=this;return this.each(function(n){return e.instance.setHover(n,t)}),this}}]),t}(),ov=function(t){l(n,t);var e=d(n);function n(){return o(this,n),e.apply(this,arguments)}return r(n,[{key:"setEnabled",value:function(t){return this.each(function(e){return e.enabled=t}),this}},{key:"setAnchor",value:function(t){return this.each(function(e){return e.setAnchor(t)}),this}},{key:"deleteEveryConnection",value:function(){return this.each(function(t){return t.deleteEveryConnection()}),this}},{key:"deleteAll",value:function(){var t=this;return this.each(function(e){return t.instance.deleteEndpoint(e)}),this.clear(),this}}]),n}(op),of=function(t){l(n,t);var e=d(n);function n(){return o(this,n),e.apply(this,arguments)}return r(n,[{key:"setDetachable",value:function(t){return this.each(function(e){return e.setDetachable(t)}),this}},{key:"setReattach",value:function(t){return this.each(function(e){return e.setReattach(t)}),this}},{key:"setConnector",value:function(t){return this.each(function(e){return e._setConnector(t)}),this}},{key:"deleteAll",value:function(){var t=this;this.each(function(e){return t.instance.deleteConnection(e)}),this.clear()}},{key:"repaint",value:function(){var t=this;return this.each(function(e){return t.instance._paintConnection(e)}),this}}]),n}(op),og=function t(){o(this,t),a(this,"affectedElements",new Set)};function oy(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var om=function(t,e){var n=0;return e[1]>t[1]?n=-1:e[1]<t[1]&&(n=1),n},o_=function(t,e){return -1*om(t,e)};function ox(t,e,n,i){!function(t,e,n,i){if(0===e.length)e.push(t);else{for(var o=i?-1:1,s=0,r=e.length,a=Math.floor((s+r)/2);r>s;)n(t,e[a])*o<0?r=a:s=a+1,a=Math.floor((s+r)/2);e.splice(a,0,t)}}([t,e],n,om,i)}function ok(t,e){var n=A(e,function(e){return e[0]===t});n>-1&&e.splice(n,1)}var ob=function(t){l(n,t);var e=d(n);function n(t){var i;return o(this,n),(i=e.call(this)).instance=t,a(h(i),"_currentTransaction",null),a(h(i),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),a(h(i),"_elementMap",new Map),a(h(i),"_transformedElementMap",new Map),a(h(i),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),i}return r(n,[{key:"_updateBounds",value:function(t,e,n){null!=e&&(ok(t,this._sortedElements.xmin),ok(t,this._sortedElements.xmax),ok(t,this._sortedElements.ymin),ok(t,this._sortedElements.ymax),ox(t,e.t.x,this._sortedElements.xmin,!1),ox(t,e.t.x+e.t.w,this._sortedElements.xmax,!0),ox(t,e.t.y,this._sortedElements.ymin,!1),ox(t,e.t.y+e.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var t=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach(function(e,n){t._sortedElements.xmin.push([n,e.t.x]),t._sortedElements.xmax.push([n,e.t.x+e.t.w]),t._sortedElements.ymin.push([n,e.t.y]),t._sortedElements.ymax.push([n,e.t.y+e.t.h])}),this._sortedElements.xmin.sort(om),this._sortedElements.ymin.sort(om),this._sortedElements.xmax.sort(o_),this._sortedElements.ymax.sort(o_),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(t,e,n){var i,o,s,r,a,l,u,c,h,d,p,v,f,g,y,m,_,x;e.t=(i=e.x,o=e.y,s=e.w,r=e.h,a=e.r,l={x:i+s/2,y:o+r/2},u=Math.cos(a/360*Math.PI*2),c=Math.sin(a/360*Math.PI*2),d=(h=function(t,e){return{x:l.x+Math.round((t-l.x)*u-(e-l.y)*c),y:l.y+Math.round((e-l.y)*u-(t-l.x)*c)}})(i,o),p=h(i+s,o),v=h(i+s,o+r),f=h(i,o+r),g=h(i+s/2,o+r/2),y=Math.min(d.x,p.x,v.x,f.x),m=Math.max(d.x,p.x,v.x,f.x),{x:y,y:_=Math.min(d.y,p.y,v.y,f.y),w:m-y,h:(x=Math.max(d.y,p.y,v.y,f.y))-_,c:g,r:a,x2:m,y2:x,cr:u,sr:c}),this._transformedElementMap.set(t,e.t),!0!==n&&this._updateBounds(t,e,n)}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new og}},{key:"endTransaction",value:function(){var t=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach(function(e){var n=t.getPosition(e);t._finaliseUpdate(e,n,!0)}),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(t){var e=this;M(t,function(t){return e.updateElement(t.id,t.x,t.y,t.width,t.height,t.rotation)})}},{key:"updateElement",value:function(t,e,n,i,o,s,r){var a=tm(this._elementMap,t,oy);return a.dirty=null==e&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=e&&(a.x=e),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=s&&(a.r=s||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(t,a,r):this._currentTransaction.affectedElements.add(t),a}},{key:"refreshElement",value:function(t,e){var n=this.instance.getManagedElements(),i=n[t]?n[t].el:null;if(null==i)return null;var o=this.getSize(i),s=this.getOffset(i);return this.updateElement(t,s.x,s.y,o.w,o.h,null,e)}},{key:"getSize",value:function(t){return this.instance.getSize(t)}},{key:"getOffset",value:function(t){return this.instance.getOffset(t)}},{key:"registerElement",value:function(t,e){return this.updateElement(t,0,0,0,0,0,e)}},{key:"addElement",value:function(t,e,n,i,o,s){return this.updateElement(t,e,n,i,o,s)}},{key:"rotateElement",value:function(t,e){var n=tm(this._elementMap,t,oy);return n.r=e||0,this._finaliseUpdate(t,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,null,null,e,n,null)}},{key:"setPosition",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,e,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(t){ok(t,this._sortedElements.xmin),ok(t,this._sortedElements.xmax),ok(t,this._sortedElements.ymin),ok(t,this._sortedElements.ymax),this._elementMap.delete(t),this._transformedElementMap.delete(t),this._recalculateBounds()}},{key:"getPosition",value:function(t){return this._elementMap.get(t)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),n}(iL);function oC(t,e){return e.theta-t.theta}function oE(t,e){return(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)-(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)}var oP=(a(ta={},ie,oE),a(ta,io,oC),a(ta,is,oC),a(ta,ii,oE),ta);function oS(t){return!0===t.isContinuous}function ow(t){return!0===t.isContinuous}function oM(t){return[t.currentLocation,t.locations[t.currentLocation]]}var oA=function(){function t(e){var n=this;o(this,t),this.instance=e,a(this,"anchorLists",new Map),a(this,"anchorLocations",new Map),e.bind(t3,function(t){t.sourceEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(t.sourceEndpoint),t.targetEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(t.targetEndpoint)}),e.bind(t5,function(t){n._removeEndpointFromAnchorLists(t)})}return r(t,[{key:"getAnchorOrientation",value:function(t){var e=this.anchorLocations.get(t.id);return e?[e.ox,e.oy]:[0,0]}},{key:"_distance",value:function(t,e,n,i,o,s,r){var a=i.x+t.x*o.w,l=i.y+t.y*o.h,u=i.x+o.w/2,c=i.y+o.h/2;if(null!=s&&s.length>0){var h=this.instance._applyRotations([a,l,0,0],s);a=h.x,l=h.y}return Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(u-a,2)+Math.pow(c-l,2))}},{key:"_anchorSelector",value:function(t,e,n,i,o,s,r){for(var a=n.x+i.w/2,l=n.y+i.h/2,u=-1,c=1/0,h=0;h<r.length;h++){var d=this._distance(r[h],a,l,t,e,o,s);d<c&&(u=h+0,c=d)}return[u,r[u]]}},{key:"_floatingAnchorCompute",value:function(t,e){var n=e.xy,i={curX:n.x+t.size.w/2,curY:n.y+t.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(t,i)}},{key:"_setComputedPosition",value:function(t,e,n){return this.anchorLocations.set(t.id,e),t.computedPosition=e,n&&(t.timestamp=n),e}},{key:"_computeSingleLocation",value:function(t,e,n,i){var o,s=i.rotation,r={curX:e.x+t.x*n.w+t.offx,curY:e.y+t.y*n.h+t.offy,x:t.x,y:t.y,ox:0,oy:0};if(null!=s&&s.length>0){var a=[t.iox,t.ioy],l={x:r.curX,y:r.curY,cr:0,sr:0};M(s,function(t){l=td(l,t.c,t.r),a=[Math.round(a[0]*l.cr-a[1]*l.sr),Math.round(a[1]*l.cr+a[0]*l.sr)].slice()}),t.ox=a[0],t.oy=a[1],o={curX:l.x,curY:l.y,x:t.x,y:t.y,ox:a[0],oy:a[1]}}else t.ox=t.iox,t.oy=t.ioy,o=_({ox:t.iox,oy:t.ioy},r);return o}},{key:"_singleAnchorCompute",value:function(t,e){var n=e.xy,i=e.wh,o=e.timestamp,s=this.anchorLocations.get(t.id);if(null!=s&&o&&o===t.timestamp)return s;var r=v(oM(t),2);r[0];var a=r[1];return s=this._computeSingleLocation(a,n,i,e),this._setComputedPosition(t,s,o)}},{key:"_defaultAnchorCompute",value:function(t,e){if(1===t.locations.length)return this._singleAnchorCompute(t,e);var n,i=e.xy,o=e.wh,s=e.txy,r=e.twh,a=v(oM(t),2),l=a[0],u=a[1];if(t.locked||null==s||null==r)n=this._computeSingleLocation(u,i,o,e);else{var c=v(this._anchorSelector(i,o,s,r,e.rotation,e.tRotation,t.locations),2),h=c[0],d=c[1];t.currentLocation=h,h!==l&&(t.cssClass=d.cls||t.cssClass,e.element._anchorLocationChanged(t)),n=this._computeSingleLocation(d,i,o,e)}return this._setComputedPosition(t,n,e.timestamp)}},{key:"_placeAnchors",value:function(t,e){var n=this,i=this.instance.viewport.getPosition(t),o=function(e,o,s,r,a,l){if(s.length>0)for(var u=function(t,e,n,i,o){for(var s=n?t.w:t.h,r=n?t.h:t.w,a=[],l=s/(e.length+1),u=0;u<e.length;u++){var c=(u+1)*l,h=i*r;o&&(c=s-c);var d=n?c:h,p=t.x+d,v=d/t.w,f=n?h:c,g=t.y+f,y=f/t.h;if(0!==t.r&&null!=t.r){var m=td({x:p,y:g},t.c,t.r);p=m.x,g=m.y}a.push({x:p,y:g,xLoc:v,yLoc:y,c:e[u].c})}return a}(i,s.sort(oP[e]),r,a,e===io||e===ie),c=0;c<u.length;c++){var h=u[c].c,d=h.endpoints[0].elementId===t?h.endpoints[0]:h.endpoints[1];n._setComputedPosition(d._anchor,{curX:u[c].x,curY:u[c].y,x:u[c].xLoc,y:u[c].yLoc,ox:l[0],oy:l[1]})}};o(is,i,e.bottom,!0,1,[0,1]),o(ie,i,e.top,!0,0,[0,-1]),o(ii,i,e.left,!1,0,[-1,0]),o(io,i,e.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(t,e,n,i,o,s,r,a,l,u,c){var h,d=i.endpoints[r],p=d.id,v=[1,0][r],f=t[l],g=d._continuousAnchorEdge?t[d._continuousAnchorEdge]:null;if(g){var y=A(g,function(t){return t.epId===p});if(-1!==y){g.splice(y,1);for(var m=0;m<g.length;m++)!0!==(h=g[m].c).placeholder&&u.add(h),c.add(g[m].c.endpoints[r]),c.add(g[m].c.endpoints[v])}}for(var _=0;_<f.length;_++)!0!==(h=f[_].c).placeholder&&u.add(h),c.add(f[_].c.endpoints[r]),c.add(f[_].c.endpoints[v]);var x=a?0:f.length;f.splice(x,0,{theta:e,order:n,c:i,b:o,elId:s,epId:p}),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(t){var e=this.anchorLists.get(t.elementId),n=0;(function(t,e){if(t){var i=function(t){return t.epId===e};T(t.top,i),T(t.left,i),T(t.bottom,i),T(t.right,i),n+=t.top.length+t.left.length+t.bottom.length+t.right.length}})(e,t.id),0===n&&this.anchorLists.delete(t.elementId),this.anchorLocations.delete(t._anchor.id)}},{key:"computeAnchorLocation",value:function(t,e){var n;return n=oS(t)?this.anchorLocations.get(t.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:ow(t)?this._floatingAnchorCompute(t,e):this._defaultAnchorCompute(t,e),t.timestamp=e.timestamp,n}},{key:"computePath",value:function(t,e){var n=this.instance.viewport.getPosition(t.sourceId),i=this.instance.viewport.getPosition(t.targetId),o=t.endpoints[0],s=t.endpoints[1],r=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:e,rotation:this.instance._getRotations(t.sourceId)}),a=this.getEndpointLocation(s,{xy:i,wh:i,element:s,timestamp:e,rotation:this.instance._getRotations(t.targetId)});t.connector.resetBounds(),t.connector.compute({sourcePos:r,targetPos:a,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1],strokeWidth:t.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(t,e){e=e||{};var n=t._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=e.timestamp&&n.timestamp!==e.timestamp)&&(i=this.computeAnchorLocation(n,e),this._setComputedPosition(n,i,e.timestamp)),i}},{key:"getEndpointOrientation",value:function(t){return t._anchor?this.getAnchorOrientation(t._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(t,e){var n=this.anchorLocations.get(t.id);null!=n&&(n.ox=e[0],n.oy=e[1])}},{key:"isDynamicAnchor",value:function(t){return!!t._anchor&&!oS(t._anchor)&&t._anchor.locations.length>1}},{key:"isFloating",value:function(t){return!!t._anchor&&ow(t._anchor)}},{key:"prepareAnchor",value:function(t){return iE(t)}},{key:"redraw",value:function(t,e,n){var i=this,o=new Set,s=new Set,r=new Set;if(!this.instance._suspendDrawing){var a=this.instance.endpointsByElement[t]||[];e=e||th();for(var l,u,c={},h=0;h<a.length;h++)if(!1!==(u=a[h]).visible){if(s.add(u),l=u._anchor,0===u.connections.length)oS(l)&&(this.anchorLists.has(t)||this.anchorLists.set(t,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(t),-Math.PI/2,0,{endpoints:[u,u],placeholder:!0},!1,t,0,!1,0===l.faces.length?ie:l.faces[0],o,s),r.add(t));else for(var d=0;d<u.connections.length;d++){var p=u.connections[d],v=p.sourceId,f=p.targetId,g=oS(p.endpoints[0]._anchor),y=oS(p.endpoints[1]._anchor);if(g||y){var m=[v,(p.endpoints[0]._anchor.faces||[]).join("-"),f,(p.endpoints[1]._anchor.faces||[]).join("-")].join("-"),_=c[m],x=p.sourceId===t?1:0;g&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]}),y&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]});var k=this.instance.viewport.getPosition(f),b=this.instance.viewport.getPosition(v);if(f===v&&(g||y))this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,p,!1,f,0,!1,ie,o,s),this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,v,1,!1,ie,o,s);else{var C=this.instance._getRotations(v),E=this.instance._getRotations(f);_||(_=this._calculateOrientation(v,f,b,k,p.endpoints[0]._anchor,p.endpoints[1]._anchor,C,E),c[m]=_),g&&this._updateAnchorList(this.anchorLists.get(v),_.theta,0,p,!1,f,0,!1,_.a[0],o,s),y&&this._updateAnchorList(this.anchorLists.get(f),_.theta2,-1,p,!0,v,1,!0,_.a[1],o,s)}g&&r.add(v),y&&r.add(f),o.add(p),(g&&0===x||y&&1===x)&&s.add(p.endpoints[x])}else{var P=u.connections[d].endpoints[p.sourceId===t?1:0];if(P._anchor.locations.length>1){this.instance._paintEndpoint(P,{elementWithPrecedence:t,timestamp:e}),o.add(u.connections[d]);for(var S=0;S<P.connections.length;S++)P.connections[S]!==u.connections[d]&&o.add(P.connections[S])}else o.add(u.connections[d])}}}r.forEach(function(t){i._placeAnchors(t,i.anchorLists.get(t))}),s.forEach(function(t){var n=i.instance.viewport.getPosition(t.elementId);i.instance._paintEndpoint(t,{timestamp:e,offset:n})}),o.forEach(function(t){i.instance._paintConnection(t,{timestamp:e})})}return{c:o,e:s}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(t,e){null!=e&&(t._anchor=e)}},{key:"setConnectionAnchors",value:function(t,e){t.endpoints[0]._anchor=e[0],t.endpoints[1]._anchor=e[1]}},{key:"_calculateOrientation",value:function(t,e,n,i,o,s,r,l){var u=this;if(t===e)return{orientation:"identity",a:[ie,ie]};var c=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),h=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),d=[],p={};!function(t,e){for(var n,i=0;i<t.length;i++)if(p[t[i]]=(a(n={},ii,{x:e[i][0].x,y:e[i][0].c.y}),a(n,io,{x:e[i][0].x+e[i][0].w,y:e[i][0].c.y}),a(n,ie,{x:e[i][0].c.x,y:e[i][0].y}),a(n,is,{x:e[i][0].c.x,y:e[i][0].y+e[i][0].h}),n),null!=e[i][1]&&e[i][1].length>0)for(var o in p[t[i]])p[t[i]][o]=u.instance._applyRotationsXY(p[t[i]][o],e[i][1])}([tL,tF],[[n,r],[i,l]]);for(var v=[ie,ii,io,is],f=0;f<v.length;f++)for(var g=0;g<v.length;g++)d.push({source:v[f],target:v[g],dist:nT(p.source[v[f]],p.target[v[g]])});d.sort(function(t,e){if(t.dist<e.dist)return -1;if(e.dist<t.dist)return 1;var n,i=(a(n={},ii,0),a(n,ie,1),a(n,io,2),a(n,is,3),n),o=i[t.source],s=i[e.source],r=i[t.target],l=i[e.target];return o<s?-1:s<o?1:r<l?-1:l<r?1:0});for(var y=d[0].source,m=d[0].target,_=0;_<d.length&&(y=oS(o)&&o.locked?o.currentFace:!o.isContinuous||ip(o,d[_].source)?d[_].source:null,m=s.isContinuous&&s.locked?s.currentFace:!s.isContinuous||ip(s,d[_].target)?d[_].target:null,null==y||null==m);_++);return o.isContinuous&&this.setCurrentFace(o,y),s.isContinuous&&this.setCurrentFace(s,m),{a:[y,m],theta:c,theta2:h}}},{key:"setCurrentFace",value:function(t,e,n){t.currentFace=e,n&&null!=t.lockedFace&&(t.lockedFace=t.currentFace)}},{key:"lock",value:function(t){t.locked=!0,oS(t)&&(t.lockedFace=t.currentFace)}},{key:"unlock",value:function(t){t.locked=!1,oS(t)&&(t.lockedFace=null)}},{key:"selectAnchorLocation",value:function(t,e){var n=A(t.locations,function(t){return t.x===e.x&&t.y===e.y});return -1!==n&&(t.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(t){null!=t.currentFace&&(t.lockedAxis=t.currentFace===ii||t.currentFace===io?ir:ia)}},{key:"unlockCurrentAxis",value:function(t){t.lockedAxis=null}},{key:"anchorsEqual",value:function(t,e){if(!t||!e)return!1;var n=t.locations[t.currentLocation],i=e.locations[e.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),t}(),oD={},oj=function(t,e,n){var i=oD[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown connector type '"+e+"'"}},oT=function(t,e){oD[t]=e},oI=function(t){l(n,t);var e=d(n);function n(t){var i;return o(this,n),a(h(i=e.call(this,t)),"length",void 0),a(h(i),"m",void 0),a(h(i),"m2",void 0),a(h(i),"type",n.segmentType),i._setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),i}return r(n,[{key:"getPath",value:function(t){return(t?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=nj({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this._recalc()}},{key:"pointOnPath",value:function(t,e){if(0===t&&!e)return{x:this.x1,y:this.y1};if(1===t&&!e)return{x:this.x2,y:this.y2};var n=e?t>0?t:this.length+t:t*this.length;return nG({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}},{key:"gradientAtPoint",value:function(t,e){return this.m}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return e<=0&&Math.abs(e)>1&&(e*=-1),nG(i,o,e)}},{key:"within",value:function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)}},{key:"closest",value:function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e}},{key:"findClosestPointOnPath",value:function(t,e){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,t)?t:this.closest(this.x1,this.x2,t);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,e)?e:this.closest(this.y1,this.y2,e);else{var i=this.y1-this.m*this.x1,o=(e-this.m2*t-i)/(this.m-this.m2),s=this.m*o+i;n.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),n.y=this.within(this.y1,this.y2,s)?s:this.closest(this.y1,this.y2,s)}var r=nT({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=nT({x:t,y:e},n),n.l=r/length,n}},{key:"_pointLiesBetween",value:function(t,e,n){return n>e?e<=t&&t<=n:e>=t&&t>=n}},{key:"lineIntersection",value:function(t,e,n,i){var o,s,r=Math.abs(nj({x:t,y:e},{x:n,y:i})),a=Math.abs(this.m),l=a===1/0?this.x1:this.y1-a*this.x1,u=[],c=r===1/0?t:e-r*t;return r!==a&&(r===1/0&&0===a?this._pointLiesBetween(t,this.x1,this.x2)&&this._pointLiesBetween(this.y1,e,i)&&u.push({x:t,y:this.y1}):0===r&&a===1/0?this._pointLiesBetween(e,this.y1,this.y2)&&this._pointLiesBetween(this.x1,t,n)&&u.push({x:this.x1,y:e}):r===1/0?(o=t,this._pointLiesBetween(o,this.x1,this.x2)&&(s=a*t+l,this._pointLiesBetween(s,e,i)&&u.push({x:o,y:s}))):0===r?(s=e,this._pointLiesBetween(s,this.y1,this.y2)&&(o=(e-l)/a,this._pointLiesBetween(o,t,n)&&u.push({x:o,y:s}))):(o=(c-l)/(a-r),s=a*o+l,this._pointLiesBetween(o,this.x1,this.x2)&&this._pointLiesBetween(s,this.y1,this.y2)&&u.push({x:o,y:s}))),u}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}}]),n}(ne);a(oI,"segmentType","Straight");var oO=function(t){l(n,t);var e=d(n);function n(){var t;o(this,n);for(var i=arguments.length,s=Array(i),r=0;r<i;r++)s[r]=arguments[r];return a(h(t=e.call.apply(e,[this].concat(s))),"type",n.type),t}return r(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){this._addSegment(oI,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),this._addSegment(oI,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),this._addSegment(oI,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty}),this.geometry={source:e.sourcePos,target:e.targetPos}}},{key:"transformGeometry",value:function(t,e,n){return{source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}}]),n}(i8);function oG(t,e,n){var i,o=[],s=function(e){return k(e)?e:t.getId(e)};if(e){if("string"==typeof e){if("*"===e)return e;o.push(e)}else n?o=e:null!=e.length?(i=o).push.apply(i,f(f(e).map(s))):o.push(s(e))}return o}function oL(t,e,n){null!=e&&(e.connections.push(t),1===e.connections.length&&t.instance.addClass(t.source,t.instance.connectedClass)),null!=n&&(null==e||t.sourceId!==t.targetId)&&(n.connections.push(t),1===n.connections.length&&t.instance.addClass(t.target,t.instance.connectedClass))}function oF(t,e,n){if(null!=e){var i=e.connections.length;T(e.connections,function(e){return t.id===e.id}),i>0&&0===e.connections.length&&t.instance.removeClass(t.source,t.instance.connectedClass)}if(null!=n){var o=n.connections.length;(null==e||t.sourceId!==t.targetId)&&T(n.connections,function(e){return t.id===e.id}),o>0&&0===n.connections.length&&t.instance.removeClass(t.target,t.instance.connectedClass)}}a(oO,"type","Straight");var oH=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),(s=e.call(this))._instanceIndex=t,a(h(s),"defaults",void 0),a(h(s),"_initialDefaults",{}),a(h(s),"isConnectionBeingDragged",!1),a(h(s),"currentlyDragging",!1),a(h(s),"hoverSuspended",!1),a(h(s),"_suspendDrawing",!1),a(h(s),"_suspendedAt",null),a(h(s),"connectorClass",tq),a(h(s),"connectorOutlineClass","jtk-connector-outline"),a(h(s),"connectedClass","jtk-connected"),a(h(s),"endpointClass",tZ),a(h(s),"endpointConnectedClass","jtk-endpoint-connected"),a(h(s),"endpointFullClass","jtk-endpoint-full"),a(h(s),"endpointFloatingClass",tJ),a(h(s),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),a(h(s),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),a(h(s),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),a(h(s),"overlayClass",tQ),a(h(s),"connections",[]),a(h(s),"endpointsByElement",{}),a(h(s),"endpointsByUUID",new Map),a(h(s),"sourceSelectors",[]),a(h(s),"targetSelectors",[]),a(h(s),"allowNestedGroups",void 0),a(h(s),"_curIdStamp",1),a(h(s),"viewport",new ob(h(s))),a(h(s),"router",void 0),a(h(s),"groupManager",void 0),a(h(s),"_connectionTypes",new Map),a(h(s),"_endpointTypes",new Map),a(h(s),"_container",void 0),a(h(s),"_managedElements",{}),a(h(s),"DEFAULT_SCOPE",void 0),a(h(s),"_zoom",1),s.defaults={anchor:$.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:oO.type,container:null,endpoint:ol.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},i&&_(s.defaults,i),_(s._initialDefaults,s.defaults),null!=s._initialDefaults[oa]&&(s._initialDefaults[oa].strokeWidth=s._initialDefaults[oa].strokeWidth||2),s.DEFAULT_SCOPE=s.defaults.scope,s.allowNestedGroups=!1!==s._initialDefaults.allowNestedGroups,s.router=new oA(h(s)),s.groupManager=new od(h(s)),s.setContainer(s._initialDefaults.container),s}return r(n,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(t){return null!=t&&null!=t[0]&&null!=t[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(t,e){return this._zoom=t,this.fire(t8,this._zoom),e&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(t,e){var n=this.getListener(t),i=!0;if(n&&n.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var s=0,r=n.length;s<r;s++)i=i&&n[s].apply(n[s],o)}catch(e){tf("cannot check condition ["+t+"]"+e)}}return i}},{key:"getId",value:function(t,e){if(null==t)return null;var n=this.getAttribute(t,tX);return n&&"undefined"!==n||(2==arguments.length&&void 0!==arguments[1]?n=e:1!=arguments.length&&(3!=arguments.length||arguments[2])||(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(t,tX,n)),n}},{key:"getConnections",value:function(t,e){t?t.constructor===String&&(t={scope:t}):t={};for(var n=oG(this,t.scope||this.defaultScope,!0),i=oG(this,t.source),o=oG(this,t.target),s=!e&&n.length>1?{}:[],r=0,a=this.connections.length;r<a;r++){var l=this.connections[r],u=l.proxies&&l.proxies[0]?l.proxies[0].originalEp.elementId:l.sourceId,c=l.proxies&&l.proxies[1]?l.proxies[1].originalEp.elementId:l.targetId;m(n,l.scope)&&m(i,u)&&m(o,c)&&function(t,i){if(!e&&n.length>1){var o=s[t];null==o&&(o=s[t]=[]),o.push(i)}else s.push(i)}(l.scope,l)}return s}},{key:"select",value:function(t){return(t=t||{}).scope=t.scope||"*",new of(this,t.connections||this.getConnections(t,!0))}},{key:"selectEndpoints",value:function(t){(t=t||{}).scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":oG(this,t.element),i=e?"*":oG(this,t.source),o=e?"*":oG(this,t.target),s=oG(this,t.scope,!0),r=[];for(var a in this.endpointsByElement){var l=m(n,a,!0),u=m(i,a,!0),c="*"!==i,h=m(o,a,!0),d="*"!==o;if(l||u||h)for(var p=0,v=this.endpointsByElement[a].length;p<v;p++){var f=this.endpointsByElement[a][p];if(m(s,f.scope,!0)){var g=c&&i.length>0&&!f.isSource,y=d&&o.length>0&&!f.isTarget;if(g||y)continue;r.push(f)}}}return new ov(this,r)}},{key:"setContainer",value:function(t){this._container=t,this.fire("container:change",this._container)}},{key:"_set",value:function(t,e,n){var i,o,s=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],r=t[s.elId],a=t.endpoints[n],l={index:n,originalEndpoint:a,originalSourceId:0===n?r:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?r:t.targetId,newTargetId:t.targetId,connection:t,newEndpoint:a};return e instanceof i0?(i=e).addConnection(t):i=(o=this.getId(e))===t[s.elId]?null:t.makeEndpoint(0===n,e,o),null!=i&&(l.newEndpoint=i,a.detachFromConnection(t),t.endpoints[n]=i,t[s.el]=i.element,t[s.elId]=i.elementId,l[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(l),this._paintConnection(t)),l}},{key:"setSource",value:function(t,e){oF(t,this._managedElements[t.sourceId]);var n=this._set(t,e,0);oL(t,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(t,e){oF(t,this._managedElements[t.targetId]);var n=this._set(t,e,1);oL(t,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function(t,e,n){t.setType(e,n),this._paintConnection(t)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(t,e){var n=this._suspendDrawing;return this._suspendDrawing=t,t?this._suspendedAt=""+new Date().getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),e&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(t,e){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),t(),n||this.setSuspendDrawing(!1,!e)}},{key:"each",value:function(t,e){if(null!=t){if(null!=t.length)for(var n=0;n<t.length;n++)e(t[n]);else e(t);return this}}},{key:"updateOffset",value:function(t){var e=t.elId;return t.recalc?this.viewport.refreshElement(e):this.viewport.getPosition(e)}},{key:"deleteConnection",value:function(t,e){if(null!=t&&!0!==t.deleted&&((e=e||{}).force||w(!0,!1,[[t.endpoints[0],t7,[t]],[t.endpoints[1],t7,[t]],[t,t7,[t]],[this,tW,[ee,t]]]))){oF(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this.fireDetachEvent(t,!t.pending&&!1!==e.fireEvent,e.originalEvent);var n=t.endpoints[0],i=t.endpoints[1];return n!==e.endpointToIgnore&&n.detachFromConnection(t,null,!0),i!==e.endpointToIgnore&&i.detachFromConnection(t,null,!0),T(this.connections,function(e){return t.id===e.id}),t.destroy(),n!==e.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==e.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(t){var e=this;t=t||{};var n=this.connections.length,i=0;return this.batch(function(){for(var o=0;o<n;o++)i+=e.deleteConnection(e.connections[0],t)?1:0}),i}},{key:"deleteConnectionsForElement",value:function(t,e){var n=this.getId(t),i=this._managedElements[n];if(i)for(var o=i.connections.length,s=0;s<o;s++)this.deleteConnection(i.connections[0],e);return this}},{key:"fireDetachEvent",value:function(t,e,n){var i=null!=t.id?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&this.fire("connection:detach",i,n),this.fire(t3,i,n)}},{key:"fireMoveEvent",value:function(t,e){this.fire(t2,t,e)}},{key:"manageAll",value:function(t,e){for(var n=k(t)?this.getSelector(this.getContainer(),t):t,i=0;i<n.length;i++)this.manage(n[i],null,e)}},{key:"manage",value:function(t,e,n){null==this.getAttribute(t,tX)&&(e=e||this.getAttribute(t,"id")||th(),this.setAttribute(t,tX,e));var i=this.getId(t);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:t,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire(t4,{el:t})}return this._managedElements[i]}},{key:"getManagedData",value:function(t,e,n){if(this._managedElements[t]){var i=this._managedElements[t].data[e];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(t,e,n,i){this._managedElements[t]&&(this._managedElements[t].data[e]=this._managedElements[t].data[e]||{},this._managedElements[t].data[e][n]=i)}},{key:"getManagedElement",value:function(t){return this._managedElements[t]?this._managedElements[t].el:null}},{key:"unmanage",value:function(t,e){var n=this;this.removeAllEndpoints(t,!0);var i=function(t){var i=n.getId(t);n.removeAttribute(t,tX),delete n._managedElements[i],n.viewport.remove(i),n.fire(t9,{el:t,id:i}),t&&e&&n._removeElement(t)};this._getAssociatedElements(t).map(i),i(t)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]&&(this._managedElements[i].rotation=e,this.viewport.rotateElement(i,e),!0!==n)?this.revalidate(t):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(t){var e=this._managedElements[t];return null!=e&&e.rotation||0}},{key:"_getRotations",value:function(t){var e=this,n=[],i=this._managedElements[t];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function t(i){if(null!=i.group){var o=e._managedElements[i.group];null!=o&&(n.push({r:o.viewportElement.r,c:o.viewportElement.c}),t(o))}}(i)),n}},{key:"_applyRotations",value:function(t,e){var n=t.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return M(e,function(t){i=td(i,t.c,t.r)}),i}},{key:"_applyRotationsXY",value:function(t,e){return M(e,function(e){t=td(t,e.c,e.r)}),t}},{key:"_internal_newEndpoint",value:function(t){var e=_({},t),n=this.manage(e.element);e.elementId=this.getId(e.element),e.id="ep_"+this._idstamp();var i=new i0(this,e);return null!=n&&n.endpoints.push(i),t.uuid&&this.endpointsByUUID.set(t.uuid,i),G(this.endpointsByElement,i.elementId,i),this._suspendDrawing||this._paintEndpoint(i,{timestamp:this._suspendedAt}),i}},{key:"_deriveEndpointAndAnchorSpec",value:function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),i=null,o=null,s=null,r=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(r=l.anchors),l.anchor&&(s=l.anchor))}return{endpoints:i||[o,o],anchors:r||[s,s]}}},{key:"revalidate",value:function(t,e){var n=this.getId(t);return this.updateOffset({elId:n,recalc:!0,timestamp:e}),this.repaint(t)}},{key:"repaintEverything",value:function(){var t,e=th();for(t in this._managedElements)this.viewport.refreshElement(t,!0);for(t in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(t,e,n){var i=this.getId(t);return this.viewport.setPosition(i,e,n),this.repaint(t)}},{key:"repaint",value:function(t,e,n){var i={c:new Set,e:new Set},o=function(t){t.c.forEach(function(t){return i.c.add(t)}),t.e.forEach(function(t){return i.e.add(t)})};if(!this._suspendDrawing){var s=this.getId(t);if(null!=t){var r=this._getAssociatedElements(t);if(null==e&&(e=th()),!n)for(var a=0;a<r.length;a++)this.updateOffset({elId:this.getId(r[a]),recalc:!0,timestamp:e});if(o(this.router.redraw(s,e,null)),r.length>0)for(var l=0;l<r.length;l++)o(this.router.redraw(this.getId(r[l]),e,null))}}return i}},{key:"unregisterEndpoint",value:function(t){var e,n=t.getUuid();n&&this.endpointsByUUID.delete(n),null!=(e=this._managedElements[t.elementId])&&T(e.endpoints,function(e){return e===t});var i=this.endpointsByElement[t.elementId];null!=i&&(this.endpointsByElement[t.elementId]=i.filter(function(e){return e!==t})),this.fire(t5,t)}},{key:"_maybePruneEndpoint",value:function(t){return!!t.deleteOnEmpty&&0===t.connections.length&&(this.deleteEndpoint(t),!0)}},{key:"deleteEndpoint",value:function(t){var e=this,n="string"==typeof t?this.endpointsByUUID.get(t):t;if(n){var i=n.proxiedBy,o=n.connections.slice();M(o,function(t){n.detachFromConnection(t,null,!0)}),this.unregisterEndpoint(n),n.destroy(),M(o,function(t){e.deleteConnection(t,{force:!0,endpointToIgnore:n})}),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(t,e,n){var i=_({},n=n||{});_(i,e||{});var o=_({element:t},i);return this._internal_newEndpoint(o)}},{key:"addEndpoints",value:function(t,e,n){for(var i=[],o=0,s=e.length;o<s;o++)i.push(this.addEndpoint(t,e[o],n));return i}},{key:"reset",value:function(){var t=this;this.silently(function(){t.endpointsByElement={},t._managedElements={},t.endpointsByUUID.clear(),t.viewport.reset(),t.router.reset(),t.groupManager.reset(),t.connections.length=0})}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(t){return this.endpointsByElement[this.getId(t)]||[]}},{key:"getEndpoint",value:function(t){return this.endpointsByUUID.get(t)}},{key:"setEndpointUuid",value:function(t,e){t.uuid&&this.endpointsByUUID.delete(t.uuid),t.uuid=e,this.endpointsByUUID.set(e,t)}},{key:"connect",value:function(t,e){try{var n=this._prepareConnectionParams(t,e),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(t){tf(t);return}}},{key:"_prepareConnectionParams",value:function(t,e){var n=_({},t);if(e&&_(n,e),n.source&&n.source.endpoint&&(n.sourceEndpoint=n.source),n.target&&n.target.endpoint&&(n.targetEndpoint=n.target),t.uuids&&(n.sourceEndpoint=this.getEndpoint(t.uuids[0]),n.targetEndpoint=this.getEndpoint(t.uuids[1])),null!=n.sourceEndpoint){if(n.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(n.type||(n.type=n.sourceEndpoint.edgeType),n.sourceEndpoint.connectorOverlays){n.overlays=n.overlays||[];for(var i=0,o=n.sourceEndpoint.connectorOverlays.length;i<o;i++)n.overlays.push(n.sourceEndpoint.connectorOverlays[i])}n.sourceEndpoint.scope&&(n.scope=n.sourceEndpoint.scope)}else if(null==n.source)throw"Cannot establish connection: source does not exist";if(null!=n.targetEndpoint){if(n.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(null==n.target)throw"Cannot establish connection: target does not exist";if(n.sourceEndpoint&&n.targetEndpoint&&!function(t,e){for(var n=t.scope.split(/\s/),i=e.scope.split(/\s/),o=0;o<n.length;o++)for(var s=0;s<i.length;s++)if(i[s]===n[o])return!0;return!1}(n.sourceEndpoint,n.targetEndpoint))throw"Cannot establish connection: scopes do not match";return n}},{key:"_newConnection",value:function(t){t.id="con_"+this._idstamp();var e=new i3(this,t);return oL(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this._paintConnection(e),e}},{key:"_finaliseConnection",value:function(t,e,n){e=e||{},t.suspendedEndpoint||this.connections.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,this.repaint(t.source);var i={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};this.fire(t1,i,n),e.doNotFireConnectionEvent||!1===e.fireEvent||this.fire(t0,i,n)}},{key:"removeAllEndpoints",value:function(t,e){var n=this,i=function(t){var e,i,o=n.getId(t),s=n.endpointsByElement[o];if(s)for(e=0,i=s.length;e<i;e++)n.deleteEndpoint(s[e]);delete n.endpointsByElement[o]};return e&&this._getAssociatedElements(t).map(i),i(t),this}},{key:"_createSourceDefinition",value:function(t,e){var n=_({},e);_(n,t),n.edgeType=n.edgeType||ni;var i=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||i.endpoints[0],n.anchor=n.anchor||i.anchors[0];var o=n.maxConnections||-1;return{def:_({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new iA(t,this._createSourceDefinition(e),n);return this.sourceSelectors.push(i),i}},{key:"removeSourceSelector",value:function(t){T(this.sourceSelectors,function(e){return e===t})}},{key:"removeTargetSelector",value:function(t){T(this.targetSelectors,function(e){return e===t})}},{key:"addTargetSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new iA(t,this._createTargetDefinition(e),n);return this.targetSelectors.push(i),i}},{key:"_createTargetDefinition",value:function(t,e){var n=_({},e);_(n,t),n.edgeType=n.edgeType||ni;var i=n.maxConnections||-1;return{def:_({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:i,enabled:!0,endpoint:null}}},{key:"show",value:function(t,e){return this._setVisible(t,tH,e)}},{key:"hide",value:function(t,e){return this._setVisible(t,tR,e)}},{key:"_setVisible",value:function(t,e,n){var i=e===tH,o=null;n&&(o=function(t){t.setVisible(i,!0,!0)});var s=this.getId(t);return this._operation(t,function(t){if(i&&n){var e=t.sourceId===s?1:0;t.endpoints[e].isVisible()&&t.setVisible(!0)}else t.setVisible(i)},o),this}},{key:"toggleVisible",value:function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),this._operation(t,function(t){var e=t.isVisible();t.setVisible(!e)},n)}},{key:"_operation",value:function(t,e,n){var i=this.getId(t),o=this.endpointsByElement[i];if(o&&o.length)for(var s=0,r=o.length;s<r;s++){for(var a=0,l=o[s].connections.length;a<l;a++)if(e(o[s].connections[a]))return;n&&n(o[s])}}},{key:"registerConnectionType",value:function(t,e){if(this._connectionTypes.set(t,_({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=iF(e.overlays[i]);n[o.options.id]=o}this._connectionTypes.get(t).overlays=n}}},{key:"registerConnectionTypes",value:function(t){for(var e in t)this.registerConnectionType(e,t[e])}},{key:"registerEndpointType",value:function(t,e){if(this._endpointTypes.set(t,_({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=iF(e.overlays[i]);n[o.options.id]=o}this._endpointTypes.get(t).overlays=n}}},{key:"registerEndpointTypes",value:function(t){for(var e in t)this.registerEndpointType(e,t[e])}},{key:"getType",value:function(t,e){return"connection"===e?this.getConnectionType(t):this.getEndpointType(t)}},{key:"getConnectionType",value:function(t){return this._connectionTypes.get(t)}},{key:"getEndpointType",value:function(t){return this._endpointTypes.get(t)}},{key:"importDefaults",value:function(t){for(var e in t)this.defaults[e]=t[e];return null!=this.defaults[oa]&&(this.defaults[oa].strokeWidth=this.defaults[oa].strokeWidth||2),t.container&&this.setContainer(t.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=_({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(t,e,n,i,o){var s,r=null!=t.proxies[e],a=r?t.proxies[e].originalEp.elementId:t.endpoints[e].elementId,l=r?t.proxies[e].originalEp:t.endpoints[e],u=this.getId(n);t.proxies[e]?t.proxies[e].ep.elementId===u?s=t.proxies[e].ep:(t.proxies[e].ep.detachFromConnection(t,e),s=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}})):s=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}}),s.deleteOnEmpty=!0,t.proxies[e]={ep:s,originalEp:l},this.sourceOrTargetChanged(a,u,t,n,e),l.detachFromConnection(t,null,!0),s.connections=[t],t.endpoints[e]=s,l.proxiedBy=s,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(t,e){if(null!=t.proxies&&null!=t.proxies[e]){var n=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId,o=t.proxies[e].ep.elementId;t.endpoints[e]=t.proxies[e].originalEp,delete t.proxies[e].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,t,n,e),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),t.proxies[e]=null,-1===A(t.proxies,function(t){return null!=t})&&(t.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(t,e,n,i,o){t!==e&&(0===o?(n.sourceId=e,n.source=i):1===o&&(n.targetId=e,n.target=i),oF(n,this._managedElements[t]),oL(n,this._managedElements[e]))}},{key:"getGroup",value:function(t){return this.groupManager.getGroup(t)}},{key:"getGroupFor",value:function(t){return this.groupManager.getGroupFor(t)}},{key:"addGroup",value:function(t){return this.groupManager.addGroup(t)}},{key:"addToGroup",value:function(t){for(var e,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(e=this.groupManager).addToGroup.apply(e,[t,!1].concat(i))}},{key:"collapseGroup",value:function(t){this.groupManager.collapseGroup(t)}},{key:"expandGroup",value:function(t){this.groupManager.expandGroup(t)}},{key:"toggleGroup",value:function(t){this.groupManager.toggleGroup(t)}},{key:"removeGroup",value:function(t,e,n,i){return this.groupManager.removeGroup(t,e,n,i)}},{key:"removeAllGroups",value:function(t,e){this.groupManager.removeAllGroups(t,e,!1)}},{key:"removeFromGroup",value:function(t,e,n){this.groupManager.removeFromGroup(t,n,e),this._appendElement(e,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(e)})}},{key:"_paintEndpoint",value:function(t,e){var n=(e=e||{}).timestamp,i=!1!==e.recalc;if(!n||t.timestamp!==n){var o=this.viewport.getPosition(t.elementId),s=e.offset?{x:e.offset.x,y:e.offset.y}:{x:o.x,y:o.y};if(null!=s){var r=e.anchorLoc;if(null==r){var a={xy:s,wh:o,element:t,timestamp:n};if(i&&this.router.isDynamicAnchor(t)&&t.connections.length>0){var l=function(t){var n=0;if(null!=e.elementWithPrecedence){for(var i=0;i<t.connections.length;i++)if(t.connections[i].sourceId===e.elementWithPrecedence||t.connections[i].targetId===e.elementWithPrecedence){n=i;break}}return t.connections[n]}(t),u=l.endpoints[0]===t?1:0,c=0===u?l.sourceId:l.targetId,h=this.viewport.getPosition(c);a.index=0===u?1:0,a.connection=l,a.txy=h,a.twh=h,a.tElement=l.endpoints[u],a.tRotation=this._getRotations(c)}else t.connections.length>0&&(a.connection=t.connections[0]);a.rotation=this._getRotations(t.elementId),r=this.router.computeAnchorLocation(t._anchor,a)}for(var d in t.endpoint.compute(r,this.router.getEndpointOrientation(t),t.paintStyleInUse),this.renderEndpoint(t,t.paintStyleInUse),t.timestamp=n,t.overlays)if(t.overlays.hasOwnProperty(d)){var p=t.overlays[d];p.isVisible()&&(t.overlayPlacements[d]=this.drawOverlay(p,t.endpoint,t.paintStyleInUse,t.getAbsoluteOverlayPosition(p)),this._paintOverlay(p,t.overlayPlacements[d],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(t,e){if(!this._suspendDrawing&&!1!==t.visible){var n=(e=e||{}).timestamp;if(null==n||n!==t.lastPaintedAt){if(null==n||n!==t.lastPaintedAt){this.router.computePath(t,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var o in t.overlays)if(t.overlays.hasOwnProperty(o)){var s=t.overlays[o];s.isVisible()&&(t.overlayPlacements[o]=this.drawOverlay(s,t.connector,t.paintStyleInUse,t.getAbsoluteOverlayPosition(s)),i.xmin=Math.min(i.xmin,t.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,t.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,t.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,t.overlayPlacements[o].ymax))}var r=parseFloat(""+t.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+t.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(t.connector.bounds.xmin-(r+a),i.xmin),ymin:Math.min(t.connector.bounds.ymin-(r+a),i.ymin),xmax:Math.max(t.connector.bounds.xmax+(r+a),i.xmax),ymax:Math.max(t.connector.bounds.ymax+(r+a),i.ymax)};for(var u in this.paintConnector(t.connector,t.paintStyleInUse,l),t.overlays)if(t.overlays.hasOwnProperty(u)){var c=t.overlays[u];c.isVisible()&&this._paintOverlay(c,t.overlayPlacements[u],l)}}t.lastPaintedAt=n}}}},{key:"_refreshEndpoint",value:function(t){t._anchor.isFloating||(t.connections.length>0?this.addEndpointClass(t,this.endpointConnectedClass):this.removeEndpointClass(t,this.endpointConnectedClass),t.isFull()?this.addEndpointClass(t,this.endpointFullClass):this.removeEndpointClass(t,this.endpointFullClass))}},{key:"_makeConnector",value:function(t,e,n){return oj(t,e,n)}},{key:"addOverlay",value:function(t,e,n){if(t.addOverlay(e),!n){var i=t instanceof i0?t.element:t.source;this.revalidate(i)}}},{key:"removeOverlay",value:function(t,e){t.removeOverlay(e);var n=t instanceof i0?t.element:t.source;this.revalidate(n)}},{key:"setOutlineColor",value:function(t,e){t.paintStyleInUse.outlineStroke=e,this._paintConnection(t)}},{key:"setOutlineWidth",value:function(t,e){t.paintStyleInUse.outlineWidth=e,this._paintConnection(t)}},{key:"setColor",value:function(t,e){t.paintStyleInUse.stroke=e,this._paintConnection(t)}},{key:"setLineWidth",value:function(t,e){t.paintStyleInUse.strokeWidth=e,this._paintConnection(t)}},{key:"setLineStyle",value:function(t,e){null!=e.lineWidth&&(t.paintStyleInUse.strokeWidth=e.lineWidth),null!=e.outlineWidth&&(t.paintStyleInUse.outlineWidth=e.outlineWidth),null!=e.color&&(t.paintStyleInUse.stroke=e.color),null!=e.outlineColor&&(t.paintStyleInUse.outlineStroke=e.outlineColor),this._paintConnection(t)}},{key:"getPathData",value:function(t){for(var e="",n=0;n<t.segments.length;n++)e+=t.segments[n].getPath(0===n)+" ";return e}}]),n}(iL),oR={};function oN(t,e,n){var o=i(e.getBoundingClientRect)!==nn?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||s.scrollTop,l=window.pageXOffset||r.scrollLeft||s.scrollLeft,u=r.clientTop||s.clientTop||0,c=r.clientLeft||s.clientLeft||0,h=o.top+a-u+0*n,d=o.left+l-c+0*n,p=nv(t),v=o.width||e.offsetWidth*n,f=o.height||e.offsetHeight*n;return{x:(p.x-d)/v,y:(p.y-h)/f}}function oB(t){return ot(t)||on(t)||oo(t)}function oY(t,e){t.canvas&&(t.canvas.style.display=e?"block":"none")}function oX(t){t.canvas&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas}function oz(t){return t.canvas}function oV(t){return iG.getElement(t)}function oU(t){return iG.getElement(t,t.component,function(e){var n=t.create(e);return t.instance.addClass(n,t.instance.overlayClass),n})}function oW(t,e,n,i){var o=t.x,s=t.y;return e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain&&(o=Math.max(t.x,0),s=Math.max(t.y,0),o=Math.min(o,n.w-i.w),s=Math.min(s,n.h-i.h)),{x:o,y:s}}var oq=function(t){l(n,t);var e=d(n);function n(t,i){var s;if(o(this,n),(s=e.call(this,t,i))._instanceIndex=t,a(h(s),"containerType",null),a(h(s),"dragSelection",void 0),a(h(s),"dragManager",void 0),a(h(s),"_connectorClick",void 0),a(h(s),"_connectorDblClick",void 0),a(h(s),"_connectorTap",void 0),a(h(s),"_connectorDblTap",void 0),a(h(s),"_endpointClick",void 0),a(h(s),"_endpointDblClick",void 0),a(h(s),"_overlayClick",void 0),a(h(s),"_overlayDblClick",void 0),a(h(s),"_overlayTap",void 0),a(h(s),"_overlayDblTap",void 0),a(h(s),"_connectorMouseover",void 0),a(h(s),"_connectorMouseout",void 0),a(h(s),"_endpointMouseover",void 0),a(h(s),"_endpointMouseout",void 0),a(h(s),"_connectorContextmenu",void 0),a(h(s),"_connectorMousedown",void 0),a(h(s),"_connectorMouseup",void 0),a(h(s),"_endpointMousedown",void 0),a(h(s),"_endpointMouseup",void 0),a(h(s),"_overlayMouseover",void 0),a(h(s),"_overlayMouseout",void 0),a(h(s),"_elementClick",void 0),a(h(s),"_elementTap",void 0),a(h(s),"_elementDblTap",void 0),a(h(s),"_elementMouseenter",void 0),a(h(s),"_elementMouseexit",void 0),a(h(s),"_elementMousemove",void 0),a(h(s),"_elementMouseup",void 0),a(h(s),"_elementMousedown",void 0),a(h(s),"_elementContextmenu",void 0),a(h(s),"_resizeObserver",void 0),a(h(s),"eventManager",void 0),a(h(s),"draggingClass","jtk-dragging"),a(h(s),"elementDraggingClass","jtk-element-dragging"),a(h(s),"hoverClass","jtk-hover"),a(h(s),"sourceElementDraggingClass","jtk-source-element-dragging"),a(h(s),"targetElementDraggingClass","jtk-target-element-dragging"),a(h(s),"hoverSourceClass","jtk-source-hover"),a(h(s),"hoverTargetClass","jtk-target-hover"),a(h(s),"dragSelectClass","jtk-drag-select"),a(h(s),"managedElementsSelector",void 0),a(h(s),"elementsDraggable",void 0),a(h(s),"elementDragHandler",void 0),a(h(s),"groupDragOptions",void 0),a(h(s),"elementDragOptions",void 0),a(h(s),"svg",{node:function(t,e){return eu(t,e)},attr:function(t,e){return el(t,e)},pos:function(t){return ec(t)}}),i=i||{},s.containerType=tI(s.getContainer()),s.elementsDraggable=i&&!1!==i.elementsDraggable,s.managedElementsSelector=i&&i.managedElementsSelector||en,s.eventManager=new nw,s.dragSelection=new n1(h(s)),s.dragManager=new n3(h(s),s.dragSelection),s.dragManager.addHandler(new iI(h(s))),s.groupDragOptions={constrainFunction:oW},s.dragManager.addHandler(new iO(h(s),s.dragSelection),s.groupDragOptions),s.elementDragHandler=new n4(h(s),s.dragSelection),s.elementDragOptions=i&&i.dragOptions||{},s.dragManager.addHandler(s.elementDragHandler,s.elementDragOptions),i&&i.dragOptions&&i.dragOptions.filter&&s.dragManager.addFilter(i.dragOptions.filter),s._createEventListeners(),s._attachEventDelegates(),!1!==i.resizeObserver)try{s._resizeObserver=new ResizeObserver(function(t){t.filter(function(t){var e=s.getAttribute(t.target,tX);if(null==e)return!1;var n=s.viewport._elementMap.get(e);return!!n&&(n.w!==t.contentRect.width||n.h!==t.contentRect.height)}).forEach(function(t){return s.revalidate(t.target)})})}catch(t){tf("WARN: ResizeObserver could not be attached.")}return s}return r(n,[{key:"fireOverlayMethod",value:function(t,e,n){var i=ep(t.component instanceof i3?e_:ey,e);n._jsPlumbOverlay=t,t.fire(e,{e:n,overlay:t}),this.fire(i,t.component,n)}},{key:"addDragFilter",value:function(t,e){this.dragManager.addFilter(t,e)}},{key:"removeDragFilter",value:function(t){this.dragManager.removeFilter(t)}},{key:"setDragGrid",value:function(t){this.dragManager.setOption(this.elementDragHandler,{grid:t})}},{key:"setDragConstrainFunction",value:function(t){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:t})}},{key:"_removeElement",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"_appendElement",value:function(t,e){e&&e.appendChild(t)}},{key:"_appendElementToGroup",value:function(t,e){this.getGroupContentArea(t).appendChild(e)}},{key:"_appendElementToContainer",value:function(t){this._appendElement(t,this.getContainer())}},{key:"_getAssociatedElements",value:function(t){var e=[];if(3!==t.nodeType&&8!==t.nodeType){var n=t.querySelectorAll(en);Array.prototype.push.apply(e,n)}return e.filter(function(t){return 3!==t.nodeType&&8!==t.nodeType})}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getClass",value:function(t){return tE(t)}},{key:"addClass",value:function(t,e){tw(t,e)}},{key:"hasClass",value:function(t,e){return t.classList?t.classList.contains(e):-1!==tE(t).indexOf(e)}},{key:"removeClass",value:function(t,e){tM(t,e)}},{key:"toggleClass",value:function(t,e){!function(t,e){var n=this,i=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?t.classList.toggle(e):n.hasClass(t,e)?n.removeClass(t,e):n.addClass(t,e))};tS(t)?M(t,function(t){return i(t,e)}):i(t,e)}(t,e)}},{key:"setAttribute",value:function(t,e,n){t.setAttribute(e,n)}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"setAttributes",value:function(t,e){for(var n in e)t.setAttribute(n,e[n])}},{key:"removeAttribute",value:function(t,e){t.removeAttribute&&t.removeAttribute(e)}},{key:"on",value:function(t,e,n,i){var o=this,s=function(t){null==i?o.eventManager.on(t,e,n):o.eventManager.on(t,e,n,i)};return tS(t)?M(t,function(t){return s(t)}):s(t),this}},{key:"off",value:function(t,e,n){var i=this;return tS(t)?M(t,function(t){return i.eventManager.off(t,e,n)}):this.eventManager.off(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){this.eventManager.trigger(t,e,n,i,o)}},{key:"getOffsetRelativeToRoot",value:function(t){return tD(t)}},{key:"getOffset",value:function(t){for(var e,n=this.getContainer(),i=this.getPosition(t),o=t!==n&&t.offsetParent!==n?t.offsetParent:null;null!=o;)i.x+=o.offsetLeft,i.y+=o.offsetTop,null!=(e=o)&&e!==document.body&&(e.scrollTop>0||e.scrollLeft>0)&&(i.x-=e.scrollLeft,i.y-=e.scrollTop),o=o.offsetParent===n?null:o.offsetParent;if(null!=n&&(n.scrollTop>0||n.scrollLeft>0)){var s=null!=t.offsetParent?this.getStyle(t.offsetParent,e3):"static",r=this.getStyle(t,e3);r!==tN&&r!==tB&&s!==tN&&s!==tB&&(i.x-=n.scrollLeft,i.y-=n.scrollTop)}return i}},{key:"getSize",value:function(t){return null!=t.offsetWidth?{w:t.offsetWidth,h:t.offsetHeight}:t.width&&t.width.baseVal?function(t){try{return{w:parseFloat(t.width.baseVal.value),h:parseFloat(t.height.baseVal.value)}}catch(t){return{w:0,h:0}}}(t):void 0}},{key:"getPosition",value:function(t){return null!=t.offsetLeft?{x:parseFloat(t.offsetLeft),y:parseFloat(t.offsetTop)}:t.x&&t.x.baseVal?function(t){try{return{x:parseFloat(t.x.baseVal.value),y:parseFloat(t.y.baseVal.value)}}catch(t){return{x:0,y:0}}}(t):void 0}},{key:"getStyle",value:function(t,e){return i(window.getComputedStyle)!==nn?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]}},{key:"getGroupContentArea",value:function(t){var e=this.getSelector(t.el,e8);return e&&e.length>0?e[0]:t.el}},{key:"getSelector",value:function(t,e){var n=null;if(1==arguments.length){if(!k(t)){var i=document.createDocumentFragment();return i.appendChild(t),I(i.childNodes)}n=I(document.querySelectorAll(t))}else n=I(t.querySelectorAll(e));return n}},{key:"setPosition",value:function(t,e){t.style.left=e.x+"px",t.style.top=e.y+"px"}},{key:"setDraggable",value:function(t,e){e?this.removeAttribute(t,tz):this.setAttribute(t,tz,no)}},{key:"isDraggable",value:function(t){var e=this.getAttribute(t,tz);return null==e||e===ns}},{key:"toggleDraggable",value:function(t){var e=this.isDraggable(t);return this.setDraggable(t,!e),!e}},{key:"_createEventListeners",value:function(){var t=function(t,e){if(!e.defaultPrevented&&null==e._jsPlumbOverlay){var n=tb(tC(e),e4,this.getContainer(),!0);this.fire(t,n.jtk.connector.connection,e)}};this._connectorClick=t.bind(this,eZ),this._connectorDblClick=t.bind(this,eJ),this._connectorTap=t.bind(this,e5),this._connectorDblTap=t.bind(this,eK);var e=function(t,e){var n=tC(e).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,o=i.connection;this.setConnectorHover(i,t),t?(this.addClass(o.source,this.hoverSourceClass),this.addClass(o.target,this.hoverTargetClass)):(this.removeClass(o.source,this.hoverSourceClass),this.removeClass(o.target,this.hoverTargetClass)),this.fire(t?eQ:e$,n.jtk.connector.connection,e)}};this._connectorMouseover=e.bind(this,!0),this._connectorMouseout=e.bind(this,!1);var n=function(t,e){var n=tC(e).parentNode;n.jtk&&n.jtk.connector&&this.fire(t?e0:e1,n.jtk.connector.connection,e)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=(function(t){var e=tC(t).parentNode;e.jtk&&e.jtk.connector&&this.fire(e2,e.jtk.connector.connection,t)}).bind(this);var i=function(t,e,n){e.defaultPrevented||null!=e._jsPlumbOverlay||this.fire(t,n.jtk.endpoint,e)};this._endpointClick=i.bind(this,eX),this._endpointDblClick=i.bind(this,ez);var o=function(t,e){var n=tC(e);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,t),this.fire(t?eU:eV,n.jtk.endpoint,e))};this._endpointMouseover=o.bind(this,!0),this._endpointMouseout=o.bind(this,!1);var s=function(t,e){var n=tC(e);n.jtk&&n.jtk.endpoint&&this.fire(t?eW:eq,n.jtk.endpoint,e)};this._endpointMouseup=s.bind(this,!0),this._endpointMousedown=s.bind(this,!1);var r=(function(t,e){var n=tb(tC(e),e7,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,t,e)}).bind(this);this._overlayClick=r.bind(this,ex),this._overlayDblClick=r.bind(this,eb),this._overlayTap=r.bind(this,"tap"),this._overlayDblTap=r.bind(this,eC);var a=function(t,e){var n=tb(tC(e),e7,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,t)};this._overlayMouseover=a.bind(this,!0),this._overlayMouseout=a.bind(this,!1),this._elementClick=(function(t,e,n){e.defaultPrevented||this.fire(1===e.detail?eI:eO,n,e)}).bind(this,eI),this._elementTap=(function(t,e,n){e.defaultPrevented||this.fire(eY,n,e)}).bind(this,eY),this._elementDblTap=(function(t,e,n){e.defaultPrevented||this.fire(eG,n,e)}).bind(this,eG);var l=function(t,e){this.fire(t?eF:eL,tC(e),e)};this._elementMouseenter=l.bind(this,!0),this._elementMouseexit=l.bind(this,!1),this._elementMousemove=(function(t){this.fire(eH,tC(t),t)}).bind(this),this._elementMouseup=(function(t){this.fire(eR,tC(t),t)}).bind(this),this._elementMousedown=(function(t){this.fire(eN,tC(t),t)}).bind(this),this._elementContextmenu=(function(t){this.fire(eB,tC(t),t)}).bind(this)}},{key:"_attachEventDelegates",value:function(){var t=this.getContainer();this.eventManager.on(t,ex,e7,this._overlayClick),this.eventManager.on(t,eb,e7,this._overlayDblClick),this.eventManager.on(t,"tap",e7,this._overlayTap),this.eventManager.on(t,eC,e7,this._overlayDblTap),this.eventManager.on(t,ex,e4,this._connectorClick),this.eventManager.on(t,eb,e4,this._connectorDblClick),this.eventManager.on(t,"tap",e4,this._connectorTap),this.eventManager.on(t,eC,e4,this._connectorDblTap),this.eventManager.on(t,ex,e6,this._endpointClick),this.eventManager.on(t,eb,e6,this._endpointDblClick),this.eventManager.on(t,ex,this.managedElementsSelector,this._elementClick),this.eventManager.on(t,"tap",this.managedElementsSelector,this._elementTap),this.eventManager.on(t,eC,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(t,eD,e4,this._connectorMouseover),this.eventManager.on(t,eA,e4,this._connectorMouseout),this.eventManager.on(t,ek,e4,this._connectorContextmenu),this.eventManager.on(t,eM,e4,this._connectorMouseup),this.eventManager.on(t,eE,e4,this._connectorMousedown),this.eventManager.on(t,eD,e6,this._endpointMouseover),this.eventManager.on(t,eA,e6,this._endpointMouseout),this.eventManager.on(t,eM,e6,this._endpointMouseup),this.eventManager.on(t,eE,e6,this._endpointMousedown),this.eventManager.on(t,eD,e7,this._overlayMouseover),this.eventManager.on(t,eA,e7,this._overlayMouseout),this.eventManager.on(t,eD,en,this._elementMouseenter),this.eventManager.on(t,eA,en,this._elementMouseexit),this.eventManager.on(t,ew,en,this._elementMousemove),this.eventManager.on(t,eM,en,this._elementMouseup),this.eventManager.on(t,eE,en,this._elementMousedown),this.eventManager.on(t,ek,en,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var t=this.getContainer();t&&(this.eventManager.off(t,ex,this._connectorClick),this.eventManager.off(t,eb,this._connectorDblClick),this.eventManager.off(t,"tap",this._connectorTap),this.eventManager.off(t,eC,this._connectorDblTap),this.eventManager.off(t,ex,this._endpointClick),this.eventManager.off(t,eb,this._endpointDblClick),this.eventManager.off(t,ex,this._overlayClick),this.eventManager.off(t,eb,this._overlayDblClick),this.eventManager.off(t,"tap",this._overlayTap),this.eventManager.off(t,eC,this._overlayDblTap),this.eventManager.off(t,ex,this._elementClick),this.eventManager.off(t,"tap",this._elementTap),this.eventManager.off(t,eC,this._elementDblTap),this.eventManager.off(t,eD,this._connectorMouseover),this.eventManager.off(t,eA,this._connectorMouseout),this.eventManager.off(t,ek,this._connectorContextmenu),this.eventManager.off(t,eM,this._connectorMouseup),this.eventManager.off(t,eE,this._connectorMousedown),this.eventManager.off(t,eD,this._endpointMouseover),this.eventManager.off(t,eA,this._endpointMouseout),this.eventManager.off(t,eM,this._endpointMouseup),this.eventManager.off(t,eE,this._endpointMousedown),this.eventManager.off(t,eD,this._overlayMouseover),this.eventManager.off(t,eA,this._overlayMouseout),this.eventManager.off(t,eP,this._elementMouseenter),this.eventManager.off(t,eS,this._elementMouseexit),this.eventManager.off(t,ew,this._elementMousemove),this.eventManager.off(t,eM,this._elementMouseup),this.eventManager.off(t,eE,this._elementMousedown),this.eventManager.off(t,ek,this._elementContextmenu))}},{key:"setContainer",value:function(t){var e,i=this;if(t===document||t===document.body)throw Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(e=this.dragManager.reset()),this.setAttribute(t,ev,th().replace("-",""));var o=this.getContainer();null!=o&&(o.removeAttribute(ev),M(I(o.childNodes).filter(function(t){return null!=t&&(i.hasClass(t,tq)||i.hasClass(t,tZ)||i.hasClass(t,tQ)||t.getAttribute&&null!=t.getAttribute(tX))}),function(e){t.appendChild(e)})),p(u(n.prototype),"setContainer",this).call(this,t),this.containerType=tI(t),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new iI(this)),this.dragManager.addHandler(new iO(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new n4(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=e&&this.dragManager.setFilters(e))}},{key:"reset",value:function(){p(u(n.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect(),M(this.getContainer().querySelectorAll([en,e6,e4,e7].join(",")),function(t){return t.parentNode&&t.parentNode.removeChild(t)})}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),p(u(n.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(t,e){null!=this._resizeObserver&&this._resizeObserver.unobserve(t),this.removeFromDragSelection(t),p(u(n.prototype),"unmanage",this).call(this,t,e)}},{key:"addToDragSelection",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];M(n,function(e){return t.dragSelection.add(e)})}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];M(n,function(e){return t.dragSelection.remove(e)})}},{key:"toggleDragSelection",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];M(n,function(e){return t.dragSelection.toggle(e)})}},{key:"addToDragGroup",value:function(t){for(var e,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).addToDragGroup.apply(e,[t].concat(i))}},{key:"removeFromDragGroup",value:function(){var t;(t=this.elementDragHandler).removeFromDragGroup.apply(t,arguments)}},{key:"setDragGroupState",value:function(t){for(var e,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).setDragGroupState.apply(e,[t].concat(i))}},{key:"clearDragGroup",value:function(t){this.elementDragHandler.clearDragGroup(t)}},{key:"consume",value:function(t,e){tk(t,e)}},{key:"rotate",value:function(t,e,i){var o=this.getId(t);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+e+"deg)",this._managedElements[o].el.style.transformOrigin="center center",p(u(n.prototype),"rotate",this).call(this,t,e,i)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(t,e){if(iY(t))t.instance.addClass(oV(t),e);else if(oB(t))t.instance.addClass(i4(t),e);else if(or(t))t.instance.addClass(oU(t),e);else throw"Could not add class to overlay of type ["+t.type+"]"}},{key:"removeOverlayClass",value:function(t,e){if(iY(t))t.instance.removeClass(oV(t),e);else if(oB(t))t.instance.removeClass(i4(t),e);else if(or(t))t.instance.removeClass(oU(t),e);else throw"Could not remove class from overlay of type ["+t.type+"]"}},{key:"_paintOverlay",value:function(t,e,n){if(iY(t)){oV(t);var i=t.component.getXY();t.canvas.style.left=i.x+e.d.minx+"px",t.canvas.style.top=i.y+e.d.miny+"px"}else if(oB(t)){var o,s,r=isNaN(e.d.cxy.x)||isNaN(e.d.cxy.y)?"M 0 0":"M"+e.d.hxy.x+","+e.d.hxy.y+" L"+e.d.tail[0].x+","+e.d.tail[0].y+" L"+e.d.cxy.x+","+e.d.cxy.y+" L"+e.d.tail[1].x+","+e.d.tail[1].y+" Z";i4(t),o=[0,0],n.xmin<0&&(o[0]=-n.xmin),n.ymin<0&&(o[1]=-n.ymin),s={d:r,stroke:e.stroke?e.stroke:null,fill:e.fill?e.fill:null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"},el(t.path,s)}else if(or(t)){oU(t);var a=t.component.getXY();t.canvas.style.left=a.x+e.d.minx+"px",t.canvas.style.top=a.y+e.d.miny+"px"}else throw"Could not paint overlay of type ["+t.type+"]"}},{key:"setOverlayVisible",value:function(t,e){var n=e?"block":"none";function i(t){null!=t&&(t.style.display=n)}iY(t)?i(oV(t)):or(t)?i(oU(t)):oB(t)&&i(t.path)}},{key:"reattachOverlay",value:function(t,e){iY(t)?t.instance._appendElement(oV(t),this.getContainer()):or(t)?t.instance._appendElement(oU(t),this.getContainer()):oB(t)&&this._appendElement(i4(t),e.connector.canvas)}},{key:"setOverlayHover",value:function(t,e){var n;iY(t)?n=oV(t):or(t)?n=oU(t):oB(t)&&(n=i4(t)),null!=n&&(null!=this.hoverClass&&(e?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(t.component,e))}},{key:"destroyOverlay",value:function(t){if(iY(t)){var e=oV(t);e.parentNode.removeChild(e),delete t.canvas,delete t.cachedDimensions}else if(ot(t)||on(t)||oo(t))null!=t.path&&null!=t.path.parentNode&&t.path.parentNode.removeChild(t.path),null!=t.bgPath&&null!=t.bgPath.parentNode&&t.bgPath.parentNode.removeChild(t.bgPath),delete t.path,delete t.bgPath;else if(or(t)){var n=oU(t);n.parentNode.removeChild(n),delete t.canvas,delete t.cachedDimensions}}},{key:"drawOverlay",value:function(t,e,n,i){if(iY(t)||or(t)){var o=iG._getDimensions(t);if(null==o||null==o.w||null==o.h)return{xmin:0,xmax:0,ymin:0,ymax:0};var s={x:0,y:0};if(i)s={x:i.x,y:i.y};else if(e instanceof it){var r=Array.isArray(t.location)?t.location:[t.location,t.location];s={x:r[0]*e.w,y:r[1]*e.h}}else{var a=t.location,l=!1;(k(t.location)||t.location<0||t.location>1)&&(a=parseInt(""+t.location,10),l=!0),s=e.pointOnPath(a,l)}var u=s.x-o.w/2,c=s.y-o.h/2;return{component:t,d:{minx:u,miny:c,td:o,cxy:s},xmin:u,xmax:u+o.w,ymin:c,ymax:c+o.h}}if(ot(t)||on(t)||oo(t))return t.draw(e,n,i);throw"Could not draw overlay of type ["+t.type+"]"}},{key:"updateLabel",value:function(t){if(E(t.label)){var e=t.label(this);null!=e?oV(t).innerText=e:oV(t).innerText=""}else null==t.labelText&&(t.labelText=t.label,null!=t.labelText?oV(t).innerText=t.labelText:oV(t).innerText="")}},{key:"setHover",value:function(t,e){t._hover=e,t instanceof i0&&null!=t.endpoint?this.setEndpointHover(t,e,-1):t instanceof i3&&null!=t.connector&&this.setConnectorHover(t.connector,e)}},{key:"paintConnector",value:function(t,e,n){!function(t,e,n,i){(function(t,e){if(null!=e.canvas)return e.canvas;var n=eu("svg",{style:"",width:"0",height:"0","pointer-events":tR,position:tN});e.canvas=n,t._appendElement(e.canvas,t.getContainer()),null!=e.cssClass&&t.addClass(n,e.cssClass),t.addClass(n,t.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=e})(t,e),i6.paint(e,t,n,i);var o=[0,0];if(i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin),e.segments.length>0){var s={d:t.getPathData(e),transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"},r=null;if(n.outlineStroke){var a=n.outlineWidth||1,l=n.strokeWidth+2*a;(r=_({},n)).stroke=n.outlineStroke,r.strokeWidth=l,null==e.bgPath?(e.bgPath=eu(er,s),t.addClass(e.bgPath,t.connectorOutlineClass),ed(e.canvas,e.bgPath,0)):el(e.bgPath,s),eh(e.canvas,e.bgPath,r)}null==e.path?(e.path=eu(er,s),ed(e.canvas,e.path,n.outlineStroke?1:0)):(e.path.parentNode!==e.canvas&&ed(e.canvas,e.path,n.outlineStroke?1:0),el(e.path,s)),eh(e.canvas,e.path,n)}}(this,t,e,n)}},{key:"setConnectorHover",value:function(t,e,n){if(!1===e||!this.currentlyDragging&&!this.isHoverSuspended()){var i=t.canvas;null!=i&&(null!=t.hoverClass&&(e?this.addClass(i,t.hoverClass):this.removeClass(i,t.hoverClass)),e?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null==t.connection.hoverPaintStyle||(t.connection.paintStyleInUse=e?t.connection.hoverPaintStyle:t.connection.paintStyle,this._suspendDrawing||this._paintConnection(t.connection)),t.connection.endpoints[0]!==n&&this.setEndpointHover(t.connection.endpoints[0],e,0,!0),t.connection.endpoints[1]!==n&&this.setEndpointHover(t.connection.endpoints[1],e,1,!0)}}},{key:"destroyConnector",value:function(t){null!=t.connector&&oX(t.connector)}},{key:"addConnectorClass",value:function(t,e){t.canvas&&this.addClass(t.canvas,e)}},{key:"removeConnectorClass",value:function(t,e){t.canvas&&this.removeClass(t.canvas,e)}},{key:"getConnectorClass",value:function(t){return t.canvas?t.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(t,e){oY(t,e)}},{key:"applyConnectorType",value:function(t,e){if(t.canvas&&e.cssClass){var n=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(t.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(t,e){var n=oz(t.endpoint);null!=n&&this.addClass(n,e)}},{key:"applyEndpointType",value:function(t,e){if(e.cssClass){var n=oz(t.endpoint);if(n){var i=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(t){var e=this.endpointAnchorClassPrefix+(t.currentAnchorClass?"-"+t.currentAnchorClass:"");this.removeClass(t.element,e),oX(t.endpoint)}},{key:"renderEndpoint",value:function(t,e){var n=oR[t.endpoint.type];null!=n?i9.paint(t.endpoint,n,e):tf("jsPlumb: no endpoint renderer found for type ["+t.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(t,e){var n=oz(t.endpoint);null!=n&&this.removeClass(n,e)}},{key:"getEndpointClass",value:function(t){var e=oz(t.endpoint);return null!=e?e.className:""}},{key:"setEndpointHover",value:function(t,e,n,i){if(null!=t&&(!1===e||!this.currentlyDragging&&!this.isHoverSuspended())){var o=oz(t.endpoint);if(null!=o&&(null!=t.hoverClass&&(e?this.addClass(o,t.hoverClass):this.removeClass(o,t.hoverClass)),0===n||1===n)){var s=0===n?this.hoverSourceClass:this.hoverTargetClass;e?this.addClass(o,s):this.removeClass(o,s)}if(null==t.hoverPaintStyle||(t.paintStyleInUse=e?t.hoverPaintStyle:t.paintStyle,this._suspendDrawing||this.renderEndpoint(t,t.paintStyleInUse)),!i)for(var r=0;r<t.connections.length;r++)this.setConnectorHover(t.connections[r].connector,e,t)}}},{key:"setEndpointVisible",value:function(t,e){oY(t.endpoint,e)}},{key:"setGroupVisible",value:function(t,e){for(var n=t.el.querySelectorAll(en),i=0;i<n.length;i++)e?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(t,e){return null!=t&&!0!==t.deleted&&(!0!==t.endpoints[0].deleted&&this.setEndpointHover(t.endpoints[0],!1,0,!0),!0!==t.endpoints[1].deleted&&this.setEndpointHover(t.endpoints[1],!1,1,!0),p(u(n.prototype),"deleteConnection",this).call(this,t,e))}},{key:"addSourceSelector",value:function(t,e,i){return this.addDragFilter(t),p(u(n.prototype),"addSourceSelector",this).call(this,t,e,i)}},{key:"removeSourceSelector",value:function(t){this.removeDragFilter(t.selector),p(u(n.prototype),"removeSourceSelector",this).call(this,t)}},{key:"manage",value:function(t,e,i){if(this.containerType===J.SVG&&tI(t)!==J.SVG)throw Error("ERROR: cannot manage non-svg element when container is an SVG element.");var o=p(u(n.prototype),"manage",this).call(this,t,e,i);return null!=o&&null!=this._resizeObserver&&this._resizeObserver.observe(o.el),o}}]),n}(oH),oZ=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),a(h(s=e.call(this,t,i)),"width",void 0),a(h(s),"height",void 0),a(h(s),"type",n.type),i=i||{},s.width=i.width||10,s.height=i.height||10,s}return r(n,null,[{key:"_getParams",value:function(t){return{width:t.width,height:t.height}}}]),n}(it);a(oZ,"type","Rectangle");var oJ={type:oZ.type,cls:oZ,compute:function(t,e,n,i){var o=i.width||t.width,s=i.height||t.height,r=e.curX-o/2,a=e.curY-s/2;return t.x=r,t.y=a,t.w=o,t.h=s,[r,a,o,s]},getParams:function(t){return{width:t.width,height:t.height}}},oK=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),a(h(s=e.call(this,t,i)),"type",n.type),s}return n}(it);a(oK,"type","Blank");var o$={type:oK.type,cls:oK,compute:function(t,e,n,i){return t.x=e.curX,t.y=e.curY,t.w=10,t.h=0,[e.curX,e.curY,10,0]},getParams:function(t){return{}}},oQ={width:10,height:0,fill:"transparent",stroke:"transparent"};X=ol.type,z={makeNode:function(t,e){return eu("circle",{cx:t.w/2,cy:t.h/2,r:t.radius})},updateNode:function(t,e){el(e,{cx:""+t.w/2,cy:""+t.h/2,r:""+t.radius})}},oR[X]=z,V=oK.type,U={makeNode:function(t,e){return eu("rect",oQ)},updateNode:function(t,e){el(e,oQ)}},oR[V]=U,W=oZ.type,q={makeNode:function(t,e){return eu("rect",{width:t.w,height:t.h})},updateNode:function(t,e){el(e,{width:t.w,height:t.h})}},oR[W]=q,(Z=tl||(tl={}))[Z.top=0]="top",Z[Z.bottom=1]="bottom";var o0=new Map;o0.set(tl.top,[$.TopRight,$.TopLeft]),o0.set(tl.bottom,[$.BottomRight,$.BottomLeft]);var o1={deriveAnchor:function(t,e,n,i){return o0.get(t)[e]}},o2="jtk-scrollable-list",o5=tG(o2),o3="scroll";r(function t(e,n){var i=this;o(this,t),this.instance=e,a(this,"options",void 0),a(this,"count",void 0),a(this,"lists",void 0),this.count=0,this.lists={},this.options=n||{},this.instance.bind(t4,function(t){for(var e=i.instance.getSelector(t.el,o5),n=0;n<e.length;n++)i.addList(e[n])}),this.instance.bind(t9,function(t){i.removeList(t.el)}),this.instance.bind(t0,function(t,e){if(null==e){var n=i.findParentList(t.target);null!=n&&n.newConnection(t.connection,t.target,1);var o=i.findParentList(t.source);null!=o&&o.newConnection(t.connection,t.source,0)}}),this.instance.bind(et,function(t){var e=t.dropEndpoint.element,n=i.findParentList(e);return null==n||e.offsetTop>=n.domElement.scrollTop&&e.offsetTop+e.offsetHeight<=n.domElement.scrollTop+n.domElement.offsetHeight})},[{key:"addList",value:function(t,e){var n=_({},o1);_(n,this.options),e=_(n,e||{});var i=[this.instance._instanceIndex,this.count++].join("_");return this.lists[i]=new o4(this.instance,t,e,i),this.lists[i]}},{key:"getList",value:function(t){var e=this.instance.getAttribute(t,o2);if(null!=e)return this.lists[e]}},{key:"removeList",value:function(t){var e=this.getList(t);e&&(e.destroy(),delete this.lists[e.id])}},{key:"findParentList",value:function(t){for(var e,n=t.parentNode,i=this.instance.getContainer();null!=n&&n!==i&&n!==document;){if(null!=(e=this.getList(n)))return e;n=n.parentNode}}}]);var o4=function(){function t(e,n,i,s){o(this,t),this.instance=e,this.el=n,this.options=i,this.id=s,a(this,"_scrollHandler",void 0),a(this,"domElement",void 0),a(this,"elId",void 0),this.domElement=n,this.elId=this.instance.getId(n),e.setAttribute(n,o2,s),this._scrollHandler=this.scrollHandler.bind(this),this.domElement._jsPlumbScrollHandler=this._scrollHandler,e.on(n,o3,this._scrollHandler),this._scrollHandler()}return r(t,[{key:"deriveAnchor",value:function(t,e,n,i){return this.options.anchor?this.options.anchor:this.options.deriveAnchor(t,e,n,i)}},{key:"deriveEndpoint",value:function(t,e,n,i){return this.options.deriveEndpoint?this.options.deriveEndpoint(t,e,n,i):this.options.endpoint?this.options.endpoint:n.endpoint.type}},{key:"newConnection",value:function(t,e,n){e.offsetTop<this.el.scrollTop?this._proxyConnection(e,t,n,tl.top):e.offsetTop+e.offsetHeight>this.el.scrollTop+this.domElement.offsetHeight&&this._proxyConnection(e,t,n,tl.bottom)}},{key:"scrollHandler",value:function(){for(var t=this,e=this.instance.getSelector(this.el,en),n=function(n){if(e[n].offsetTop<t.el.scrollTop)e[n]._jsPlumbProxies=e[n]._jsPlumbProxies||[],t.instance.select({source:e[n]}).each(function(i){t._proxyConnection(e[n],i,0,tl.top)}),t.instance.select({target:e[n]}).each(function(i){t._proxyConnection(e[n],i,1,tl.top)});else if(e[n].offsetTop+e[n].offsetHeight>t.el.scrollTop+t.domElement.offsetHeight)e[n]._jsPlumbProxies=e[n]._jsPlumbProxies||[],t.instance.select({source:e[n]}).each(function(i){t._proxyConnection(e[n],i,0,tl.bottom)}),t.instance.select({target:e[n]}).each(function(i){t._proxyConnection(e[n],i,1,tl.bottom)});else if(e[n]._jsPlumbProxies){for(var i=0;i<e[n]._jsPlumbProxies.length;i++)t.instance.unproxyConnection(e[n]._jsPlumbProxies[i][0],e[n]._jsPlumbProxies[i][1]);delete e[n]._jsPlumbProxies}t.instance.revalidate(e[n])},i=0;i<e.length;i++)n(i)}},{key:"_proxyConnection",value:function(t,e,n,i){var o=this;this.instance.proxyConnection(e,n,this.domElement,function(t,n){return o.deriveEndpoint(i,n,e.endpoints[n],e)},function(t,n){return o.deriveAnchor(i,n,e.endpoints[n],e)}),t._jsPlumbProxies=t._jsPlumbProxies||[],t._jsPlumbProxies.push([e,n])}},{key:"destroy",value:function(){this.instance.off(this.el,o3,this._scrollHandler),delete this.domElement._jsPlumbScrollHandler;for(var t=this.instance.getSelector(this.el,en),e=0;e<t.length;e++)if(t[e]._jsPlumbProxies){for(var n=0;n<t[e]._jsPlumbProxies.length;n++)this.instance.unproxyConnection(t[e]._jsPlumbProxies[n][0],t[e]._jsPlumbProxies[n][1]);delete t[e]._jsPlumbProxies}}}]),t}();function o6(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<1e-10?e:n-t<1e-10?n:t}var o9=function(t){l(n,t);var e=d(n);function n(t){o(this,n),a(h(i=e.call(this,t)),"type",n.segmentType),a(h(i),"cx",void 0),a(h(i),"cy",void 0),a(h(i),"radius",void 0),a(h(i),"anticlockwise",void 0),a(h(i),"startAngle",void 0),a(h(i),"endAngle",void 0),a(h(i),"sweep",void 0),a(h(i),"length",void 0),a(h(i),"circumference",void 0),a(h(i),"frac",void 0),i.cx=t.cx,i.cy=t.cy,i.radius=t.r,i.anticlockwise=t.ac,t.startAngle&&t.endAngle?(i.startAngle=t.startAngle,i.endAngle=t.endAngle,i.x1=i.cx+i.radius*Math.cos(i.startAngle),i.y1=i.cy+i.radius*Math.sin(i.startAngle),i.x2=i.cx+i.radius*Math.cos(i.endAngle),i.y2=i.cy+i.radius*Math.sin(i.endAngle)):(i.startAngle=i._calcAngle(i.x1,i.y1),i.endAngle=i._calcAngle(i.x2,i.y2)),i.endAngle<0&&(i.endAngle+=nD),i.startAngle<0&&(i.startAngle+=nD);var i,s=i.endAngle<i.startAngle?i.endAngle+nD:i.endAngle;return i.sweep=Math.abs(s-i.startAngle),i.anticlockwise&&(i.sweep=nD-i.sweep),i.circumference=2*Math.PI*i.radius,i.frac=i.sweep/nD,i.length=i.circumference*i.frac,i.extents={xmin:i.cx-i.radius,xmax:i.cx+i.radius,ymin:i.cy-i.radius,ymax:i.cy+i.radius},i}return r(n,[{key:"_calcAngle",value:function(t,e){var n,i,o,s;return o=Math.atan(nj(n={x:this.cx,y:this.cy},i={x:t,y:e})),(4==(s=nI(n,i))||3==s)&&(o+=Math.PI),o<0&&(o+=2*Math.PI),o}},{key:"_calcAngleForLocation",value:function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+nD:t.startAngle,i=Math.abs(n-t.endAngle);return n-i*e}var o=Math.abs((t.endAngle<t.startAngle?t.endAngle+nD:t.endAngle)-t.startAngle);return t.startAngle+o*e}},{key:"getPath",value:function(t){var e=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(t?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+e+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(t,e){if(0===t)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===t)return{x:this.x2,y:this.y2,theta:this.endAngle};e&&(t/=length);var n=this._calcAngleForLocation(this,t),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:o6(i),y:o6(o),theta:n}}},{key:"gradientAtPoint",value:function(t,e){var n,i=this.pointOnPath(t,e),o=-1/nj(n={x:this.cx,y:this.cy},i);return this.anticlockwise||o!==1/0&&o!==-1/0||(o*=-1),o}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e/this.circumference*2*Math.PI,s=this.anticlockwise?-1:1,r=i.theta+s*o;return{x:this.cx+this.radius*Math.cos(r),y:this.cy+this.radius*Math.sin(r)}}}]),n}(ne);a(o9,"segmentType","Arc");var o8=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),(s=e.call(this,t,i)).connection=t,a(h(s),"showLoopback",void 0),a(h(s),"curviness",void 0),a(h(s),"margin",void 0),a(h(s),"proximityLimit",void 0),a(h(s),"orientation",void 0),a(h(s),"loopbackRadius",void 0),a(h(s),"clockwise",void 0),a(h(s),"isLoopbackCurrently",void 0),a(h(s),"geometry",null),i=i||{},s.showLoopback=!1!==i.showLoopback,s.curviness=i.curviness||10,s.margin=i.margin||5,s.proximityLimit=i.proximityLimit||80,s.clockwise=i.orientation&&"clockwise"===i.orientation,s.loopbackRadius=i.loopbackRadius||25,s.isLoopbackCurrently=!1,s}return r(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){var n=e.sourcePos,i=e.targetPos,o=Math.abs(n.curX-i.curX),s=Math.abs(n.curY-i.curY);if(this.showLoopback&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var r=e.sourcePos.curX,a=e.sourcePos.curY-this.margin,l=a-this.loopbackRadius,u=r-this.loopbackRadius,c=l-this.loopbackRadius;o=2*this.loopbackRadius,s=2*this.loopbackRadius,t.points[0]=u,t.points[1]=c,t.points[2]=o,t.points[3]=s,this._addSegment(o9,{loopback:!0,x1:r-u+4,y1:a-c,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:r-u-4,y2:a-c,cx:r-u,cy:l-c})}else this.isLoopbackCurrently=!1,this._computeBezier(t,e,n,i,o,s)}},{key:"exportGeometry",value:function(){return null==this.geometry?null:{controlPoints:[_({},this.geometry.controlPoints[0]),_({},this.geometry.controlPoints[1])],source:_({},this.geometry.source),target:_({},this.geometry.target)}}},{key:"transformGeometry",value:function(t,e,n){return{controlPoints:[{x:t.controlPoints[0].x+e,y:t.controlPoints[0].y+n},{x:t.controlPoints[1].x+e,y:t.controlPoints[1].y+n}],source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}},{key:"importGeometry",value:function(t){return null!=t&&(null==t.controlPoints||2!=t.controlPoints.length?(tf("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):null==t.controlPoints[0].x||null==t.controlPoints[0].y||null==t.controlPoints[1].x||null==t.controlPoints[1].y?(tf("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):null==t.source||null==t.source.curX||null==t.source.curY?(tf("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):null==t.target||null==t.target.curX||null==t.target.curY?(tf("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(t,!1),!0))}}]),n}(i8),o7={subtract:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dotProduct:function(t,e){return t.x*e.x+t.y*e.y},square:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},scale:function(t,e){return{x:t.x*e,y:t.y*e}}};function st(t,e,n,i,o){for(var s=[[]],r=0;r<=e;r++)s[0][r]=t[r];for(var a=1;a<=e;a++)for(var l=0;l<=e-a;l++)s[a]||(s[a]=[]),s[a][l]||(s[a][l]={}),s[a][l].x=(1-n)*s[a-1][l].x+n*s[a-1][l+1].x,s[a][l].y=(1-n)*s[a-1][l].y+n*s[a-1][l+1].y;if(null!=i)for(var u=0;u<=e;u++)i[u]=s[u][0];if(null!=o)for(var c=0;c<=e;c++)o[c]=s[e-c][c];return s[e][0]}var se=new Map;function sn(t,e){for(var n=function(t){var e=se.get(t);if(!e){var n=function(t){return function(e){return t}},i=function(t){return function(e){for(var n=1,i=0;i<t.length;i++)n*=t[i](e);return n}};(e=[]).push(function(e){return Math.pow(e,t)});for(var o=1;o<t;o++){for(var s=[n(t)],r=0;r<t-o;r++)s.push(function(t){return t});for(var a=0;a<o;a++)s.push(function(t){return 1-t});e.push(i(s))}e.push(function(e){return Math.pow(1-e,t)}),se.set(t,e)}return e}(t.length-1),i=0,o=0,s=0;s<t.length;s++)i+=t[s].x*n[s](e),o+=t[s].y*n[s](e);return{x:i,y:o}}function si(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function so(t){return t[0].x===t[1].x&&t[0].y===t[1].y}function ss(t,e,n){if(so(t))return{point:t[0],location:e};for(var i=sn(t,e),o=0,s=e,r=n>0?1:-1,a=null;o<Math.abs(n);)s+=.005*r,o+=si(a=sn(t,s),i),i=a;return{point:a,location:s}}function sr(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function sa(t,e,n,i){var o,s,r=e/t,a=n/t,l=(3*a-Math.pow(r,2))/9,u=(9*r*a-i/t*27-2*Math.pow(r,3))/54,c=Math.pow(l,3)+Math.pow(u,2),h=[0,0,0];if(c>=0)o=tg(u+Math.sqrt(c))*Math.pow(Math.abs(u+Math.sqrt(c)),1/3),s=tg(u-Math.sqrt(c))*Math.pow(Math.abs(u-Math.sqrt(c)),1/3),h[0]=-r/3+(o+s),h[1]=-r/3-(o+s)/2,h[2]=-r/3-(o+s)/2,0!==Math.abs(Math.sqrt(3)*(o-s)/2)&&(h[1]=-1,h[2]=-1);else{var d=Math.acos(u/Math.sqrt(-Math.pow(l,3)));h[0]=2*Math.sqrt(-l)*Math.cos(d/3)-r/3,h[1]=2*Math.sqrt(-l)*Math.cos((d+2*Math.PI)/3)-r/3,h[2]=2*Math.sqrt(-l)*Math.cos((d+4*Math.PI)/3)-r/3}for(var p=0;p<3;p++)(h[p]<0||h[p]>1)&&(h[p]=-1);return h}var sl=function(t){l(n,t);var e=d(n);function n(t){var i;return o(this,n),a(h(i=e.call(this,t)),"curve",void 0),a(h(i),"cp1x",void 0),a(h(i),"cp1y",void 0),a(h(i),"cp2x",void 0),a(h(i),"cp2y",void 0),a(h(i),"length",0),a(h(i),"type",n.segmentType),i.cp1x=t.cp1x,i.cp1y=t.cp1y,i.cp2x=t.cp2x,i.cp2y=t.cp2y,i.x1=t.x1,i.x2=t.x2,i.y1=t.y1,i.y2=t.y2,i.curve=[{x:i.x1,y:i.y1},{x:i.cp1x,y:i.cp1y},{x:i.cp2x,y:i.cp2y},{x:i.x2,y:i.y2}],i.extents={xmin:Math.min(i.x1,i.x2,i.cp1x,i.cp2x),ymin:Math.min(i.y1,i.y2,i.cp1y,i.cp2y),xmax:Math.max(i.x1,i.x2,i.cp1x,i.cp2x),ymax:Math.max(i.y1,i.y2,i.cp1y,i.cp2y)},i}return r(n,[{key:"getPath",value:function(t){return(t?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(t,e){return t=n._translateLocation(this.curve,t,e),sn(this.curve,t)}},{key:"gradientAtPoint",value:function(t,e){var i,o,s,r,a,l;return t=n._translateLocation(this.curve,t,e),s=sn(i=this.curve,o=t),a=(r=sn(i.slice(0,i.length-1),o)).y-s.y,l=r.x-s.x,0===a?1/0:Math.atan(a/l)}},{key:"pointAlongPathFrom",value:function(t,e,i){return t=n._translateLocation(this.curve,t,i),ss(this.curve,t,e).point}},{key:"getLength",value:function(){return(null==this.length||0===this.length)&&(this.length=function(t){var e=0;if(!so(t))for(var n=function(t,e){var n=[];t--;for(var i=0;i<=t;i++)n.push(function(t,e){var n={x:0,y:0};if(0===t)return e[0];var i=e.length-1;if(1===t)return e[i];var o=e,s=1-t;if(0===i)return e[0];if(1===i)return{x:s*o[0].x+t*o[1].x,y:s*o[0].y+t*o[1].y};if(!(4>i))return n;var r,a,l,u=s*s,c=t*t,h=0;return 2===i?(o=[o[0],o[1],o[2],n],r=u,a=s*t*2,l=c):3===i&&(r=u*s,a=u*t*3,l=s*c*3,h=t*c),{x:r*o[0].x+a*o[1].x+l*o[2].x+h*o[3].x,y:r*o[0].y+a*o[1].y+l*o[2].y+h*o[3].y}}(i/t,e));return n}(16,t),i=0;i<15;i++)e+=si(n[i],n[i+1]);return e}(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(t,e){var n,i,o=(i=function(t,e){for(var n,i=[],o=function(t,e){for(var n=e.length-1,i=2*n-1,o=[],s=[],r=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],u=0;u<=n;u++)o[u]=o7.subtract(e[u],t);for(var c=0;c<=n-1;c++)s[c]=o7.subtract(e[c+1],e[c]),s[c]=o7.scale(s[c],3);for(var h=0;h<=n-1;h++)for(var d=0;d<=n;d++)r[h]||(r[h]=[]),r[h][d]=o7.dotProduct(s[h],o[d]);for(var p=0;p<=i;p++)a[p]||(a[p]=[]),a[p].y=0,a[p].x=parseFloat(""+p)/i;for(var v=n-1,f=0;f<=n+v;f++)for(var g=Math.max(0,f-v),y=Math.min(f,n),m=g;m<=y;m++){var _=f-m;a[m+_].y+=r[_][m]*l[_][m]}return a}(t,e),s=e.length-1,r=function t(e,n,i,o){var s,r,a,l,u,c=[],h=[],d=[],p=[];switch(function(t,e){var n,i,o=0;n=i=tg(t[0].y);for(var s=1;s<=e;s++)(n=tg(t[s].y))!=i&&o++,i=n;return o}(e,n)){case 0:return 0;case 1:if(o>=64)return i[0]=(e[0].x+e[n].x)/2,1;if(function(t,e){s=t[0].y-t[e].y,r=t[e].x-t[0].x,a=t[0].x*t[e].y-t[e].x*t[0].y,d=p=0;for(var n,i,o,s,r,a,l,u,c,h,d,p,v=1;v<e;v++){var f=s*t[v].x+r*t[v].y+a;f>d?d=f:f<p&&(p=f)}return u=s,c=r,h=a-d,l=1/(0*c-1*u),n=(1*h-0*c)*l,u=s,c=r,h=a-p,l=1/(0*c-1*u),o=Math.min(n,i=(1*h-0*c)*l),Math.max(n,i)-o<2710505431213761e-35?1:0}(e,n))return i[0]=(s=e[n].x-e[0].x,r=e[n].y-e[0].y,a=e[0].x-0,0+(s*(e[0].y-0)-r*a)*(1/(0*s-1*r))*1),1}st(e,n,.5,c,h),l=t(c,n,d,o+1),u=t(h,n,p,o+1);for(var v=0;v<l;v++)i[v]=d[v];for(var f=0;f<u;f++)i[f+l]=p[f];return l+u}(o,2*s-1,i,0),a=o7.subtract(t,e[0]),l=o7.square(a),u=0,c=0;c<r;c++)a=o7.subtract(t,st(e,s,i[c],null,null)),(n=o7.square(a))<l&&(l=n,u=i[c]);return a=o7.subtract(t,e[s]),(n=o7.square(a))<l&&(l=n,u=1),{location:u,distance:l}}({x:t,y:e},n=this.curve),{point:st(n,n.length-1,i.location,null,null),location:i.location});return{d:Math.sqrt(Math.pow(o.point.x-t,2)+Math.pow(o.point.y-e,2)),x:o.point.x,y:o.point.y,l:1-o.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return function(t,e,n,i,o){var s=i-e,r=t-n,a=[sr(o,"x"),sr(o,"y")],l=sa.apply(null,[s*a[0][0]+r*a[1][0],s*a[0][1]+r*a[1][1],s*a[0][2]+r*a[1][2],s*a[0][3]+r*a[1][3]+(t*(e-i)+e*(n-t))]),u=[];if(null!=l)for(var c=0;c<3;c++){var h=l[c],d=Math.pow(h,2),p=Math.pow(h,3),v={x:a[0][0]*p+a[0][1]*d+a[0][2]*h+a[0][3],y:a[1][0]*p+a[1][1]*d+a[1][2]*h+a[1][3]},f=void 0;f=n-t!=0?(v[0]-t)/(n-t):(v[1]-e)/(i-e),h>=0&&h<=1&&f>=0&&f<=1&&u.push(v)}return u}(t,e,n,i,this.curve)}}],[{key:"_translateLocation",value:function(t,e,n){return n&&(e=ss(t,e>0?0:1,e).location),e}}]),n}(ne);a(sl,"segmentType","Bezier");var su=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),(s=e.call(this,t,i)).connection=t,a(h(s),"type",n.type),a(h(s),"majorAnchor",void 0),a(h(s),"minorAnchor",void 0),i=i||{},s.majorAnchor=i.curviness||150,s.minorAnchor=10,s}return r(n,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(t,e,n,i,o){var s=i[0]!==o[0]||i[1]===o[1],r={x:0,y:0};return s?(0===o[0]?r.x=n.curX<e.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:r.x=t.x+this.majorAnchor*o[0],0===o[1]?r.y=n.curY<e.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:r.y=t.y+this.majorAnchor*i[1]):(0===i[0]?r.x=e.curX<n.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:r.x=t.x-this.majorAnchor*i[0],0===i[1]?r.y=e.curY<n.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:r.y=t.y+this.majorAnchor*o[1]),r}},{key:"_computeBezier",value:function(t,e,n,i,o,s){var r,a,l=n.curX<i.curX?o:0,u=n.curY<i.curY?s:0,c=n.curX<i.curX?0:o,h=n.curY<i.curY?0:s;!0!==this.edited?(r=this._findControlPoint({x:l,y:u},n,i,t.so,t.to),a=this._findControlPoint({x:c,y:h},i,n,t.to,t.so)):(r=this.geometry.controlPoints[0],a=this.geometry.controlPoints[1]),this.geometry={controlPoints:[r,a],source:e.sourcePos,target:e.targetPos},this._addSegment(sl,{x1:l,y1:u,x2:c,y2:h,cp1x:r.x,cp1y:r.y,cp2x:a.x,cp2y:a.y})}}]),n}(o8);a(su,"type","Bezier");var sc=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),(s=e.call(this,t,i)).connection=t,a(h(s),"type",n.type),a(h(s),"_controlPoint",void 0),s.curviness=i.curviness||10,s.margin=i.margin||5,s.proximityLimit=i.proximityLimit||80,s.clockwise=i.orientation&&"clockwise"===i.orientation,s}return r(n,[{key:"_computeBezier",value:function(t,e,n,i,o,s){var r,a,l,u,c=n.curX<i.curX?0:o,h=n.curY<i.curY?0:s,d=n.curX<i.curX?o:0,p=n.curY<i.curY?s:0;if(0===n.x&&(c-=this.margin),1===n.x&&(c+=this.margin),0===n.y&&(h-=this.margin),1===n.y&&(h+=this.margin),0===i.x&&(d-=this.margin),1===i.x&&(d+=this.margin),0===i.y&&(p-=this.margin),1===i.y&&(p+=this.margin),!0!==this.edited){var v,f,g,y,m,_,x,k,b=(c+d)/2,C=(h+p)/2,E=(v=c,f=h,g=d,y=p,v<=g&&y<=f?1:v<=g&&f<=y?2:g<=v&&y>=f?3:4),P=Math.sqrt(Math.pow(d-c,2)+Math.pow(p-h,2));this._controlPoint=(m=e.sourcePos,_=e.targetPos,x=this.curviness,k=this.curviness,P<=this.proximityLimit?{x:b,y:C}:1===E?m.curY<=0&&_.curY>=1?{x:b+(m.x<.5?-1*x:x),y:C}:m.curX>=1&&_.curX<=0?{x:b,y:C+(m.y<.5?-1*k:k)}:{x:b+-1*x,y:C+-1*k}:2===E?m.curY>=1&&_.curY<=0?{x:b+(m.x<.5?-1*x:x),y:C}:m.curX>=1&&_.curX<=0?{x:b,y:C+(m.y<.5?-1*k:k)}:{x:b+x,y:C+-1*k}:3===E?m.curY>=1&&_.curY<=0?{x:b+(m.x<.5?-1*x:x),y:C}:m.curX<=0&&_.curX>=1?{x:b,y:C+(m.y<.5?-1*k:k)}:{x:b+-1*x,y:C+-1*k}:4===E?m.curY<=0&&_.curY>=1?{x:b+(m.x<.5?-1*x:x),y:C}:m.curX<=0&&_.curX>=1?{x:b,y:C+(m.y<.5?-1*k:k)}:{x:b+x,y:C+-1*k}:void 0)}else this._controlPoint=this.geometry.controlPoints[0];r=this._controlPoint.x,a=this._controlPoint.x,l=this._controlPoint.y,u=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:e.sourcePos,target:e.targetPos},this._addSegment(sl,{x1:d,y1:p,x2:c,y2:h,cp1x:r,cp1y:l,cp2x:a,cp2y:u})}}]),n}(o8);function sh(t){return t<0?-1:0===t?0:1}function sd(t){return[sh(t[2]-t[0]),sh(t[3]-t[1])]}function sp(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))}function sv(t){var e=[];return e.push.apply(e,t),e}a(sc,"type","StateMachine"),oT(su.type,su),oT(sc.type,sc);var sf=function(t){l(n,t);var e=d(n);function n(t,i){var s;return o(this,n),(s=e.call(this,t,i)).connection=t,a(h(s),"type",n.type),a(h(s),"internalSegments",[]),a(h(s),"midpoint",void 0),a(h(s),"alwaysRespectStubs",void 0),a(h(s),"cornerRadius",void 0),a(h(s),"lastx",void 0),a(h(s),"lasty",void 0),a(h(s),"lastOrientation",void 0),a(h(s),"loopbackRadius",void 0),a(h(s),"isLoopbackCurrently",void 0),s.midpoint=null==i.midpoint||isNaN(i.midpoint)?.5:i.midpoint,s.cornerRadius=null!=i.cornerRadius?i.cornerRadius:0,s.alwaysRespectStubs=!0===i.alwaysRespectStubs,s.lastx=null,s.lasty=null,s.lastOrientation=null,s.loopbackRadius=i.loopbackRadius||25,s.isLoopbackCurrently=!1,s}return r(n,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(t,e,n){if(this.lastx!==t||this.lasty!==e){var i=null==this.lastx?n.sx:this.lastx,o=null==this.lasty?n.sy:this.lasty;this.lastx=t,this.lasty=e,this.internalSegments.push([i,o,t,e,i===t?"v":"h"])}}},{key:"writeSegments",value:function(t){for(var e,n,i,o=null,s=0;s<this.internalSegments.length-1;s++){if(o=o||sv(this.internalSegments[s]),e=sv(this.internalSegments[s+1]),n=sd(o),i=sd(e),this.cornerRadius>0&&o[4]!==e[4]){var r=Math.min(sp(o),sp(e)),a=Math.min(this.cornerRadius,r/2);o[2]-=n[0]*a,o[3]-=n[1]*a,e[0]+=i[0]*a,e[1]+=i[1]*a;var l=n[1]===i[0]&&1===i[0]||n[1]===i[0]&&0===i[0]&&n[0]!==i[1]||n[1]===i[0]&&-1===i[0],u=(e[1]>o[3]?1:-1)==(e[0]>o[2]?1:-1),c=u&&l||!u&&!l?e[0]:o[2],h=u&&l||!u&&!l?o[3]:e[1];this._addSegment(oI,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]}),this._addSegment(o9,{r:a,x1:o[2],y1:o[3],x2:e[0],y2:e[1],cx:c,cy:h,ac:l})}else this._addSegment(oI,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]});o=e}null!=e&&this._addSegment(oI,{x1:e[0],y1:e[1],x2:e[2],y2:e[3]})}},{key:"_compute",value:function(t,e){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var i=function(e){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},o=({perpendicular:i,orthogonal:i,opposite:function(e){var i="x"===e?0:1;return!n.alwaysRespectStubs&&({x:function(){return 1===t.so[i]&&(t.startStubX>t.endStubX&&t.tx>t.startStubX||t.sx>t.endStubX&&t.tx>t.sx)||-1===t.so[i]&&(t.startStubX<t.endStubX&&t.tx<t.startStubX||t.sx<t.endStubX&&t.tx<t.sx)},y:function(){return 1===t.so[i]&&(t.startStubY>t.endStubY&&t.ty>t.startStubY||t.sy>t.endStubY&&t.ty>t.sy)||-1===t.so[i]&&(t.startStubY<t.endStubY&&t.ty<t.startStubY||t.sy<t.endStubY&&t.ty<t.sy)}})[e]()?({x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]})[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}})[t.anchorOrientation](t.sourceAxis),s="x"===t.sourceAxis?0:1,r="x"===t.sourceAxis?1:0,a=o[s],l=o[r],u=o[s+2],c=o[r+2];this.addASegment(o[0],o[1],t);var h=t.startStubX+(t.endStubX-t.startStubX)*this.midpoint,d=t.startStubY+(t.endStubY-t.startStubY)*this.midpoint,p={x:[0,1],y:[1,0]},v=({perpendicular:function(e,n,i,o,s){var r={x:[[t.startStubX,t.endStubX],null,[t.endStubX,t.startStubX]],y:[[t.startStubY,t.endStubY],null,[t.endStubY,t.startStubY]]},a={x:[[h,t.startStubY],[h,t.endStubY]],y:[[t.startStubX,d],[t.endStubX,d]]},l={x:[[t.endStubX,t.startStubY]],y:[[t.startStubX,t.endStubY]]},u={x:[[t.startStubX,t.endStubY],[t.endStubX,t.endStubY]],y:[[t.endStubX,t.startStubY],[t.endStubX,t.endStubY]]},c={x:[[t.startStubX,d],[t.endStubX,d],[t.endStubX,t.endStubY]],y:[[h,t.startStubY],[h,t.endStubY],[t.endStubX,t.endStubY]]},v={x:[t.startStubY,t.endStubY],y:[t.startStubX,t.endStubX]},f=p[e][0],g=p[e][1],y=t.so[f]+1,m=t.to[g]+1,_=-1===t.to[g]&&v[e][1]<v[e][0]||1===t.to[g]&&v[e][1]>v[e][0],x=r[e][y][0],k=r[e][y][1],b={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[e][y][m];return t.segment===b[3]||t.segment===b[2]&&_?a[e]:t.segment===b[2]&&k<x?l[e]:t.segment===b[2]&&k>=x||t.segment===b[1]&&!_?c[e]:t.segment===b[0]||t.segment===b[1]&&_?u[e]:void 0},orthogonal:function(e,n,i,o,s){var r={x:-1===t.so[0]?Math.min(n,o):Math.max(n,o),y:-1===t.so[1]?Math.min(n,o):Math.max(n,o)}[e];return({x:[[r,i],[r,s],[o,s]],y:[[i,r],[s,r],[s,o]]})[e]},opposite:function(i,o,r,a,l){var u=t["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var c=r+(1-e.sourceEndpoint._anchor.computedPosition[({x:"y",y:"x"})[i]])*e.sourceInfo[({x:"h",y:"w"})[i]]+n.maxStub;return({x:[[o,c],[a,c]],y:[[c,o],[c,a]]})[i]}return!u||1===t.so[s]&&o>a||-1===t.so[s]&&o<a?({x:[[o,d],[a,d]],y:[[h,o],[h,a]]})[i]:1===t.so[s]&&o<a||-1===t.so[s]&&o>a?({x:[[h,t.sy],[h,t.ty]],y:[[t.sx,d],[t.tx,d]]})[i]:void 0}})[t.anchorOrientation](t.sourceAxis,a,l,u,c);if(v)for(var f=0;f<v.length;f++)this.addASegment(v[f][0],v[f][1],t);this.addASegment(o[2],o[3],t),this.addASegment(t.tx,t.ty,t),this.writeSegments(t)}},{key:"transformGeometry",value:function(t,e,n){return t}}]),n}(i8);a(sf,"type","Flowchart"),oT(sf.type,sf),n7.registerHandler(ou),n7.registerHandler(oJ),n7.registerHandler(o$),oT(oO.type,oO);for(var sg={clientX:5e4,clientY:5e4,screenX:5e4,screenY:5e4,pageX:5e4,pageY:5e4},sy=[],sm=0;sm<256;sm++)sy[sm]=(sm<16?"0":"")+sm.toString(16);r(function t(e,n,i){o(this,t),this._jsPlumb=e,this.ok=n,this.equal=i,a(this,"_divs",[]),a(this,"mottle",void 0),this.mottle=new nw},[{key:"_t",value:function(t,e,n,i){this.mottle.trigger(t,e,{pageX:n,pageY:i,screenX:n,screenY:i,clientX:n,clientY:i})}},{key:"addDiv",value:function(t,e,n,i,o,s,r){var a=document.createElement("div");return a.style.position="absolute",a.innerHTML=t,e?e.appendChild(a):this._jsPlumb.getContainer().appendChild(a),a.setAttribute("id",t),a.style.left=(null!=i?i:Math.floor(1e3*Math.random()))+"px",a.style.top=(null!=o?o:Math.floor(1e3*Math.random()))+"px",n&&(a.className=n),s&&(a.style.width=s+"px"),r&&(a.style.height=r+"px"),this._divs.push(t),a}},{key:"addDivs",value:function(t,e){for(var n=0;n<t.length;n++)this.addDiv(t[n],e)}},{key:"assertEndpointCount",value:function(t,e){var n=this._jsPlumb.getEndpoints(t),i=n?n.length:0;this.equal(i,e,t.getAttribute("data-jtk-managed")+" has "+e+(e>1||0==e?" endpoints":" endpoint"))}},{key:"_assertManagedEndpointCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,e,n+" has "+e+" endpoints in managed record")}},{key:"_assertManagedConnectionCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,e,n+" has "+e+" connections in managed record")}},{key:"_registerDiv",value:function(t){this._divs.push(t)}},{key:"makeDragStartEvt",value:function(t){var e=this.makeEvent(t),n=this._jsPlumb.getContainer();return e.clientX+=n.offsetLeft,e.screenX+=n.offsetLeft,e.pageX+=n.offsetLeft,e.clientY+=n.offsetTop,e.screenY+=n.offsetTop,e.pageY+=n.offsetTop,e}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"dragNodeBy",value:function(t,e,n,i){(i=i||{}).before&&i.before();var o=this.makeEvent(t);this._jsPlumb.trigger(t,eE,o),i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,ew,o.pageX+e,o.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,eM,null),i.after&&i.after()}},{key:"dragNodeTo",value:function(t,e,n,i){i=i||{};var o=this._jsPlumb.viewport.getPosition(this._jsPlumb.getId(t));i.before&&i.before();var s=this.makeEvent(t);this._jsPlumb.trigger(t,eE,s);var r=this._jsPlumb.getContainer().getBoundingClientRect();i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,ew,r.x+e+o.w/2,r.y+n+o.h/2),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,eM,null),i.after&&i.after()}},{key:"dragToGroup",value:function(t,e,n){var i=this._jsPlumb.getGroup(e),o=this._jsPlumb.viewport.getPosition(i.elId),s=o.x+o.w/2,r=o.y+o.h/2;this.dragNodeTo(t,s,r,n)}},{key:"aSyncDragNodeBy",value:function(t,e,n,i){var o=this;(i=i||{}).before&&i.before();var s=this.makeEvent(t);this._jsPlumb.trigger(t,eE,s),i.beforeMouseMove&&i.beforeMouseMove(),setTimeout(function(){o._t(document,ew,s.pageX+e,s.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),setTimeout(function(){o.mottle.trigger(document,eM,null),i.after&&i.after()},45)},45)}},{key:"dragANodeAround",value:function(t,e,n){this._jsPlumb.trigger(t,eE,this.makeEvent(t));for(var i=50*Math.random(),o=0;o<i;o++){var s=function(){var t=Math.floor(2e3*Math.random()),e=Math.floor(2e3*Math.random());return{clientX:t,clientY:e,screenX:t,screenY:e,pageX:t,pageY:e}}();t.style.left=s.screenX+"px",t.style.top=s.screenY+"px",this._jsPlumb.trigger(document,ew,s)}e&&this.ok(e(),n||"while dragging assert"),this._jsPlumb.trigger(document,eM,sg)}},{key:"dragConnection",value:function(t,e,n,i){var o=this.getCanvas(t),s=this.getCanvas(e),r=this.makeEvent(o),a=this.makeEvent(s);i=i||{};var l=this._jsPlumb.select().length;return this._jsPlumb.trigger(o,eE,r),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(n?s:document,ew,a),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n?s:document,eM,a),this._jsPlumb.select().get(l)}},{key:"aSyncDragConnection",value:function(t,e,n){var i=this;n=n||{};var o=this.getCanvas(t),s=this.getCanvas(e),r=this.makeEvent(o),a=this.makeEvent(s),l=this._jsPlumb.select().length;this._jsPlumb.trigger(o,eE,r),setTimeout(function(){n.beforeMouseMove&&n.beforeMouseMove(),i._jsPlumb.trigger(document,ew,a),setTimeout(function(){n.beforeMouseUp&&n.beforeMouseUp(),i._jsPlumb.trigger(s,eM,a),n.after&&n.after(i._jsPlumb.select().get(l))},5)},5)}},{key:"dragAndAbortConnection",value:function(t){var e=this.getCanvas(t),n=this.makeEvent(e);this._jsPlumb.trigger(e,eE,n),this._jsPlumb.trigger(document,ew,sg),this._jsPlumb.trigger(document,eM,sg)}},{key:"detachConnection",value:function(t,e){e=e||{};var n=this.getEndpointCanvas(t),i=this.makeEvent(n);e.before&&e.before(),this._jsPlumb.trigger(n,eE,i),e.beforeMouseMove&&e.beforeMouseMove(),this._jsPlumb.trigger(document,ew,sg),e.beforeMouseUp&&e.beforeMouseUp(),this._jsPlumb.trigger(document,eM,sg),e.after&&e.after()}},{key:"detachAndReattachConnection",value:function(t,e){e=e||{};var n=this.getEndpointCanvas(t),i=this.makeEvent(n);e.before&&e.before(),this._jsPlumb.trigger(n,eE,i),e.beforeMouseMove&&e.beforeMouseMove(),this._jsPlumb.trigger(document,ew,sg),this._jsPlumb.trigger(document,ew,i),e.beforeMouseUp&&e.beforeMouseUp(),this._jsPlumb.trigger(document,eM,i),e.after&&e.after()}},{key:"detachConnectionByTarget",value:function(t,e){this.detachConnection(t.endpoints[1],e)}},{key:"relocateTarget",value:function(t,e,n){this.relocate(t,1,e,n)}},{key:"relocate",value:function(t,e,n,i){i=i||{},n=this.getCanvas(n);var o=this.getEndpointCanvas(t.endpoints[e]),s=this.makeEvent(o),r=this.makeEvent(n);i.before&&i.before(),this._jsPlumb.trigger(o,eE,s),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,ew,r),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n,eM,r),i.after&&i.after()}},{key:"relocateSource",value:function(t,e,n){this.relocate(t,0,e,n)}},{key:"makeEvent",value:function(t){var e=t.getBoundingClientRect(),n=e.x+e.width/2,i=e.y+e.height/2;return{clientX:n,clientY:i,screenX:n,screenY:i,pageX:n,pageY:i}}},{key:"getCanvas",value:function(t){return t.endpoint?this.getEndpointCanvas(t):t}},{key:"getEndpointCanvas",value:function(t){return t.endpoint.canvas}},{key:"getConnectionCanvas",value:function(t){return t.connector.canvas}},{key:"getEndpointCanvasPosition",value:function(t){var e=this.getEndpointCanvas(t);return{x:parseInt(e.style.left,10),y:parseInt(e.style.top,10),w:e.getAttribute("width"),h:e.getAttribute("height")}}},{key:"within",value:function(t,e,n){this.ok(1e-11>Math.abs(t-e),n+"[expected: "+e+" got "+t+"] [diff:"+Math.abs(t-e)+"]")}},{key:"assertManagedEndpointCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,e,n+" has "+e+" endpoints in managed record")}},{key:"assertManagedConnectionCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,e,n+" has "+e+" connections in managed record")}},{key:"fireEventOnEndpoint",value:function(t){for(var e=this.getEndpointCanvas(t),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)this._jsPlumb.trigger(e,n+1<1||arguments.length<=n+1?void 0:arguments[n+1])}},{key:"fireEventOnElement",value:function(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++)this._jsPlumb.trigger(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}},{key:"fireEventOnConnection",value:function(t){for(var e=this.getConnectionCanvas(t),n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.fireEventOnElement.apply(this,[e].concat(i))}},{key:"clickOnConnection",value:function(t){this.fireEventOnConnection(t,ex)}},{key:"dblClickOnConnection",value:function(t){this.fireEventOnConnection(t,eb)}},{key:"tapOnConnection",value:function(t){this.fireEventOnConnection(t,eE),this.fireEventOnConnection(t,eM)}},{key:"dblTapOnConnection",value:function(t){this.fireEventOnConnection(t,eE),this.fireEventOnConnection(t,eM),this.fireEventOnConnection(t,eE),this.fireEventOnConnection(t,eM)}},{key:"clickOnElement",value:function(t,e){this._jsPlumb.trigger(t,ex,null,null,null==e?1:e)}},{key:"dblClickOnElement",value:function(t){this._jsPlumb.trigger(t,eb)}},{key:"tapOnElement",value:function(t){this._jsPlumb.trigger(t,eE),this._jsPlumb.trigger(t,eM)}},{key:"dblTapOnElement",value:function(t){this._jsPlumb.trigger(t,eE),this._jsPlumb.trigger(t,eM),this._jsPlumb.trigger(t,eE),this._jsPlumb.trigger(t,eM)}},{key:"getOverlayCanvas",value:function(t){return t.canvas||t.path}},{key:"fireEventOnOverlay",value:function(t,e,n){var i=t.getOverlay(e),o=this.getOverlayCanvas(i);this._jsPlumb.trigger(o,n)}},{key:"clickOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,ex)}},{key:"dblClickOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,eb)}},{key:"tapOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,eE),this.fireEventOnOverlay(t,e,eM)}},{key:"dblTapOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,eE),this.fireEventOnOverlay(t,e,eM),this.fireEventOnOverlay(t,e,eE),this.fireEventOnOverlay(t,e,eM)}},{key:"cleanup",value:function(){var t=this._jsPlumb.getContainer();for(var e in this._jsPlumb.destroy(),this._divs){var n=document.getElementById(this._divs[e]);n&&n.parentNode.removeChild(n)}this._divs.length=0;var i=this._jsPlumb.select().length,o=this._jsPlumb.selectEndpoints().length,s=t.querySelectorAll(".jtk-endpoint").length,r=t.querySelectorAll(".jtk-connector").length;for(var a in t.__ta)for(var l in t.__ta[a])throw"Container event bindings not empty for key "+a;if(i>0)throw"there are connections in the data model!";if(o>0)throw"there are endpoints in the data model!";if(s>0)throw"there are "+s+" endpoints left in the dom!";if(r>0)throw"there are "+r+" connections left in the dom!"}},{key:"makeContent",value:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild}},{key:"length",value:function(t){var e=0;for(var n in t)t.hasOwnProperty(n)&&e++;return e}},{key:"head",value:function(t){for(var e in t)return t[e]}},{key:"uuid",value:function(){return th()}}]);var s_=0;function sx(t){var e;return new oq((e=s_+1,s_++,e),t)}function sk(t){!function e(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?t():setTimeout(e,9)}()}});var s=o("gYAp4");class r{constructor(t,e,n=[0,0]){this.outputs=[],this.children=[],this.frozen=!1,this.container=document.createElement("span"),this.container.classList.add("node-container"),t.appendChild(this.container),this.mainRowContainer=document.createElement("main-row-container"),this.lhsSpan=document.createElement("span"),this.lhsSpan.id="lhsSpan",this.mainRowContainer.appendChild(this.lhsSpan),e.manage(this.container)}updateSelf(){console.log("Updating")}updateChildren(){console.log("Updating Children")}}var a=document.getElementById("whiteboard");(0,s.ready)(()=>{let t=(0,s.newInstance)({container:a,connector:{type:s.FlowchartConnector.type,options:{}}});[].push(new r(a,t))});
//# sourceMappingURL=whiteboard-main.js.map
